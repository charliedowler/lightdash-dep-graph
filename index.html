<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Lightdash Backend — Dependency Graph</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif; background: #0d1117; color: #c9d1d9; overflow: hidden; }

#controls {
  position: fixed; top: 0; left: 0; right: 0; z-index: 10;
  background: #161b22ee; backdrop-filter: blur(8px);
  border-bottom: 1px solid #21262d;
  padding: 10px 16px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;
}
#controls input[type=text] {
  background: #0d1117; border: 1px solid #30363d; color: #c9d1d9;
  padding: 6px 12px; border-radius: 6px; font-size: 13px; width: 220px;
}
#controls input:focus { outline: none; border-color: #58a6ff; }
.btn {
  background: #21262d; border: 1px solid #30363d; color: #8b949e;
  padding: 5px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;
  transition: all 0.15s;
}
.btn:hover { background: #30363d; color: #c9d1d9; }
.btn.active { border-color: #58a6ff; color: #58a6ff; background: #1f6feb22; }
.sep { width: 1px; height: 20px; background: #30363d; }
#legend {
  position: fixed; bottom: 16px; right: 16px; z-index: 10;
  background: #161b22dd; backdrop-filter: blur(8px);
  border: 1px solid #21262d; border-radius: 8px;
  padding: 12px 16px; display: flex; flex-direction: column; gap: 6px;
}
.stat { font-size: 12px; color: #8b949e; }
.stat b { font-weight: 600; }
.stat-c b { color: #79c0ff; }
.stat-s b { color: #7ee787; }
.stat-m b { color: #ffa657; }
.stat-r b { color: #d2a8ff; }
.stat-k b { color: #f778ba; }

#tooltip {
  position: fixed; background: #1c2128; border: 1px solid #30363d;
  border-radius: 8px; padding: 12px 16px; font-size: 12px;
  pointer-events: none; display: none; z-index: 20; max-width: 380px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.5); line-height: 1.5;
}
#tooltip h3 { font-size: 14px; margin-bottom: 4px; }
#tooltip .t-section { color: #8b949e; margin-top: 6px; font-size: 11px; text-transform: uppercase; font-weight: 600; }
#tooltip .t-item { color: #c9d1d9; padding-left: 10px; }

svg { width: 100vw; height: 100vh; }

.link { stroke-opacity: 0.12; stroke-width: 1; }
.link-uses_service { stroke: #79c0ff; }
.link-router_uses_service { stroke: #d2a8ff; }
.link-injects_model { stroke: #ffa657; }
.link-injects_client { stroke: #f778ba; }
.link-injects_service { stroke: #7ee787; stroke-dasharray: 4,3; }
.link-shares_code { stroke: #f47067; stroke-dasharray: 4,2; stroke-width: 1.5; }
.link-shares_code.highlighted { stroke-opacity: 0.9; stroke-width: 2.5; }
.link.highlighted { stroke-opacity: 0.85; stroke-width: 2; }
.link.dimmed { stroke-opacity: 0.02; }

.node circle { stroke-width: 1.5; transition: opacity 0.2s; }
.node text { pointer-events: none; transition: opacity 0.2s; }
.node.dimmed circle, .node.dimmed text { opacity: 0.06; }

.domain-hull { pointer-events: none; transition: fill-opacity 0.3s, stroke-opacity 0.3s; }
.domain-label { pointer-events: none; font-size: 12px; font-weight: 700; text-anchor: middle; transition: fill-opacity 0.3s, font-size 0.3s; }
.domain-only .domain-hull { fill-opacity: 0.12 !important; stroke-opacity: 0.4 !important; stroke-width: 1.5 !important; }
.domain-only .domain-label { fill-opacity: 0.9 !important; font-size: 14px !important; }

#heatmap-legend {
  display: none; flex-direction: column; gap: 4px; margin-top: 8px;
  padding-top: 8px; border-top: 1px solid #21262d;
}
.heatmap-bar { width: 100%; height: 10px; border-radius: 4px; background: linear-gradient(to right, #3fb950, #d29922, #f47067); }
.heatmap-labels { display: flex; justify-content: space-between; font-size: 10px; color: #8b949e; }

#guide {
  position: fixed; top: 52px; left: 16px; z-index: 15;
  background: #161b22ee; backdrop-filter: blur(8px);
  border: 1px solid #21262d; border-radius: 10px;
  width: 320px; max-height: calc(100vh - 76px);
  overflow-y: auto; padding: 0;
  transform: translateX(-340px);
  transition: transform 0.25s ease;
  scrollbar-width: thin; scrollbar-color: #30363d transparent;
}
#guide.open { transform: translateX(0); }
#guide::-webkit-scrollbar { width: 6px; }
#guide::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }
#guide::-webkit-scrollbar-track { background: transparent; }
#guide .guide-header {
  position: sticky; top: 0; z-index: 1;
  background: #161b22; border-bottom: 1px solid #21262d;
  padding: 12px 16px; display: flex; justify-content: space-between; align-items: center;
}
#guide .guide-header h2 { font-size: 14px; font-weight: 600; color: #c9d1d9; margin: 0; }
#guide .guide-close {
  background: none; border: none; color: #8b949e; cursor: pointer;
  font-size: 18px; line-height: 1; padding: 0 4px;
}
#guide .guide-close:hover { color: #c9d1d9; }
#guide .guide-body { padding: 12px 16px 16px; }
.guide-section { margin-bottom: 12px; }
.guide-section:last-child { margin-bottom: 0; }
.guide-toggle {
  display: flex; align-items: center; gap: 6px; width: 100%;
  background: none; border: none; color: #c9d1d9; cursor: pointer;
  font-size: 13px; font-weight: 600; padding: 6px 0; text-align: left;
}
.guide-toggle:hover { color: #58a6ff; }
.guide-toggle .chevron {
  display: inline-block; font-size: 10px; color: #8b949e;
  transition: transform 0.15s; width: 12px; text-align: center;
}
.guide-toggle[aria-expanded="true"] .chevron { transform: rotate(90deg); }
.guide-content {
  display: none; padding: 4px 0 4px 18px;
  font-size: 12px; color: #8b949e; line-height: 1.6;
}
.guide-content.open { display: block; }
.guide-content p { margin: 0 0 6px; }
.guide-content p:last-child { margin: 0; }
.guide-content kbd {
  display: inline-block; background: #21262d; border: 1px solid #30363d;
  border-radius: 3px; padding: 0 5px; font-size: 11px; font-family: inherit;
  color: #c9d1d9; line-height: 1.6;
}
.guide-content .color-dot {
  display: inline-block; width: 8px; height: 8px; border-radius: 50%;
  vertical-align: middle; margin-right: 4px;
}
#detail {
  position: fixed; top: 52px; right: 16px; width: 380px; max-height: calc(100vh - 68px);
  background: #161b22; border: 1px solid #21262d; border-radius: 8px;
  z-index: 15; overflow: hidden; display: flex; flex-direction: column;
  transition: transform 0.25s ease, opacity 0.25s ease;
  transform: translateX(400px); opacity: 0; pointer-events: none;
}
#detail.open { transform: translateX(0); opacity: 1; pointer-events: auto; }
#detail .detail-header {
  position: sticky; top: 0; z-index: 1;
  background: #161b22; border-bottom: 1px solid #21262d;
  padding: 12px 16px; display: flex; justify-content: space-between; align-items: center;
  flex-shrink: 0;
}
#detail .detail-header h2 { font-size: 14px; font-weight: 600; color: #c9d1d9; margin: 0; word-break: break-all; }
#detail .detail-close {
  background: none; border: none; color: #8b949e; cursor: pointer;
  font-size: 18px; line-height: 1; padding: 0 4px; flex-shrink: 0;
}
#detail .detail-close:hover { color: #c9d1d9; }
#detail .detail-body {
  padding: 12px 16px 16px; overflow-y: auto; flex: 1;
}
#detail .detail-body::-webkit-scrollbar { width: 6px; }
#detail .detail-body::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }
#detail .detail-body::-webkit-scrollbar-track { background: transparent; }
#detail .detail-body a { color: #58a6ff; text-decoration: none; }
#detail .detail-body a:hover { text-decoration: underline; }
#detail .detail-body .t-section { font-size: 11px; text-transform: uppercase; color: #484f58; margin-top: 8px; letter-spacing: 0.05em; }
#detail .detail-body .t-item { font-size: 12px; color: #c9d1d9; padding-left: 10px; margin-top: 3px; font-family: 'SF Mono', 'Fira Code', monospace; }

</style>
</head>
<body>
<div id="controls">
  <input type="text" id="search" placeholder="Search...">
  <div class="sep"></div>
  <button class="btn active" data-filter="all">All</button>
  <button class="btn" data-filter="controller">Controllers</button>
  <button class="btn" data-filter="router">Routers</button>
  <button class="btn" data-filter="service">Services</button>
  <button class="btn" data-filter="model">Models</button>
  <button class="btn" data-filter="client">Clients</button>
  <div class="sep"></div>
  <label class="stat" style="display:flex;align-items:center;gap:4px;" title="How many hops from the selected node to highlight">Depth <input type="number" id="depth" value="2" min="1" max="10" style="width:42px;background:#0d1117;border:1px solid #30363d;color:#c9d1d9;padding:3px 6px;border-radius:4px;font-size:12px;text-align:center;"></label>
  <div class="sep"></div>
  <label class="stat" style="display:flex;align-items:center;gap:4px;" title="What drives node size and color">Size <select id="size-mode" style="background:#0d1117;border:1px solid #30363d;color:#c9d1d9;padding:3px 6px;border-radius:4px;font-size:12px;"><option value="edges">Edges</option><option value="lines">Lines</option><option value="cyclomatic">Cyclomatic</option><option value="cognitive">Cognitive</option><option value="commits">Commits</option><option value="authors">Authors</option><option value="churn">Churn (6mo)</option><option value="health">Health</option><option value="duplication">Duplication</option><option value="traffic">Traffic</option><option value="errors">Errors</option></select></label>
  <div class="sep"></div>
  <button class="btn active" id="btn-arrows">Arrows</button>
  <div class="sep"></div>
  <label class="stat" style="display:flex;align-items:center;gap:4px;">Group <select id="group-mode" style="background:#0d1117;border:1px solid #30363d;color:#c9d1d9;padding:3px 6px;border-radius:4px;font-size:12px;"><option value="domain">Domain</option><option value="layer">Layer</option></select></label>
  <button class="btn active" id="btn-nodes">Nodes</button>
  <div class="sep"></div>
  <button class="btn" id="btn-ee" style="display:none">EE</button>
  <div class="sep" id="sep-ee" style="display:none"></div>
  <button class="btn" id="btn-reset">Reset</button>
  <div class="sep"></div>
  <button class="btn" id="btn-guide" title="How to use this graph">?</button>
</div>
<div id="guide">
  <div class="guide-header">
    <h2>How to use this graph</h2>
    <button class="guide-close" id="guide-close">&times;</button>
  </div>
  <div class="guide-body">
    <div class="guide-section">
      <button class="guide-toggle" aria-expanded="true"><span class="chevron">&#9654;</span> Navigation</button>
      <div class="guide-content open">
        <p><b>Pan</b> &mdash; Click and drag the background</p>
        <p><b>Zoom</b> &mdash; Scroll wheel or pinch</p>
        <p><b>Move a node</b> &mdash; Drag it to reposition</p>
        <p><b>Reset view</b> &mdash; Click the <kbd>Reset</kbd> button</p>
      </div>
    </div>
    <div class="guide-section">
      <button class="guide-toggle" aria-expanded="true"><span class="chevron">&#9654;</span> Selecting &amp; exploring</button>
      <div class="guide-content open">
        <p><b>Click a node</b> to select it. Its dependencies are highlighted with animated edges that ripple outward.</p>
        <p><b>Depth</b> controls how many hops away from the selected node are shown (1&ndash;10).</p>
        <p><b>Click the background</b> to deselect.</p>
        <p><b>Search</b> filters nodes by name &mdash; matching nodes and their direct connections stay visible.</p>
      </div>
    </div>
    <div class="guide-section">
      <button class="guide-toggle" aria-expanded="false"><span class="chevron">&#9654;</span> Node types &amp; colors</button>
      <div class="guide-content">
        <p><span class="color-dot" style="background:#79c0ff"></span><b>Controller</b> &mdash; HTTP/API entry points</p>
        <p><span class="color-dot" style="background:#d2a8ff"></span><b>Router</b> &mdash; Route definitions</p>
        <p><span class="color-dot" style="background:#7ee787"></span><b>Service</b> &mdash; Business logic layer</p>
        <p><span class="color-dot" style="background:#ffa657"></span><b>Model</b> &mdash; Database/data access layer</p>
        <p><span class="color-dot" style="background:#f778ba"></span><b>Client</b> &mdash; External service clients</p>
        <p>Filter by type using the toolbar buttons.</p>
      </div>
    </div>
    <div class="guide-section">
      <button class="guide-toggle" aria-expanded="false"><span class="chevron">&#9654;</span> Edge types</button>
      <div class="guide-content">
        <p><span style="color:#79c0ff">&#9473;</span> <b>uses_service</b> &mdash; Controller calls a service</p>
        <p><span style="color:#d2a8ff">&#9473;</span> <b>router_uses_service</b> &mdash; Router calls a service</p>
        <p><span style="color:#ffa657">&#9473;</span> <b>injects_model</b> &mdash; Service depends on a model</p>
        <p><span style="color:#f778ba">&#9473;</span> <b>injects_client</b> &mdash; Service depends on a client</p>
        <p><span style="color:#7ee787">- -</span> <b>injects_service</b> &mdash; Service-to-service (dashed)</p>
        <p><span style="color:#f47067">- -</span> <b>shares_code</b> &mdash; Code duplication link (dashed)</p>
      </div>
    </div>
    <div class="guide-section">
      <button class="guide-toggle" aria-expanded="false"><span class="chevron">&#9654;</span> Size modes</button>
      <div class="guide-content">
        <p><b>Size</b> controls node radius and automatically sets an appropriate color scheme:</p>
        <p>&bull; <b>Edges</b> &mdash; Dependency count (colored by type)</p>
        <p>&bull; <b>Lines</b> &mdash; Source lines of code (colored by type)</p>
        <p>&bull; <b>Cyclomatic</b> &mdash; Number of execution paths (colored by type)</p>
        <p>&bull; <b>Cognitive</b> &mdash; Human readability difficulty (colored by type)</p>
        <p>&bull; <b>Commits / Authors / Churn</b> &mdash; Git activity (colored by type)</p>
        <p>&bull; <b>Health</b> &mdash; Composite score, green&#8594;red heatmap</p>
        <p>&bull; <b>Duplication</b> &mdash; Shared code blocks, green&#8594;red heatmap</p>
        <p>&bull; <b>Traffic</b> &mdash; Sentry 30d requests, yellow&#8594;red heatmap (requires --sentry)</p>
        <p>&bull; <b>Errors</b> &mdash; Sentry 30d errors, yellow&#8594;red heatmap (requires --sentry)</p>
      </div>
    </div>
    <div class="guide-section">
      <button class="guide-toggle" aria-expanded="false"><span class="chevron">&#9654;</span> Domains &amp; toggles</button>
      <div class="guide-content">
        <p><b>Domains</b> groups nodes by their domain directory, drawing a hull boundary around each group. Toggle off for a flat layout.</p>
        <p><b>Nodes</b> toggles node and edge visibility. Turn off to see only the domain regions &mdash; useful for a high-level architectural overview.</p>
        <p><b>Arrows</b> shows dependency direction on highlighted edges.</p>
        <p><b>EE</b> (if visible) toggles enterprise-edition nodes.</p>
      </div>
    </div>
    <div class="guide-section">
      <button class="guide-toggle" aria-expanded="false"><span class="chevron">&#9654;</span> Tooltips &amp; health score</button>
      <div class="guide-content">
        <p><b>Hover any node</b> to see its metrics: edges, lines of code, complexity scores, git churn, recent commits, and duplication info.</p>
        <p>The <b>health score</b> (0&ndash;100) is a composite: 30% coupling, 25% complexity, 30% churn, 15% commit frequency. Lower is better.</p>
      </div>
    </div>
  </div>
</div>
<div id="detail">
  <div class="detail-header">
    <h2 id="detail-title"></h2>
    <button class="detail-close" id="detail-close">&times;</button>
  </div>
  <div class="detail-body" id="detail-body"></div>
</div>
<div id="legend">
  <span class="stat stat-c"><b>41</b> controllers</span>
  <span class="stat stat-r"><b>12</b> routers</span>
  <span class="stat stat-s"><b>48</b> services</span>
  <span class="stat stat-m"><b>56</b> models</span>
  <span class="stat stat-k"><b>7</b> clients</span>
  <span class="stat"><b>448</b> edges</span>
  <div id="heatmap-legend">
    <div class="heatmap-labels"><span>Healthy</span><span>Hot</span></div>
    <div class="heatmap-bar"></div>
  </div>
</div>
<div id="tooltip"></div>
<svg></svg>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
const raw = {"nodes":[{"id":"ChangesetController","type":"controller","lineCount":122,"complexity":{"cyclomatic":4,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":4,"authors":3,"churn":4,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"c76bd9635b","message":"fix: if a change is deleted, show it as reverted in the Agent ui (#17275)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"},{"hash":"3a699bef93","message":"feat: add API endpoints to revert changes in changesets (#17235)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"}]},"domain":"Catalog","gitSummary":"Add JSDoc summaries to API handler methods\nShow deleted changes as reverted in Agent UI\nAdd endpoints to revert changeset changes","healthSummary":"Minimal controller — stable and well-scoped","duplication":{"clonedLines":0,"totalLines":120,"ratio":0}},{"id":"OrganizationRolesController","type":"controller","lineCount":198,"complexity":{"cyclomatic":6,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":6,"authors":3,"churn":6,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"e3ffa65d21","message":"feat: add duplicate role endpoint (#16610)","author":"Steve Gardner","relativeDate":"5 months ago"},{"hash":"26d444e6c9","message":"feat: add assigning scopes to custom roles (#16601)","author":"Steve Gardner","relativeDate":"5 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Add JSDoc summaries to API handler methods\nAdd endpoint to duplicate organization roles\nEnable scope assignment for custom roles","healthSummary":"Clean delegation to roles service","duplication":{"clonedLines":31,"totalLines":196,"ratio":0.15816326530612246},"duplicationSummary":"TSOA imports only - framework boilerplate, not concerning"},{"id":"ProjectRolesController","type":"controller","lineCount":249,"complexity":{"cyclomatic":7,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":2,"authors":2,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"667efe54c0","message":"fix: move new role system endpoints to oss (#16563)","author":"Javier Rengel Jiménez","relativeDate":"6 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Add JSDoc summaries to API handler methods\nMove role system endpoints to open source","healthSummary":"Thin wrapper, stable pattern","duplication":{"clonedLines":0,"totalLines":247,"ratio":0}},{"id":"bigquerySSOController","type":"controller","lineCount":68,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":2,"authors":2,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"34f3f664c7","message":"feat: bigquery SSO project creation (#15026)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"}]},"domain":"User Auth","gitSummary":"Add JSDoc summaries to API handler methods\nEnable BigQuery SSO for project creation","healthSummary":"Simple OAuth handler, no issues","duplication":{"clonedLines":0,"totalLines":66,"ratio":0}},{"id":"catalogController","type":"controller","lineCount":638,"complexity":{"cyclomatic":21,"cognitive":5,"maxFunctionCyclomatic":4},"gitActivity":{"commits":37,"authors":7,"churn":8,"recentCommits":[{"hash":"6ff95b3213","message":"feat: remove canvas view based on metrics limitation (#19958)","author":"Tatiana Inama","relativeDate":"3 days ago"},{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"fc1d0b9938","message":"feat: support compare to another metric in metric explore modal v2 (#19727)","author":"João Viana","relativeDate":"11 days ago"}]},"domain":"Catalog","gitSummary":"Remove canvas view for metrics with limitations\nAdd JSDoc summaries to API handler methods\nSupport metric-to-metric comparison in explorer","healthSummary":"Moderate complexity, active changes — monitor regressions","duplication":{"clonedLines":0,"totalLines":636,"ratio":0}},{"id":"commentsController","type":"controller","lineCount":158,"complexity":{"cyclomatic":5,"cognitive":1,"maxFunctionCyclomatic":2},"gitActivity":{"commits":9,"authors":7,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"0299884c6c","message":"feat: allow fetching dashboards and charts by slug (#17292)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"3b55ad3dfd","message":"chore: disable promotion and dashboard comments in demo (#11287)","author":"Jose Rego","relativeDate":"1 year, 5 months ago"}]},"domain":"Notifications","gitSummary":"Add JSDoc summaries to API handler methods\nAllow fetching content by slug instead of UUID\nDisable promotion & dashboard comments in demo","healthSummary":"Straightforward CRUD, stable","duplication":{"clonedLines":25,"totalLines":156,"ratio":0.16025641025641027},"duplicationSummary":"TSOA imports only - standard controller pattern"},{"id":"csvController","type":"controller","lineCount":53,"complexity":{"cyclomatic":1,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":8,"authors":5,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"e75205cbbe","message":"fix: show error when downloading CSV (#12580)","author":"Jose Rego","relativeDate":"1 year, 3 months ago"},{"hash":"7f41a8a854","message":"chore: update controllers to use injected `ServiceRepository` for service access (#9234)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"Scheduling","gitSummary":"Add JSDoc summaries to API handler methods\nShow error messages when CSV download fails\nMigrate to injected ServiceRepository pattern","healthSummary":"Thin wrapper, delegates to CsvService","duplication":{"clonedLines":0,"totalLines":51,"ratio":0}},{"id":"dashboardController","type":"controller","lineCount":138,"complexity":{"cyclomatic":5,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":6,"authors":4,"churn":3,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"ad5b9e5582","message":"feat: add dashboards and saved charts v2 controller with pagination for schedulers (#19718)","author":"Bruno Almeida","relativeDate":"12 days ago"},{"hash":"d674b0c9d1","message":"chore: move scheduler calls to dashboard & chart controllers (#19695)","author":"Bruno Almeida","relativeDate":"12 days ago"}]},"domain":"Dashboards","gitSummary":"Add JSDoc summaries to API handler methods\nAdd paginated v2 endpoints for schedulers\nMove scheduler calls from routes to controllers","healthSummary":"Clean controller, good separation","duplication":{"clonedLines":20,"totalLines":136,"ratio":0.14705882352941177},"duplicationSummary":"TSOA imports only - framework boilerplate"},{"id":"exploreController","type":"controller","lineCount":238,"complexity":{"cyclomatic":6,"cognitive":1,"maxFunctionCyclomatic":2},"gitActivity":{"commits":24,"authors":10,"churn":3,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"cc8dc36884","message":"feat: add pivot sql to compile sql endpoint (#19743)","author":"Bruno Almeida","relativeDate":"9 days ago"},{"hash":"43ed90c4a7","message":"feat: allow changing date/timestamp dimensions' formatting in results table (#19277)","author":"João Viana","relativeDate":"4 weeks ago"}]},"domain":"Explores","gitSummary":"Add JSDoc summaries to API handler methods\nAdd pivot SQL to compile SQL endpoint\nAllow custom date/timestamp formatting in results","healthSummary":"Well-scoped, stable pattern","duplication":{"clonedLines":11,"totalLines":236,"ratio":0.046610169491525424},"duplicationSummary":"MetricQuery builder - extract to utility function"},{"id":"funnelController","type":"controller","lineCount":90,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":1,"authors":1,"churn":1,"recentCommits":[{"hash":"6782ab25ce","message":"feat(prototype): funnel builder API (#19344)","author":"Oliver Laslett","relativeDate":"4 weeks ago"}]},"domain":"Explores","gitSummary":"Add funnel builder API endpoints","healthSummary":"New feature, minimal code — good start","duplication":{"clonedLines":17,"totalLines":88,"ratio":0.19318181818181818},"duplicationSummary":"TSOA imports only - framework pattern"},{"id":"gitIntegrationController","type":"controller","lineCount":217,"complexity":{"cyclomatic":9,"cognitive":6,"maxFunctionCyclomatic":2},"gitActivity":{"commits":14,"authors":7,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"2757f30457","message":"feat: add editor for yml files (#18788)","author":"Oliver Laslett","relativeDate":"8 weeks ago"},{"hash":"d77a9f6d61","message":"feat: preview branch (#14222)","author":"Javier Rengel Jiménez","relativeDate":"10 months ago"}]},"domain":"Git Integration","gitSummary":"Add JSDoc summaries to API handler methods\nAdd YAML file editor for git integration\nEnable preview branch functionality","healthSummary":"Moderate complexity, stable recently","duplication":{"clonedLines":30,"totalLines":215,"ratio":0.13953488372093023},"duplicationSummary":"Mixed: imports + business logic - needs investigation"},{"id":"githubController","type":"controller","lineCount":162,"complexity":{"cyclomatic":7,"cognitive":3,"maxFunctionCyclomatic":3},"gitActivity":{"commits":11,"authors":3,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"b106bce16e","message":"feat: GitHub login full flow (#13701)","author":"Javier Rengel Jiménez","relativeDate":"12 months ago"},{"hash":"e7ad392d06","message":"chore: Analytic events write back + refactor (#11998)","author":"Javier Rengel Jiménez","relativeDate":"1 year, 4 months ago"}]},"domain":"Git Integration","gitSummary":"Add JSDoc summaries to API handler methods\nImplement full GitHub login authentication flow\nRefactor analytics event write-back system","healthSummary":"OAuth flow handler, acceptable complexity","duplication":{"clonedLines":14,"totalLines":160,"ratio":0.0875},"duplicationSummary":"OAuth state management - extract to shared helper"},{"id":"gitlabController","type":"controller","lineCount":137,"complexity":{"cyclomatic":7,"cognitive":4,"maxFunctionCyclomatic":3},"gitActivity":{"commits":2,"authors":2,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"43c4b82352","message":"feat: gitlab integration (#16633)","author":"Javier Rengel Jiménez","relativeDate":"5 months ago"}]},"domain":"Git Integration","gitSummary":"Add JSDoc summaries to API handler methods\nAdd GitLab integration support","healthSummary":"Parallel to GitHub, consistent pattern","duplication":{"clonedLines":14,"totalLines":135,"ratio":0.1037037037037037},"duplicationSummary":"OAuth state management - extract to shared helper"},{"id":"googleDriveController","type":"controller","lineCount":71,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":7,"authors":4,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"58857a1215","message":"refactor: client injection in services (#9382)","author":"Jose Rego","relativeDate":"1 year, 11 months ago"},{"hash":"7f41a8a854","message":"chore: update controllers to use injected `ServiceRepository` for service access (#9234)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"Integrations","gitSummary":"Add JSDoc summaries to API handler methods\nMigrate to client injection pattern\nMigrate to injected ServiceRepository pattern","healthSummary":"Simple integration wrapper","duplication":{"clonedLines":0,"totalLines":69,"ratio":0}},{"id":"groupsController","type":"controller","lineCount":299,"complexity":{"cyclomatic":12,"cognitive":6,"maxFunctionCyclomatic":2},"gitActivity":{"commits":11,"authors":6,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"2b7007e319","message":"fix: migrate project access to new endpoints (#16570)","author":"Javier Rengel Jiménez","relativeDate":"6 months ago"},{"hash":"7f41a8a854","message":"chore: update controllers to use injected `ServiceRepository` for service access (#9234)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Add JSDoc summaries to API handler methods\nMigrate project access to new endpoints\nMigrate to injected ServiceRepository pattern","healthSummary":"Moderate complexity, stable — good model","duplication":{"clonedLines":0,"totalLines":297,"ratio":0}},{"id":"metricsExplorerController","type":"controller","lineCount":121,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":17,"authors":5,"churn":4,"recentCommits":[{"hash":"6c3af36fb7","message":"refactor: remove deprecated metrics explorer query endpoint (#20053)","author":"Giorgi Bagdavadze","relativeDate":"2 days ago"},{"hash":"d913502224","message":"feat: add rolling days comparison option to metrics explorer (#19959)","author":"Giorgi Bagdavadze","relativeDate":"2 days ago"},{"hash":"5a697db216","message":"feat: view compiled sql for metric tree metric total (#19935)","author":"Giorgi Bagdavadze","relativeDate":"3 days ago"}]},"domain":"Explores","gitSummary":"Remove deprecated query endpoint\nAdd rolling days comparison for metrics\nAdd compiled SQL view for metric tree totals","healthSummary":"Simple delegation, active iteration","duplication":{"clonedLines":28,"totalLines":119,"ratio":0.23529411764705882},"duplicationSummary":"High import ratio - check for real logic duplication"},{"id":"notificationsController","type":"controller","lineCount":81,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":4,"authors":3,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"7f41a8a854","message":"chore: update controllers to use injected `ServiceRepository` for service access (#9234)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"},{"hash":"5798a37822","message":"chore: update controllers to use new `BaseController` (#9233)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"Notifications","gitSummary":"Add JSDoc summaries to API handler methods\nMigrate to injected ServiceRepository pattern\nMigrate to new BaseController pattern","healthSummary":"Minimal wrapper, stable","duplication":{"clonedLines":0,"totalLines":79,"ratio":0}},{"id":"organizationController","type":"controller","lineCount":634,"complexity":{"cyclomatic":34,"cognitive":18,"maxFunctionCyclomatic":3},"gitActivity":{"commits":34,"authors":12,"churn":5,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"9db17776dc","message":"fix(backend): allow for filtering users with google refresh token (#19161)","author":"Bruno Almeida","relativeDate":"5 weeks ago"},{"hash":"d113a87df0","message":"feat(backend): reassign user scheduled delivers on delete (#19132)","author":"Bruno Almeida","relativeDate":"6 weeks ago"}]},"domain":"Organizations","gitSummary":"Add JSDoc summaries to API handler methods\nAdd filter for users with Google refresh token\nReassign scheduled deliveries on user deletion","healthSummary":"High edges + complexity — review delegation opportunities","duplication":{"clonedLines":44,"totalLines":632,"ratio":0.06962025316455696},"duplicationSummary":"Session management logic - extract sessionHelpers.ts"},{"id":"pinningController","type":"controller","lineCount":95,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":8,"authors":5,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"7f41a8a854","message":"chore: update controllers to use injected `ServiceRepository` for service access (#9234)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"},{"hash":"5798a37822","message":"chore: update controllers to use new `BaseController` (#9233)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"Content","gitSummary":"Add JSDoc summaries to API handler methods\nMigrate to injected ServiceRepository pattern\nMigrate to new BaseController pattern","healthSummary":"Simple CRUD, stable","duplication":{"clonedLines":0,"totalLines":93,"ratio":0}},{"id":"projectCompileLogController","type":"controller","lineCount":113,"complexity":{"cyclomatic":7,"cognitive":8,"maxFunctionCyclomatic":6},"gitActivity":{"commits":2,"authors":2,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"4353a812bc","message":"feat(backend): project compile log model, service and controller (#17577)","author":"Tatiana Inama","relativeDate":"3 months ago"}]},"domain":"Projects","gitSummary":"Add JSDoc summaries to API handler methods\nAdd project compile log tracking endpoints","healthSummary":"High cognitive load for small controller — simplify conditionals","duplication":{"clonedLines":0,"totalLines":111,"ratio":0}},{"id":"projectController","type":"controller","lineCount":1195,"complexity":{"cyclomatic":48,"cognitive":21,"maxFunctionCyclomatic":4},"gitActivity":{"commits":59,"authors":14,"churn":8,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"257b22d032","message":"fix: improve content-as-code validation (#19375)","author":"Giorgi Bagdavadze","relativeDate":"3 weeks ago"},{"hash":"81fb6be86a","message":"fix: {projectUuid}/spaces explicit user session validation (#18961)","author":"Yegor Borisenco","relativeDate":"7 weeks ago"}]},"domain":"Projects","gitSummary":"Add JSDoc summaries to API handler methods\nImprove content-as-code validation\nAdd explicit user session validation for spaces","healthSummary":"God controller — owns too many concerns, split by domain"},{"id":"renameController","type":"controller","lineCount":142,"complexity":{"cyclomatic":3,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":2,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"6fd8156986","message":"fix: ui improvement to rename in validation (#14872)","author":"Javier Rengel Jiménez","relativeDate":"9 months ago"},{"hash":"bea8ada817","message":"feat: rename models and fields in CLI and UI  (#14657)","author":"Javier Rengel Jiménez","relativeDate":"9 months ago"}]},"domain":"Content","gitSummary":"Add JSDoc summaries to API handler methods\nImprove rename validation UI experience\nEnable renaming models and fields via CLI/UI","healthSummary":"Focused feature, stable","duplication":{"clonedLines":20,"totalLines":140,"ratio":0.14285714285714285},"duplicationSummary":"TSOA imports only - acceptable framework pattern"},{"id":"runQueryController","type":"controller","lineCount":191,"complexity":{"cyclomatic":4,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":26,"authors":11,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"43ed90c4a7","message":"feat: allow changing date/timestamp dimensions' formatting in results table (#19277)","author":"João Viana","relativeDate":"4 weeks ago"},{"hash":"3287365050","message":"fix: Revert \"fix: Revert \"feat: refactor AsyncQuery and Project service to use account where needed for Embedded Explores (#15893)\" (#16007)\" (#16023)","author":"Steve Gardner","relativeDate":"7 months ago"}]},"domain":"Explores","gitSummary":"Add JSDoc summaries to API handler methods\nAllow custom date/timestamp formatting in results\nRefactor AsyncQuery for Embedded Explores support","healthSummary":"Core query handler, stable pattern","duplication":{"clonedLines":95,"totalLines":189,"ratio":0.5026455026455027},"duplicationSummary":"HIGH: deprecation tracking + query building - refactor needed"},{"id":"savedChartController","type":"controller","lineCount":466,"complexity":{"cyclomatic":15,"cognitive":4,"maxFunctionCyclomatic":2},"gitActivity":{"commits":37,"authors":12,"churn":3,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"ad5b9e5582","message":"feat: add dashboards and saved charts v2 controller with pagination for schedulers (#19718)","author":"Bruno Almeida","relativeDate":"12 days ago"},{"hash":"d674b0c9d1","message":"chore: move scheduler calls to dashboard & chart controllers (#19695)","author":"Bruno Almeida","relativeDate":"12 days ago"}]},"domain":"Saved Charts","gitSummary":"Add JSDoc summaries to API handler methods\nAdd paginated v2 endpoints for schedulers\nMove scheduler calls from routes to controllers","healthSummary":"High coupling — central to many workflows","duplication":{"clonedLines":64,"totalLines":464,"ratio":0.13793103448275862},"duplicationSummary":"Mixed: imports + deprecation tracking middleware needed"},{"id":"schedulerController","type":"controller","lineCount":638,"complexity":{"cyclomatic":39,"cognitive":43,"maxFunctionCyclomatic":9},"gitActivity":{"commits":23,"authors":9,"churn":8,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"a04eb24cf6","message":"feat: add `my scheduled deliveries` user settings page (#19571)","author":"Lukas Spiss","relativeDate":"2 weeks ago"},{"hash":"426f685832","message":"feat(wip): add endpoint to reassign scheduled deliveries in bulk (#19041)","author":"Bruno Almeida","relativeDate":"7 weeks ago"}]},"domain":"Scheduling","gitSummary":"Add JSDoc summaries to API handler methods\nAdd user settings page for scheduled deliveries\nAdd bulk reassign endpoint for deliveries","healthSummary":"Highest cognitive (43) + churn — regression risk, needs tests","duplication":{"clonedLines":74,"totalLines":636,"ratio":0.11635220125786164},"duplicationSummary":"Moderate duplication - check for scheduler-specific patterns"},{"id":"shareController","type":"controller","lineCount":73,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":7,"authors":5,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"7f41a8a854","message":"chore: update controllers to use injected `ServiceRepository` for service access (#9234)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"},{"hash":"5798a37822","message":"chore: update controllers to use new `BaseController` (#9233)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"Content","gitSummary":"Add JSDoc summaries to API handler methods\nMigrate to injected ServiceRepository pattern\nMigrate to new BaseController pattern","healthSummary":"Simple sharing logic, stable","duplication":{"clonedLines":0,"totalLines":71,"ratio":0}},{"id":"slackController","type":"controller","lineCount":259,"complexity":{"cyclomatic":12,"cognitive":7,"maxFunctionCyclomatic":3},"gitActivity":{"commits":17,"authors":9,"churn":3,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"290d991737","message":"feat: use db cache for slack channel fetching (#18660)","author":"João Viana","relativeDate":"8 weeks ago"},{"hash":"4694c1a284","message":"feat: new slack channel selector component (#18492)","author":"Irakli Janiashvili","relativeDate":"9 weeks ago"}]},"domain":"Slack","gitSummary":"Add JSDoc summaries to API handler methods\nUse database cache for Slack channel fetching\nAdd new Slack channel selector component","healthSummary":"Integration hub, moderate complexity","duplication":{"clonedLines":14,"totalLines":257,"ratio":0.054474708171206226},"duplicationSummary":"File download security - extract middleware"},{"id":"spaceController","type":"controller","lineCount":298,"complexity":{"cyclomatic":8,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":12,"authors":8,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"b2f714549c","message":"feat: unify all content item actions (only move so far) bulk or single (#14745)","author":"Irakli Janiashvili","relativeDate":"9 months ago"},{"hash":"05e09a723c","message":"feat: resource bulk actions - move to another space (#14704)","author":"Irakli Janiashvili","relativeDate":"9 months ago"}]},"domain":"Spaces","gitSummary":"Add JSDoc summaries to API handler methods\nUnify bulk/single content item move actions\nAdd bulk move to another space functionality","healthSummary":"Standard CRUD, stable","duplication":{"clonedLines":25,"totalLines":296,"ratio":0.08445945945945946},"duplicationSummary":"TSOA imports only - framework boilerplate"},{"id":"spotlightController","type":"controller","lineCount":114,"complexity":{"cyclomatic":3,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":3,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"d479c14edf","message":"fix: get spotlight config and tags authorized in demo (#13389)","author":"Bruno Almeida","relativeDate":"1 year, 1 month ago"},{"hash":"741731967a","message":"feat: allow curating Spotlight's table (#13355)","author":"João Viana","relativeDate":"1 year, 1 month ago"}]},"domain":"Analytics","gitSummary":"Add JSDoc summaries to API handler methods\nAuthorize Spotlight config/tags in demo mode\nAllow curating Spotlight's table configuration","healthSummary":"New feature, clean start","duplication":{"clonedLines":40,"totalLines":112,"ratio":0.35714285714285715},"duplicationSummary":"HIGH: TSOA imports inflating ratio - mostly boilerplate"},{"id":"sqlRunnerController","type":"controller","lineCount":591,"complexity":{"cyclomatic":21,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":37,"authors":9,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"3287365050","message":"fix: Revert \"fix: Revert \"feat: refactor AsyncQuery and Project service to use account where needed for Embedded Explores (#15893)\" (#16007)\" (#16023)","author":"Steve Gardner","relativeDate":"7 months ago"},{"hash":"9356f4e354","message":"fix: Revert \"feat: refactor AsyncQuery and Project service to use account where needed for Embedded Explores (#15893)\" (#16007)","author":"Steve Gardner","relativeDate":"7 months ago"}]},"domain":"SQL Runner","gitSummary":"Add JSDoc summaries to API handler methods\nRefactor AsyncQuery for Embedded Explores support\nRevert AsyncQuery refactor temporarily","healthSummary":"Large but stable — SQL execution hub","duplication":{"clonedLines":62,"totalLines":589,"ratio":0.10526315789473684},"duplicationSummary":"CSV streaming response - extract downloadHelpers.ts"},{"id":"sshController","type":"controller","lineCount":39,"complexity":{"cyclomatic":1,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":6,"authors":4,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"7f41a8a854","message":"chore: update controllers to use injected `ServiceRepository` for service access (#9234)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"},{"hash":"5798a37822","message":"chore: update controllers to use new `BaseController` (#9233)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"Infrastructure","gitSummary":"Add JSDoc summaries to API handler methods\nMigrate to injected ServiceRepository pattern\nMigrate to new BaseController pattern","healthSummary":"Minimal wrapper, stable","duplication":{"clonedLines":0,"totalLines":37,"ratio":0}},{"id":"userActivityController","type":"controller","lineCount":119,"complexity":{"cyclomatic":3,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":2,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"70288f5f44","message":"feat: add unused content dashboard to analytics (#16757)","author":"Javier Rengel Jiménez","relativeDate":"5 months ago"},{"hash":"872355ee41","message":"fix: download raw usage analytics (#14471)","author":"Javier Rengel Jiménez","relativeDate":"10 months ago"}]},"domain":"Analytics","gitSummary":"Add JSDoc summaries to API handler methods\nAdd unused content dashboard to analytics\nFix raw usage analytics download","healthSummary":"Simple tracking, stable","duplication":{"clonedLines":56,"totalLines":117,"ratio":0.47863247863247865},"duplicationSummary":"HIGH: TSOA imports + validation types - mostly boilerplate"},{"id":"userAttributesController","type":"controller","lineCount":143,"complexity":{"cyclomatic":4,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":6,"authors":4,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"7f41a8a854","message":"chore: update controllers to use injected `ServiceRepository` for service access (#9234)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"},{"hash":"5798a37822","message":"chore: update controllers to use new `BaseController` (#9233)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"Integrations","gitSummary":"Add JSDoc summaries to API handler methods\nMigrate to injected ServiceRepository pattern\nMigrate to new BaseController pattern","healthSummary":"Clean CRUD, stable","duplication":{"clonedLines":0,"totalLines":141,"ratio":0}},{"id":"userController","type":"controller","lineCount":499,"complexity":{"cyclomatic":29,"cognitive":18,"maxFunctionCyclomatic":2},"gitActivity":{"commits":20,"authors":9,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"5862adebd4","message":"fix: handle undefined req.user in user endpoints (#18888)","author":"Yegor Borisenco","relativeDate":"7 weeks ago"},{"hash":"60b9386c98","message":"feat: add OAuth2 server for CLI authentication (#15889)","author":"Javier Rengel Jiménez","relativeDate":"7 months ago"}]},"domain":"User Auth","gitSummary":"Add JSDoc summaries to API handler methods\nHandle undefined user in endpoint validation\nAdd OAuth2 server for CLI authentication","healthSummary":"High complexity + edges — user management hub, review splits","duplication":{"clonedLines":44,"totalLines":497,"ratio":0.08853118712273642},"duplicationSummary":"Session management logic - extract sessionHelpers.ts"},{"id":"v2/ContentController","type":"controller","lineCount":142,"complexity":{"cyclomatic":7,"cognitive":6,"maxFunctionCyclomatic":3},"gitActivity":{"commits":9,"authors":5,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"154ab4ed2d","message":"chore: add sqlRunner controller and content controller to docs (#15508)","author":"Bruno Almeida","relativeDate":"8 months ago"},{"hash":"b2f714549c","message":"feat: unify all content item actions (only move so far) bulk or single (#14745)","author":"Irakli Janiashvili","relativeDate":"9 months ago"}]},"domain":"Content","gitSummary":"Add JSDoc summaries to API handler methods\nAdd controller to API documentation\nUnify bulk/single content item move actions","healthSummary":"Moderate complexity for v2 API","duplication":{"clonedLines":0,"totalLines":140,"ratio":0}},{"id":"v2/DashboardController","type":"controller","lineCount":76,"complexity":{"cyclomatic":4,"cognitive":5,"maxFunctionCyclomatic":4},"gitActivity":{"commits":1,"authors":1,"churn":1,"recentCommits":[{"hash":"ad5b9e5582","message":"feat: add dashboards and saved charts v2 controller with pagination for schedulers (#19718)","author":"Bruno Almeida","relativeDate":"12 days ago"}]},"domain":"Dashboards","gitSummary":"Add paginated v2 endpoints for schedulers","healthSummary":"New v2 endpoint, minimal code","duplication":{"clonedLines":22,"totalLines":74,"ratio":0.2972972972972973},"duplicationSummary":"TSOA imports only - v2 API migration pattern"},{"id":"v2/FeatureFlagController","type":"controller","lineCount":43,"complexity":{"cyclomatic":1,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":2,"authors":2,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"91d8187d74","message":"chore: feature flag endpoint (#12947)","author":"Jose Rego","relativeDate":"1 year, 2 months ago"}]},"domain":"Integrations","gitSummary":"Add JSDoc summaries to API handler methods\nAdd feature flag endpoint","healthSummary":"Simple flag retrieval","duplication":{"clonedLines":0,"totalLines":41,"ratio":0}},{"id":"v2/ParametersController","type":"controller","lineCount":140,"complexity":{"cyclomatic":7,"cognitive":4,"maxFunctionCyclomatic":3},"gitActivity":{"commits":6,"authors":4,"churn":4,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"f7f0a7478c","message":"feat: add number to parameter value types (#16543)","author":"Yegor Borisenco","relativeDate":"6 months ago"},{"hash":"a075a3e8f3","message":"feat: add model-level parameters to project parameters list (#16418)","author":"Yegor Borisenco","relativeDate":"6 months ago"}]},"domain":"Projects","gitSummary":"Add JSDoc summaries to API handler methods\nAdd number to parameter value types\nAdd model-level parameters to list endpoint","healthSummary":"Active iteration on parameters API","duplication":{"clonedLines":0,"totalLines":138,"ratio":0}},{"id":"v2/QueryController","type":"controller","lineCount":546,"complexity":{"cyclomatic":37,"cognitive":28,"maxFunctionCyclomatic":5},"gitActivity":{"commits":34,"authors":8,"churn":12,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"fde8e0ff15","message":"chore: remove global pop & pop fields on additional metrics (#19697)","author":"João Viana","relativeDate":"11 days ago"},{"hash":"6d8181f17e","message":"feat: include sort in underlying data CSV export (#19755)","author":"Oliver Laslett","relativeDate":"11 days ago"}]},"domain":"Explores","gitSummary":"Add JSDoc summaries to API handler methods\nRemove global PoP fields on additional metrics\nInclude sort in underlying data CSV export","healthSummary":"High complexity + active churn — core v2 query logic evolving","duplication":{"clonedLines":70,"totalLines":544,"ratio":0.12867647058823528},"duplicationSummary":"CSV streaming + query logic - extract helpers"},{"id":"v2/SavedChartController","type":"controller","lineCount":82,"complexity":{"cyclomatic":5,"cognitive":7,"maxFunctionCyclomatic":5},"gitActivity":{"commits":1,"authors":1,"churn":1,"recentCommits":[{"hash":"ad5b9e5582","message":"feat: add dashboards and saved charts v2 controller with pagination for schedulers (#19718)","author":"Bruno Almeida","relativeDate":"12 days ago"}]},"domain":"Saved Charts","gitSummary":"Add paginated v2 endpoints for schedulers","healthSummary":"New v2 endpoint, clean","duplication":{"clonedLines":22,"totalLines":80,"ratio":0.275},"duplicationSummary":"TSOA imports only - v2 API migration pattern"},{"id":"validationController","type":"controller","lineCount":132,"complexity":{"cyclomatic":3,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":15,"authors":8,"churn":2,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"39474ff071","message":"fix: add option to validate only specified explores (#17026)","author":"Jose Rego","relativeDate":"5 months ago"},{"hash":"3d04a286ff","message":"chore: Replace all any types with AnyType (#13376)","author":"devin-ai-integration[bot]","relativeDate":"1 year ago"}]},"domain":"Integrations","gitSummary":"Add JSDoc summaries to API handler methods\nAdd option to validate only specified explores\nReplace all 'any' types with AnyType","healthSummary":"Simple wrapper, stable","duplication":{"clonedLines":42,"totalLines":130,"ratio":0.3230769230769231},"duplicationSummary":"HIGH: TSOA imports + validation types - mostly boilerplate"},{"id":"apiV1Router","type":"router","lineCount":338,"complexity":{"cyclomatic":35,"cognitive":32,"maxFunctionCyclomatic":10},"gitActivity":{"commits":51,"authors":13,"churn":8,"recentCommits":[{"hash":"348ebd87e9","message":"fix: preserve query params in Slack auth redirect (#19526)","author":"Irakli Janiashvili","relativeDate":"3 weeks ago"},{"hash":"a680d23f72","message":"feat: process Slack messages after OAuth authentication completes (#19525)","author":"Irakli Janiashvili","relativeDate":"3 weeks ago"},{"hash":"5862adebd4","message":"fix: handle undefined req.user in user endpoints (#18888)","author":"Yegor Borisenco","relativeDate":"7 weeks ago"}]},"domain":"Infrastructure","gitSummary":"Preserve query params in Slack auth redirect\nProcess Slack messages after OAuth completion\nHandle undefined user in endpoint validation","healthSummary":"High cognitive (32) + churn — routing complexity, refactor?","duplication":{"clonedLines":0,"totalLines":336,"ratio":0}},{"id":"dashboardRouter","type":"router","lineCount":178,"complexity":{"cyclomatic":16,"cognitive":7,"maxFunctionCyclomatic":2},"gitActivity":{"commits":21,"authors":9,"churn":3,"recentCommits":[{"hash":"d674b0c9d1","message":"chore: move scheduler calls to dashboard & chart controllers (#19695)","author":"Bruno Almeida","relativeDate":"12 days ago"},{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"0299884c6c","message":"feat: allow fetching dashboards and charts by slug (#17292)","author":"Steve Gardner","relativeDate":"4 months ago"}]},"domain":"Dashboards","gitSummary":"Move scheduler calls from routes to controllers\nImprove tsconfig for incremental builds\nAllow fetching dashboards by slug","healthSummary":"High coupling (5 edges) — central routing hub","duplication":{"clonedLines":0,"totalLines":176,"ratio":0}},{"id":"headlessBrowser","type":"router","lineCount":231,"complexity":{"cyclomatic":29,"cognitive":43,"maxFunctionCyclomatic":9},"gitActivity":{"commits":17,"authors":9,"churn":2,"recentCommits":[{"hash":"7217a1ff16","message":"chore: add detailed logging for headless browser authentication (#19349)","author":"Jose Rego","relativeDate":"4 weeks ago"},{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"d66c8ff38b","message":"chore: deploy previews with okteto (#14925)","author":"Oliver Laslett","relativeDate":"8 months ago"}]},"domain":"Integrations","gitSummary":"Add detailed logging for browser auth\nImprove tsconfig for incremental builds\nDeploy previews with Okteto","healthSummary":"Highest cognitive (43) — screenshot/PDF logic is complex","duplication":{"clonedLines":0,"totalLines":229,"ratio":0}},{"id":"inviteLinksRouter","type":"router","lineCount":68,"complexity":{"cyclomatic":6,"cognitive":3,"maxFunctionCyclomatic":2},"gitActivity":{"commits":7,"authors":5,"churn":1,"recentCommits":[{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"acf7af7671","message":"chore: no unchecked index values (#13418)","author":"Javier Rengel Jiménez","relativeDate":"1 year ago"},{"hash":"6203ced1ef","message":"chore: migrate routes to use ServiceRepository (#9242)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"User Auth","gitSummary":"Improve tsconfig for incremental builds\nDisallow unchecked index access\nMigrate routes to ServiceRepository pattern","healthSummary":"Simple routing, stable","duplication":{"clonedLines":0,"totalLines":66,"ratio":0}},{"id":"jobsRouter","type":"router","lineCount":32,"complexity":{"cyclomatic":3,"cognitive":1,"maxFunctionCyclomatic":2},"gitActivity":{"commits":5,"authors":4,"churn":1,"recentCommits":[{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"6203ced1ef","message":"chore: migrate routes to use ServiceRepository (#9242)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"},{"hash":"b83d08d5d1","message":"feat: refresh command (#3627)","author":"Jose Rego","relativeDate":"3 years, 3 months ago"}]},"domain":"Scheduling","gitSummary":"Improve tsconfig for incremental builds\nMigrate routes to ServiceRepository pattern\nAdd refresh command functionality","healthSummary":"Minimal routing logic","duplication":{"clonedLines":0,"totalLines":30,"ratio":0}},{"id":"mcpRouter","type":"router","lineCount":226,"complexity":{"cyclomatic":24,"cognitive":34,"maxFunctionCyclomatic":12},"gitActivity":{"commits":8,"authors":5,"churn":7,"recentCommits":[{"hash":"b1291b28b7","message":"feat: support service account authentication for MCP (#19738)","author":"Javier Rengel Jiménez","relativeDate":"11 days ago"},{"hash":"cf3788b8a7","message":"chore: allow mcp user attribute overrides (#18521)","author":"João Viana","relativeDate":"9 weeks ago"},{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"}]},"domain":"Integrations","gitSummary":"Support service account auth for MCP\nAllow MCP user attribute overrides\nImprove tsconfig for incremental builds","healthSummary":"High cognitive (34) + active churn — MCP protocol evolving","duplication":{"clonedLines":0,"totalLines":224,"ratio":0}},{"id":"oauthRouter","type":"router","lineCount":438,"complexity":{"cyclomatic":54,"cognitive":70,"maxFunctionCyclomatic":15},"gitActivity":{"commits":8,"authors":5,"churn":6,"recentCommits":[{"hash":"67b322ef64","message":"feat: improve oauth page styling (#18075)","author":"Oliver Laslett","relativeDate":"3 months ago"},{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"c84ecf1d4e","message":"feat: add MCP server protected resource discovery endpoint (#16618)","author":"Irakli Janiashvili","relativeDate":"5 months ago"}]},"domain":"User Auth","gitSummary":"Improve OAuth page styling\nImprove tsconfig for incremental builds\nAdd MCP resource discovery endpoint","healthSummary":"Highest complexity (70) — OAuth flow maze, simplify","duplication":{"clonedLines":18,"totalLines":436,"ratio":0.04128440366972477},"duplicationSummary":"OAuth flow logic - investigate for extraction opportunities"},{"id":"organizationRouter","type":"router","lineCount":94,"complexity":{"cyclomatic":8,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":24,"authors":11,"churn":1,"recentCommits":[{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"862a7fbd26","message":"feat: add --skip-copy-content option to preview and start-preview commands (#15549)","author":"Bruno Almeida","relativeDate":"8 months ago"},{"hash":"46889c2050","message":"chore: move project creation to scheduler (#12570)","author":"Jose Rego","relativeDate":"1 year, 2 months ago"}]},"domain":"Organizations","gitSummary":"Improve tsconfig for incremental builds\nAdd skip-copy-content option for previews\nMove project creation to scheduler","healthSummary":"Standard routing, stable recently","duplication":{"clonedLines":0,"totalLines":92,"ratio":0}},{"id":"passwordResetLinksRouter","type":"router","lineCount":32,"complexity":{"cyclomatic":4,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":3,"churn":1,"recentCommits":[{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"6203ced1ef","message":"chore: migrate routes to use ServiceRepository (#9242)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"},{"hash":"04e52d8d55","message":"feat: Reset password (#1119)","author":"Jose Rego","relativeDate":"4 years, 1 month ago"}]},"domain":"User Auth","gitSummary":"Improve tsconfig for incremental builds\nMigrate routes to ServiceRepository pattern\nAdd password reset functionality","healthSummary":"Minimal logic, stable","duplication":{"clonedLines":0,"totalLines":30,"ratio":0}},{"id":"projectRouter","type":"router","lineCount":326,"complexity":{"cyclomatic":28,"cognitive":14,"maxFunctionCyclomatic":4},"gitActivity":{"commits":93,"authors":12,"churn":2,"recentCommits":[{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"83b413d4fe","message":"chore: track search on ai vs omnibar (#17478)","author":"João Viana","relativeDate":"4 months ago"},{"hash":"9b573a7203","message":"feat: refactor Project and Organaization services to enable iframe explores (#16143)","author":"Steve Gardner","relativeDate":"6 months ago"}]},"domain":"Projects","gitSummary":"Improve tsconfig for incremental builds\nTrack search on AI vs omnibar analytics\nRefactor services for iframe explores support","healthSummary":"High coupling (5 edges) — project operations hub","duplication":{"clonedLines":38,"totalLines":324,"ratio":0.11728395061728394},"duplicationSummary":"File download security - extract downloadFileMiddleware.ts"},{"id":"savedChartRouter","type":"router","lineCount":159,"complexity":{"cyclomatic":14,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":19,"authors":7,"churn":3,"recentCommits":[{"hash":"d674b0c9d1","message":"chore: move scheduler calls to dashboard & chart controllers (#19695)","author":"Bruno Almeida","relativeDate":"12 days ago"},{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"0299884c6c","message":"feat: allow fetching dashboards and charts by slug (#17292)","author":"Steve Gardner","relativeDate":"4 months ago"}]},"domain":"Saved Charts","gitSummary":"Move scheduler calls from routes to controllers\nImprove tsconfig for incremental builds\nAllow fetching charts by slug","healthSummary":"Moderate routing, active changes","duplication":{"clonedLines":54,"totalLines":157,"ratio":0.34394904458598724},"duplicationSummary":"HIGH: router response patterns - check for middleware opportunity"},{"id":"userRouter","type":"router","lineCount":123,"complexity":{"cyclomatic":17,"cognitive":10,"maxFunctionCyclomatic":2},"gitActivity":{"commits":16,"authors":7,"churn":1,"recentCommits":[{"hash":"bdf0e99b45","message":"chore: improve tsconfig for incremental builds (#17482)","author":"Steve Gardner","relativeDate":"4 months ago"},{"hash":"6dae07b7fa","message":"feat: list personal access tokens via API with PAT authentication (#13826)","author":"Jose Rego","relativeDate":"12 months ago"},{"hash":"6203ced1ef","message":"chore: migrate routes to use ServiceRepository (#9242)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"}]},"domain":"User Auth","gitSummary":"Improve tsconfig for incremental builds\nList personal access tokens via API\nMigrate routes to ServiceRepository pattern","healthSummary":"High branching (17) — many user operations","duplication":{"clonedLines":0,"totalLines":121,"ratio":0}},{"id":"AnalyticsService","type":"service","lineCount":166,"complexity":{"cyclomatic":10,"cognitive":10,"maxFunctionCyclomatic":3},"gitActivity":{"commits":14,"authors":6,"churn":1,"recentCommits":[{"hash":"70288f5f44","message":"feat: add unused content dashboard to analytics (#16757)","author":"Javier Rengel Jiménez","relativeDate":"5 months ago"},{"hash":"872355ee41","message":"fix: download raw usage analytics (#14471)","author":"Javier Rengel Jiménez","relativeDate":"10 months ago"},{"hash":"0706a0e080","message":"fix: fix some ANyTypes across our codebase (#13406)","author":"Javier Rengel Jiménez","relativeDate":"1 year ago"}]},"domain":"Analytics","gitSummary":"Add unused content dashboard to analytics\nFix raw usage analytics download\nFix remaining AnyType usage across codebase","healthSummary":"Small, focused — good analytics tracking","duplication":{"clonedLines":36,"totalLines":164,"ratio":0.21951219512195122},"duplicationSummary":"Analytics tracking patterns - extract trackingHelpers.ts"},{"id":"AsyncQueryService","type":"service","lineCount":3487,"complexity":{"cyclomatic":278,"cognitive":375,"maxFunctionCyclomatic":28},"gitActivity":{"commits":134,"authors":10,"churn":63,"recentCommits":[{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"7a080decf4","message":"fix: support empty index pivoting (#19728)","author":"Bruno Almeida","relativeDate":"9 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"}]},"domain":"Explores","gitSummary":"Add conditional inheritance chain check\nSupport empty index pivoting\nBump prettier and organize imports","healthSummary":"God service — 38 edges, 375 cognitive, split urgently"},{"id":"CatalogService","type":"service","lineCount":1533,"complexity":{"cyclomatic":163,"cognitive":163,"maxFunctionCyclomatic":10},"gitActivity":{"commits":92,"authors":9,"churn":23,"recentCommits":[{"hash":"fe9df9ed4f","message":"fix: default time dimension selection for metrics on canvas (#20060)","author":"Giorgi Bagdavadze","relativeDate":"35 hours ago"},{"hash":"6ff95b3213","message":"feat: remove canvas view based on metrics limitation (#19958)","author":"Tatiana Inama","relativeDate":"3 days ago"},{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"}]},"domain":"Catalog","gitSummary":"Fix default time dimension for canvas metrics\nRemove canvas view for metrics with limitations\nCheck inheritance chain for space access","healthSummary":"High complexity + active churn — catalog discovery evolving"},{"id":"ChangesetService","type":"service","lineCount":178,"complexity":{"cyclomatic":14,"cognitive":12,"maxFunctionCyclomatic":3},"gitActivity":{"commits":4,"authors":2,"churn":4,"recentCommits":[{"hash":"c76bd9635b","message":"fix: if a change is deleted, show it as reverted in the Agent ui (#17275)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"},{"hash":"1fbe7b94b8","message":"feat: implement catalog revert functionality for changeset changes (#17259)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"},{"hash":"3a699bef93","message":"feat: add API endpoints to revert changes in changesets (#17235)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"}]},"domain":"Catalog","gitSummary":"Show deleted changes as reverted in Agent UI\nImplement catalog revert for changeset changes\nAdd API endpoints to revert changes","healthSummary":"Small, focused — changeset tracking","duplication":{"clonedLines":0,"totalLines":176,"ratio":0}},{"id":"CoderService","type":"service","lineCount":1511,"complexity":{"cyclomatic":147,"cognitive":167,"maxFunctionCyclomatic":13},"gitActivity":{"commits":33,"authors":9,"churn":9,"recentCommits":[{"hash":"d7f8f06b43","message":"fix: include parameters in ChartAsCode for CLI round-trip (#20011)","author":"Charlie Dowler","relativeDate":"2 days ago"},{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"},{"hash":"27f878af03","message":"chore: handle inherit/isPrivate during space creation (#19928)","author":"Lukas Spiss","relativeDate":"4 days ago"}]},"domain":"Projects","gitSummary":"Include parameters in ChartAsCode for CLI\nCheck inheritance chain for space access\nHandle inherit/isPrivate during space creation","healthSummary":"High complexity, stable — code generation hub"},{"id":"CommentService","type":"service","lineCount":364,"complexity":{"cyclomatic":27,"cognitive":29,"maxFunctionCyclomatic":4},"gitActivity":{"commits":20,"authors":11,"churn":4,"recentCommits":[{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"67a8460b89","message":"feat: add dashboard comments feature flag and configuration (#17512)","author":"Yegor Borisenco","relativeDate":"4 months ago"}]},"domain":"Notifications","gitSummary":"Add conditional inheritance chain check\nBump prettier and organize imports\nAdd dashboard comments feature flag","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":52,"totalLines":362,"ratio":0.143646408839779},"duplicationSummary":"Comment CRUD patterns - check for base service opportunity"},{"id":"ContentService","type":"service","lineCount":324,"complexity":{"cyclomatic":30,"cognitive":28,"maxFunctionCyclomatic":8},"gitActivity":{"commits":11,"authors":6,"churn":4,"recentCommits":[{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"}]},"domain":"Content","gitSummary":"Check inheritance chain for space access\nBump prettier and organize imports\nConsolidate NotExistsError and NotFoundError","healthSummary":"Moderate complexity, active — content API evolving","duplication":{"clonedLines":88,"totalLines":322,"ratio":0.2732919254658385},"duplicationSummary":"Feature flag checks - extract getFeatureFlagForUser helper"},{"id":"CsvService","type":"service","lineCount":1477,"complexity":{"cyclomatic":141,"cognitive":164,"maxFunctionCyclomatic":15},"gitActivity":{"commits":119,"authors":21,"churn":12,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"05100432b4","message":"fix: implement stream backpressure handling for file uploads (#19631)","author":"Yegor Borisenco","relativeDate":"13 days ago"},{"hash":"d1f7024627","message":"fix: replace logger.warning with logger.warn method (#19380)","author":"Irakli Janiashvili","relativeDate":"4 weeks ago"}]},"domain":"Scheduling","gitSummary":"Bump prettier and organize imports\nImplement stream backpressure for file uploads\nReplace logger.warning with logger.warn","healthSummary":"High complexity + churn — CSV export/download logic"},{"id":"DashboardService","type":"service","lineCount":1458,"complexity":{"cyclomatic":129,"cognitive":130,"maxFunctionCyclomatic":11},"gitActivity":{"commits":102,"authors":19,"churn":8,"recentCommits":[{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"}]},"domain":"Dashboards","gitSummary":"Add conditional inheritance chain check\nCheck inheritance chain for space access\nBump prettier and organize imports","healthSummary":"High complexity, stable — core dashboard business logic"},{"id":"DownloadFileService","type":"service","lineCount":42,"complexity":{"cyclomatic":6,"cognitive":5,"maxFunctionCyclomatic":3},"gitActivity":{"commits":4,"authors":4,"churn":0,"recentCommits":[{"hash":"67101488a0","message":"chore: introduce BaseService (#9672)","author":"Filipe Dobreira","relativeDate":"1 year, 10 months ago"},{"hash":"2ae2f19057","message":"fix: analytics dependency injection (#9176)","author":"Jose Rego","relativeDate":"1 year, 11 months ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"}]},"domain":"Scheduling","gitSummary":"Introduce BaseService pattern\nFix analytics dependency injection\nRename type dependencies","healthSummary":"Tiny wrapper, stable","duplication":{"clonedLines":0,"totalLines":40,"ratio":0}},{"id":"FeatureFlagService","type":"service","domain":"Integrations","healthSummary":"Empty placeholder — check implementation"},{"id":"FunnelService","type":"service","lineCount":534,"complexity":{"cyclomatic":43,"cognitive":61,"maxFunctionCyclomatic":9},"gitActivity":{"commits":7,"authors":2,"churn":7,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"fa6ebfce7e","message":"fix: funnel builder sql + state management (#19609)","author":"Oliver Laslett","relativeDate":"3 weeks ago"},{"hash":"5355d34156","message":"feat: improved frontend and backend error handling for funnel builder service (#19581)","author":"Oliver Laslett","relativeDate":"3 weeks ago"}]},"domain":"Explores","gitSummary":"Bump prettier and organize imports\nFix funnel builder SQL & state management\nImprove error handling for funnel builder","healthSummary":"High complexity + high churn (7/7) — new feature, rapid iteration","duplication":{"clonedLines":0,"totalLines":532,"ratio":0}},{"id":"GdriveService","type":"service","lineCount":127,"complexity":{"cyclomatic":6,"cognitive":7,"maxFunctionCyclomatic":5},"gitActivity":{"commits":13,"authors":9,"churn":2,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"ff8480bf04","message":"fix: add new permission check for gsheets (#16489)","author":"Javier Rengel Jiménez","relativeDate":"6 months ago"},{"hash":"9b573a7203","message":"feat: refactor Project and Organaization services to enable iframe explores (#16143)","author":"Steve Gardner","relativeDate":"6 months ago"}]},"domain":"Integrations","gitSummary":"Bump prettier and organize imports\nAdd permission check for Google Sheets\nRefactor services for iframe explores support","healthSummary":"Small integration wrapper","duplication":{"clonedLines":0,"totalLines":125,"ratio":0}},{"id":"GitIntegrationService","type":"service","lineCount":1085,"complexity":{"cyclomatic":79,"cognitive":107,"maxFunctionCyclomatic":10},"gitActivity":{"commits":39,"authors":12,"churn":5,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"7a082cd0ac","message":"feat: add GitHub App installation authentication support to GitHub and GitLab client functions (#19716)","author":"Lightdash Bot","relativeDate":"11 days ago"},{"hash":"2757f30457","message":"feat: add editor for yml files (#18788)","author":"Oliver Laslett","relativeDate":"8 weeks ago"}]},"domain":"Git Integration","gitSummary":"Bump prettier and organize imports\nAdd GitHub App installation auth support\nAdd YAML file editor functionality","healthSummary":"High complexity, stable — git integration hub"},{"id":"GithubAppService","type":"service","lineCount":313,"complexity":{"cyclomatic":31,"cognitive":39,"maxFunctionCyclomatic":11},"gitActivity":{"commits":11,"authors":4,"churn":2,"recentCommits":[{"hash":"6fb49e6343","message":"feat: implement pagination for GitHub repositories and improve UI display (#19922)","author":"Javier Rengel Jiménez","relativeDate":"5 days ago"},{"hash":"6abb1976a6","message":"fix: improve github error messages (#16830)","author":"Javier Rengel Jiménez","relativeDate":"5 months ago"},{"hash":"35cd889de8","message":"chore: fix and enable `useUnknownInCatchVariables` on all packages (#13375)","author":"devin-ai-integration[bot]","relativeDate":"1 year ago"}]},"domain":"Git Integration","gitSummary":"Add pagination for GitHub repositories\nImprove GitHub error messages\nEnable useUnknownInCatchVariables for safety","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":13,"totalLines":311,"ratio":0.04180064308681672},"duplicationSummary":"OAuth validation - extract validateOAuthCallback utility"},{"id":"GitlabAppService","type":"service","lineCount":336,"complexity":{"cyclomatic":34,"cognitive":37,"maxFunctionCyclomatic":11},"gitActivity":{"commits":1,"authors":1,"churn":1,"recentCommits":[{"hash":"43c4b82352","message":"feat: gitlab integration (#16633)","author":"Javier Rengel Jiménez","relativeDate":"5 months ago"}]},"domain":"Git Integration","gitSummary":"Add GitLab integration support","healthSummary":"New feature, single commit — parallel to GitHub","duplication":{"clonedLines":13,"totalLines":334,"ratio":0.038922155688622756},"duplicationSummary":"OAuth validation - extract validateOAuthCallback utility"},{"id":"GroupService","type":"service","lineCount":414,"complexity":{"cyclomatic":40,"cognitive":56,"maxFunctionCyclomatic":6},"gitActivity":{"commits":15,"authors":8,"churn":2,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"2b7007e319","message":"fix: migrate project access to new endpoints (#16570)","author":"Javier Rengel Jiménez","relativeDate":"6 months ago"},{"hash":"61f874637f","message":"feat: add group service enablement check with config integration (#15842)","author":"Irakli Janiashvili","relativeDate":"7 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Bump prettier and organize imports\nMigrate project access to new endpoints\nAdd group service enablement check","healthSummary":"Moderate complexity, stable — group management","duplication":{"clonedLines":216,"totalLines":412,"ratio":0.5242718446601942},"duplicationSummary":"CRITICAL: 52% duplication - major refactoring opportunity"},{"id":"HealthService","type":"service","lineCount":257,"complexity":{"cyclomatic":22,"cognitive":18,"maxFunctionCyclomatic":12},"gitActivity":{"commits":75,"authors":16,"churn":19,"recentCommits":[{"hash":"022481bae0","message":"feat: add dashboard tile and tab limits with configuration (#19791)","author":"Jose Rego","relativeDate":"9 days ago"},{"hash":"ec3ac3c3b4","message":"feat: configure help menu icon behavior (#19731)","author":"agha4to","relativeDate":"10 days ago"},{"hash":"83205d8079","message":"feat: configure signup URL (#19602)","author":"agha4to","relativeDate":"2 weeks ago"}]},"domain":"Infrastructure","gitSummary":"Add dashboard tile and tab limits config\nConfigure help menu icon behavior\nConfigure signup URL","healthSummary":"High churn (19/75) — health checks frequently adjusted","duplication":{"clonedLines":0,"totalLines":255,"ratio":0}},{"id":"LightdashAnalyticsService","type":"service","lineCount":68,"complexity":{"cyclomatic":5,"cognitive":5,"maxFunctionCyclomatic":4},"gitActivity":{"commits":2,"authors":1,"churn":1,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"f411becc9d","message":"chore: add deprecation notice to legacy results endpoints (#14123)","author":"Bruno Almeida","relativeDate":"11 months ago"}]},"domain":"Analytics","gitSummary":"Bump prettier and organize imports\nAdd deprecation notice to legacy endpoints","healthSummary":"Small, focused analytics","duplication":{"clonedLines":0,"totalLines":66,"ratio":0}},{"id":"MetricsExplorerService","type":"service","lineCount":371,"complexity":{"cyclomatic":16,"cognitive":19,"maxFunctionCyclomatic":7},"gitActivity":{"commits":41,"authors":7,"churn":8,"recentCommits":[{"hash":"fe9df9ed4f","message":"fix: default time dimension selection for metrics on canvas (#20060)","author":"Giorgi Bagdavadze","relativeDate":"35 hours ago"},{"hash":"6c3af36fb7","message":"refactor: remove deprecated metrics explorer query endpoint (#20053)","author":"Giorgi Bagdavadze","relativeDate":"2 days ago"},{"hash":"d913502224","message":"feat: add rolling days comparison option to metrics explorer (#19959)","author":"Giorgi Bagdavadze","relativeDate":"2 days ago"}]},"domain":"Explores","gitSummary":"Fix default time dimension for canvas metrics\nRemove deprecated query endpoint\nAdd rolling days comparison option","healthSummary":"Moderate size + active churn (8) — metrics exploration evolving","duplication":{"clonedLines":54,"totalLines":369,"ratio":0.14634146341463414},"duplicationSummary":"Metrics query patterns - check for shared builder logic"},{"id":"NotificationService","type":"service","domain":"Notifications","healthSummary":"Empty placeholder — check implementation"},{"id":"OauthService","type":"service","lineCount":124,"complexity":{"cyclomatic":12,"cognitive":5,"maxFunctionCyclomatic":3},"domain":"User Auth","healthSummary":"Small OAuth utilities"},{"id":"OrganizationService","type":"service","lineCount":762,"complexity":{"cyclomatic":92,"cognitive":98,"maxFunctionCyclomatic":6},"gitActivity":{"commits":66,"authors":14,"churn":5,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"9db17776dc","message":"fix(backend): allow for filtering users with google refresh token (#19161)","author":"Bruno Almeida","relativeDate":"5 weeks ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"}]},"domain":"Organizations","gitSummary":"Bump prettier and organize imports\nFilter users with Google refresh token\nConsolidate NotExistsError and NotFoundError","healthSummary":"High complexity, stable — org management hub","duplication":{"clonedLines":28,"totalLines":760,"ratio":0.03684210526315789},"duplicationSummary":"Low duplication - acceptable for large service"},{"id":"PermissionsService","type":"service","lineCount":90,"complexity":{"cyclomatic":13,"cognitive":15,"maxFunctionCyclomatic":5},"gitActivity":{"commits":7,"authors":3,"churn":7,"recentCommits":[{"hash":"315f897caa","message":"feat: add stricter embed chart permissions (#18022)","author":"Steve Gardner","relativeDate":"3 months ago"},{"hash":"d50de3baf8","message":"feat: support chart type jwt tokens (#17615)","author":"Javier Rengel Jiménez","relativeDate":"3 months ago"},{"hash":"38edc6bde4","message":"feat: add charts to embedding table (#17596)","author":"Steve Gardner","relativeDate":"3 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Add stricter embed chart permissions\nSupport chart type JWT tokens\nAdd charts to embedding table","healthSummary":"Active churn (7) — CASL permissions evolving","duplication":{"clonedLines":0,"totalLines":88,"ratio":0}},{"id":"PersonalAccessTokenService","type":"service","lineCount":157,"complexity":{"cyclomatic":19,"cognitive":24,"maxFunctionCyclomatic":7},"gitActivity":{"commits":8,"authors":5,"churn":1,"recentCommits":[{"hash":"70dde7182b","message":"fix: validate pat expiration when on dst transition (#17276)","author":"João Viana","relativeDate":"4 months ago"},{"hash":"d3be60ba91","message":"feat: limit personal access token's access and expiration time (#12473)","author":"Jose Rego","relativeDate":"1 year, 3 months ago"},{"hash":"f8ad8d4662","message":"feat: allow to rotate personal access token (#12411)","author":"Jose Rego","relativeDate":"1 year, 3 months ago"}]},"domain":"User Auth","gitSummary":"Validate PAT expiration during DST transition\nLimit PAT access and expiration time\nAllow personal access token rotation","healthSummary":"Token management, stable","duplication":{"clonedLines":14,"totalLines":155,"ratio":0.09032258064516129},"duplicationSummary":"Token rotation logic - extract tokenHelpers.ts"},{"id":"PinningService","type":"service","lineCount":147,"complexity":{"cyclomatic":12,"cognitive":9,"maxFunctionCyclomatic":3},"gitActivity":{"commits":13,"authors":8,"churn":1,"recentCommits":[{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"},{"hash":"35e433dcdc","message":"fix: remove n+1 query by fetching user access from multiple spaces (#10350)","author":"Jose Rego","relativeDate":"1 year, 8 months ago"},{"hash":"67101488a0","message":"chore: introduce BaseService (#9672)","author":"Filipe Dobreira","relativeDate":"1 year, 10 months ago"}]},"domain":"Content","gitSummary":"Check inheritance chain for space access\nRemove N+1 query for space user access\nIntroduce BaseService pattern","healthSummary":"Small, focused — pin/unpin logic","duplication":{"clonedLines":31,"totalLines":145,"ratio":0.21379310344827587},"duplicationSummary":"Feature flag checks - extract getFeatureFlagForUser helper"},{"id":"PivotTableService","type":"service","lineCount":314,"complexity":{"cyclomatic":24,"cognitive":20,"maxFunctionCyclomatic":7},"gitActivity":{"commits":8,"authors":5,"churn":7,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"d1f7024627","message":"fix: replace logger.warning with logger.warn method (#19380)","author":"Irakli Janiashvili","relativeDate":"4 weeks ago"},{"hash":"a7249ac540","message":"fix: add error handling when deleting local files (#19275)","author":"Jose Rego","relativeDate":"4 weeks ago"}]},"domain":"Explores","gitSummary":"Bump prettier and organize imports\nReplace logger.warning with logger.warn\nAdd error handling for local file deletion","healthSummary":"Moderate complexity + churn — pivot table logic iterating","duplication":{"clonedLines":33,"totalLines":312,"ratio":0.10576923076923077},"duplicationSummary":"Pivot logic patterns - investigate for extraction"},{"id":"ProjectCompileLogService","type":"service","lineCount":98,"complexity":{"cyclomatic":8,"cognitive":9,"maxFunctionCyclomatic":4},"gitActivity":{"commits":1,"authors":1,"churn":1,"recentCommits":[{"hash":"4353a812bc","message":"feat(backend): project compile log model, service and controller (#17577)","author":"Tatiana Inama","relativeDate":"3 months ago"}]},"domain":"Projects","gitSummary":"Add project compile log tracking","healthSummary":"Small logging service","duplication":{"clonedLines":0,"totalLines":96,"ratio":0}},{"id":"ProjectParametersService","type":"service","lineCount":71,"complexity":{"cyclomatic":4,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":4,"authors":2,"churn":3,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"a075a3e8f3","message":"feat: add model-level parameters to project parameters list (#16418)","author":"Yegor Borisenco","relativeDate":"6 months ago"},{"hash":"a707f3187b","message":"feat: project parameters api (#16369)","author":"Yegor Borisenco","relativeDate":"6 months ago"}]},"domain":"Projects","gitSummary":"Bump prettier and organize imports\nAdd model-level parameters to list\nAdd project parameters API","healthSummary":"Small, active (3/4) — parameters feature evolving","duplication":{"clonedLines":0,"totalLines":69,"ratio":0}},{"id":"ProjectService","type":"service","lineCount":7206,"complexity":{"cyclomatic":745,"cognitive":889,"maxFunctionCyclomatic":28},"gitActivity":{"commits":510,"authors":27,"churn":60,"recentCommits":[{"hash":"6c3af36fb7","message":"refactor: remove deprecated metrics explorer query endpoint (#20053)","author":"Giorgi Bagdavadze","relativeDate":"2 days ago"},{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"}]},"domain":"Projects","gitSummary":"Remove deprecated metrics explorer query endpoint\nAdd conditional inheritance chain check\nCheck inheritance chain for space access","healthSummary":"God service — 49 edges, 889 cognitive, urgent split needed"},{"id":"PromoteService","type":"service","lineCount":1556,"complexity":{"cyclomatic":161,"cognitive":211,"maxFunctionCyclomatic":15},"gitActivity":{"commits":23,"authors":9,"churn":5,"recentCommits":[{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"},{"hash":"27f878af03","message":"chore: handle inherit/isPrivate during space creation (#19928)","author":"Lukas Spiss","relativeDate":"4 days ago"}]},"domain":"Content","gitSummary":"Add conditional inheritance chain check\nCheck inheritance chain for space access\nHandle inherit/isPrivate during space creation","healthSummary":"High complexity, stable — promotion logic (content migration?)"},{"id":"RenameService","type":"service","lineCount":785,"complexity":{"cyclomatic":79,"cognitive":90,"maxFunctionCyclomatic":15},"gitActivity":{"commits":10,"authors":5,"churn":4,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"},{"hash":"0d5c02f87a","message":"fix: custom metric sql templates and filters not updated on rename (#18146)","author":"Tatiana Inama","relativeDate":"3 months ago"}]},"domain":"Content","gitSummary":"Bump prettier and organize imports\nConsolidate NotExistsError and NotFoundError\nFix custom metric SQL templates on rename","healthSummary":"High complexity, stable — rename refactoring logic","duplication":{"clonedLines":0,"totalLines":783,"ratio":0}},{"id":"RolesService","type":"service","lineCount":1010,"complexity":{"cyclomatic":95,"cognitive":123,"maxFunctionCyclomatic":8},"gitActivity":{"commits":12,"authors":4,"churn":12,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"88a6b62f87","message":"fix: add descriptive error messages for permission failures (#19332)","author":"Javier Rengel Jiménez","relativeDate":"4 weeks ago"},{"hash":"83acbda277","message":"perf: wrap getAllByOrganizationUuid calls with Sentry transactions (#18652)","author":"Javier Rengel Jiménez","relativeDate":"9 weeks ago"}]},"domain":"Roles & Permissions","gitSummary":"Bump prettier and organize imports\nAdd descriptive permission failure messages\nWrap getAllByOrganizationUuid in Sentry trace","healthSummary":"High complexity + active churn (12) — roles/permissions evolving"},{"id":"SavedChartService","type":"service","domain":"Saved Charts","healthSummary":"Empty placeholder — check implementation"},{"id":"SavedSqlService","type":"service","lineCount":614,"complexity":{"cyclomatic":57,"cognitive":71,"maxFunctionCyclomatic":11},"gitActivity":{"commits":26,"authors":7,"churn":2,"recentCommits":[{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"05e09a723c","message":"feat: resource bulk actions - move to another space (#14704)","author":"Irakli Janiashvili","relativeDate":"9 months ago"}]},"domain":"SQL Runner","gitSummary":"Add conditional inheritance chain check\nBump prettier and organize imports\nAdd bulk move to another space functionality","healthSummary":"Moderate complexity, stable — SQL query management","duplication":{"clonedLines":67,"totalLines":612,"ratio":0.10947712418300654},"duplicationSummary":"moveToSpace logic - extract SpaceOperationsService mixin"},{"id":"SchedulerService","type":"service","lineCount":1481,"complexity":{"cyclomatic":146,"cognitive":207,"maxFunctionCyclomatic":19},"gitActivity":{"commits":60,"authors":15,"churn":21,"recentCommits":[{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"fd8617718c","message":"feat: allow editors to send scheduled deliveries they didn't create (#19929)","author":"Javier Rengel Jiménez","relativeDate":"4 days ago"},{"hash":"e37376f95e","message":"feat: add Google Sheets scope error handling with re-authentication UI (#19882)","author":"Javier Rengel Jiménez","relativeDate":"5 days ago"}]},"domain":"Scheduling","gitSummary":"Add conditional inheritance chain check\nAllow editors to send others' deliveries\nAdd Google Sheets scope error handling","healthSummary":"High cognitive (207) + active churn (21) — scheduler is complex & changing"},{"id":"SearchService","type":"service","lineCount":267,"complexity":{"cyclomatic":36,"cognitive":22,"maxFunctionCyclomatic":6},"gitActivity":{"commits":29,"authors":9,"churn":3,"recentCommits":[{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"83b413d4fe","message":"chore: track search on ai vs omnibar (#17478)","author":"João Viana","relativeDate":"4 months ago"}]},"domain":"Analytics","gitSummary":"Check inheritance chain for space access\nBump prettier and organize imports\nTrack search on AI vs omnibar analytics","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":13,"totalLines":265,"ratio":0.04905660377358491},"duplicationSummary":"Feature flag checks - extract getFeatureFlagForUser helper"},{"id":"ShareService","type":"service","lineCount":99,"complexity":{"cyclomatic":7,"cognitive":6,"maxFunctionCyclomatic":3},"gitActivity":{"commits":6,"authors":5,"churn":0,"recentCommits":[{"hash":"67101488a0","message":"chore: introduce BaseService (#9672)","author":"Filipe Dobreira","relativeDate":"1 year, 10 months ago"},{"hash":"2ae2f19057","message":"fix: analytics dependency injection (#9176)","author":"Jose Rego","relativeDate":"1 year, 11 months ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"}]},"domain":"Content","gitSummary":"Introduce BaseService pattern\nFix analytics dependency injection\nRename type dependencies","healthSummary":"Small sharing utilities","duplication":{"clonedLines":0,"totalLines":97,"ratio":0}},{"id":"SlackIntegrationService","type":"service","lineCount":178,"complexity":{"cyclomatic":17,"cognitive":18,"maxFunctionCyclomatic":3},"gitActivity":{"commits":13,"authors":6,"churn":3,"recentCommits":[{"hash":"6156faf114","message":"feat: add project filtering for Slack multi-agent channel (#19456)","author":"Irakli Janiashvili","relativeDate":"3 weeks ago"},{"hash":"290d991737","message":"feat: use db cache for slack channel fetching (#18660)","author":"João Viana","relativeDate":"8 weeks ago"},{"hash":"4694c1a284","message":"feat: new slack channel selector component (#18492)","author":"Irakli Janiashvili","relativeDate":"9 weeks ago"}]},"domain":"Slack","gitSummary":"Add project filtering for multi-agent channel\nUse database cache for channel fetching\nAdd new Slack channel selector component","healthSummary":"Moderate complexity, active — Slack integration","duplication":{"clonedLines":29,"totalLines":176,"ratio":0.16477272727272727},"duplicationSummary":"Slack API patterns - check for slack client abstraction"},{"id":"SlackService","type":"service","lineCount":35,"complexity":{"cyclomatic":4,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":3,"authors":2,"churn":1,"recentCommits":[{"hash":"0f826d692b","message":"fix: slack client listener initialization (#16439)","author":"Irakli Janiashvili","relativeDate":"6 months ago"},{"hash":"3e719303f2","message":"chore: slackbot improvements (#3951)","author":"Javier Rengel Jiménez","relativeDate":"3 years, 2 months ago"},{"hash":"3c712b20c5","message":"feat: share in slack unfurl (#3852)","author":"Javier Rengel Jiménez","relativeDate":"3 years, 2 months ago"}]},"domain":"Slack","gitSummary":"Fix Slack client listener initialization\nImprove Slackbot functionality\nAdd share in Slack unfurl feature","healthSummary":"Tiny wrapper, stable","duplication":{"clonedLines":0,"totalLines":33,"ratio":0}},{"id":"SpacePermissionService","type":"service","domain":"Spaces","healthSummary":"Empty placeholder — check implementation"},{"id":"SpaceService","type":"service","lineCount":762,"complexity":{"cyclomatic":68,"cognitive":83,"maxFunctionCyclomatic":10},"gitActivity":{"commits":49,"authors":14,"churn":5,"recentCommits":[{"hash":"d18da7f3c7","message":"feat: implement `space.inherit_parent_permissions` update functionality (#19985)","author":"Lukas Spiss","relativeDate":"3 days ago"},{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"}]},"domain":"Spaces","gitSummary":"Implement inherit_parent_permissions update\nAdd conditional inheritance chain check\nCheck inheritance chain for space access","healthSummary":"High complexity, stable — space management hub","duplication":{"clonedLines":211,"totalLines":760,"ratio":0.2776315789473684},"duplicationSummary":"HIGH: moveToSpace + CRUD patterns - extract mixin/base class"},{"id":"SpotlightService","type":"service","lineCount":114,"complexity":{"cyclomatic":8,"cognitive":8,"maxFunctionCyclomatic":3},"gitActivity":{"commits":3,"authors":3,"churn":0,"recentCommits":[{"hash":"7d49a5afe4","message":"fix: resource org uuid check","author":"Jose Rego","relativeDate":"10 months ago"},{"hash":"5c23a86610","message":"chore: fix prettier organizeImportsSkipDestructiveCodeActions (#13393)","author":"Irakli Janiashvili","relativeDate":"1 year ago"},{"hash":"741731967a","message":"feat: allow curating Spotlight's table (#13355)","author":"João Viana","relativeDate":"1 year, 1 month ago"}]},"domain":"Analytics","gitSummary":"Add resource org UUID check\nFix prettier organize imports config\nAllow curating Spotlight's table","healthSummary":"Small new feature","duplication":{"clonedLines":30,"totalLines":112,"ratio":0.26785714285714285},"duplicationSummary":"Moderate duplication - check for spotlight-specific patterns"},{"id":"SshKeyPairService","type":"service","lineCount":22,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":3,"churn":0,"recentCommits":[{"hash":"67101488a0","message":"chore: introduce BaseService (#9672)","author":"Filipe Dobreira","relativeDate":"1 year, 10 months ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"},{"hash":"34e695b086","message":"feat: add ssh keypairs api (stacked 2) (#5616)","author":"Oliver Laslett","relativeDate":"2 years, 8 months ago"}]},"domain":"Infrastructure","gitSummary":"Introduce BaseService pattern\nRename type dependencies\nAdd SSH keypairs API","healthSummary":"Tiny SSH utilities","duplication":{"clonedLines":0,"totalLines":20,"ratio":0}},{"id":"UnfurlService","type":"service","lineCount":1478,"complexity":{"cyclomatic":172,"cognitive":255,"maxFunctionCyclomatic":54},"gitActivity":{"commits":118,"authors":17,"churn":32,"recentCommits":[{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"b0c0c8cfe8","message":"chore: remove legacy unfurl readiness checks (#19763)","author":"Lukas Spiss","relativeDate":"11 days ago"}]},"domain":"Slack","gitSummary":"Add conditional inheritance chain check\nBump prettier and organize imports\nRemove legacy unfurl readiness checks","healthSummary":"High cognitive (255) + high churn (32) — regression risk, needs tests"},{"id":"UserAttributesService","type":"service","lineCount":173,"complexity":{"cyclomatic":15,"cognitive":10,"maxFunctionCyclomatic":3},"gitActivity":{"commits":8,"authors":5,"churn":1,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"67101488a0","message":"chore: introduce BaseService (#9672)","author":"Filipe Dobreira","relativeDate":"1 year, 10 months ago"},{"hash":"2ae2f19057","message":"fix: analytics dependency injection (#9176)","author":"Jose Rego","relativeDate":"1 year, 11 months ago"}]},"domain":"Integrations","gitSummary":"Bump prettier and organize imports\nIntroduce BaseService pattern\nFix analytics dependency injection","healthSummary":"Small attribute management","duplication":{"clonedLines":0,"totalLines":171,"ratio":0}},{"id":"UserService","type":"service","lineCount":2007,"complexity":{"cyclomatic":254,"cognitive":307,"maxFunctionCyclomatic":45},"gitActivity":{"commits":129,"authors":18,"churn":9,"recentCommits":[{"hash":"e37376f95e","message":"feat: add Google Sheets scope error handling with re-authentication UI (#19882)","author":"Javier Rengel Jiménez","relativeDate":"5 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"}]},"domain":"User Auth","gitSummary":"Add Google Sheets scope error handling\nBump prettier and organize imports\nConsolidate NotExistsError and NotFoundError","healthSummary":"God service — 27 edges, 307 cognitive, split by concern"},{"id":"ValidationService","type":"service","lineCount":1086,"complexity":{"cyclomatic":158,"cognitive":184,"maxFunctionCyclomatic":18},"gitActivity":{"commits":75,"authors":13,"churn":22,"recentCommits":[{"hash":"1aee92d349","message":"feat: check for inheritance chain space access (#19937)","author":"Bruno Almeida","relativeDate":"4 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"9e8bde9efb","message":"fix: include charts from dashboards in validation error queries (#19758)","author":"Javier Rengel Jiménez","relativeDate":"11 days ago"}]},"domain":"Integrations","gitSummary":"Check inheritance chain for space access\nBump prettier and organize imports\nInclude dashboard charts in validation errors","healthSummary":"High complexity + active churn (22) — validation logic evolving"},{"id":"AnalyticsModel","type":"model","lineCount":424,"complexity":{"cyclomatic":39,"cognitive":17,"maxFunctionCyclomatic":6},"gitActivity":{"commits":20,"authors":7,"churn":1,"recentCommits":[{"hash":"70288f5f44","message":"feat: add unused content dashboard to analytics (#16757)","author":"Javier Rengel Jiménez","relativeDate":"5 months ago"},{"hash":"47c0c5506c","message":"feat: allow embeds to access spaces (#16203)","author":"Steve Gardner","relativeDate":"6 months ago"},{"hash":"872355ee41","message":"fix: download raw usage analytics (#14471)","author":"Javier Rengel Jiménez","relativeDate":"10 months ago"}]},"domain":"Analytics","gitSummary":"Add unused content dashboard to analytics\nAllow embeds to access spaces\nFix raw usage analytics download","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":20,"totalLines":422,"ratio":0.04739336492890995},"duplicationSummary":"Low duplication - acceptable for analytics aggregation"},{"id":"ProjectModel","type":"model","lineCount":2797,"complexity":{"cyclomatic":286,"cognitive":332,"maxFunctionCyclomatic":21},"gitActivity":{"commits":155,"authors":20,"churn":24,"recentCommits":[{"hash":"f48e943f86","message":"feat: add `inherit_parent_permissions` column to spaces (#19800)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"ee6db0d9fa","message":"feat: add partial compilation mode for fields with errors (#19278)","author":"Javier Rengel Jiménez","relativeDate":"4 weeks ago"},{"hash":"d07f9214ae","message":"feat: add roleUuid to project memberships and improve permission checks (#19247)","author":"Javier Rengel Jiménez","relativeDate":"4 weeks ago"}]},"domain":"Projects","gitSummary":"Add inherit_parent_permissions column to spaces\nAdd partial compilation for fields with errors\nAdd roleUuid to project memberships","healthSummary":"God model — 35 edges, 332 cognitive, central bottleneck"},{"id":"CommentModel","type":"model","lineCount":286,"complexity":{"cyclomatic":29,"cognitive":34,"maxFunctionCyclomatic":11},"gitActivity":{"commits":9,"authors":5,"churn":0,"recentCommits":[{"hash":"8ea4500769","message":"chore: re enable prettier plugin to organize imports (#13536)","author":"Irakli Janiashvili","relativeDate":"1 year ago"},{"hash":"3b37c25096","message":"fix: pre/post-process comment content in backend and frontend (#9359)","author":"Filipe Dobreira","relativeDate":"1 year, 11 months ago"},{"hash":"d74fa14b13","message":"feat: notify people in thread without mentions as well (#9261)","author":"João Viana","relativeDate":"1 year, 11 months ago"}]},"domain":"Notifications","gitSummary":"Re-enable prettier import organization\nPre/post-process comment content properly\nNotify thread participants without mentions","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":0,"totalLines":284,"ratio":0}},{"id":"DashboardModel","type":"model","lineCount":1431,"complexity":{"cyclomatic":112,"cognitive":90,"maxFunctionCyclomatic":14},"gitActivity":{"commits":90,"authors":15,"churn":7,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"6e7450d488","message":"fix: guard undefined with optional chaining (#19197)","author":"Yegor Borisenco","relativeDate":"5 weeks ago"},{"hash":"bb5f99377c","message":"feat: add divider option for dashboard heading tiles (#18966)","author":"Giorgi Bagdavadze","relativeDate":"7 weeks ago"}]},"domain":"Dashboards","gitSummary":"Bump prettier and organize imports\nGuard undefined with optional chaining\nAdd divider option for heading tiles","healthSummary":"High complexity, stable — core dashboard data"},{"id":"FeatureFlagModel","type":"model","lineCount":228,"complexity":{"cyclomatic":23,"cognitive":21,"maxFunctionCyclomatic":4},"gitActivity":{"commits":25,"authors":9,"churn":20,"recentCommits":[{"hash":"239153a729","message":"refactor: remove MetricExploreModalV1 and recharts dependency (#20018)","author":"João Viana","relativeDate":"2 days ago"},{"hash":"d10637cbac","message":"chore: add `NESTED_SPACES_PERMISSIONS_ENABLED` feature flag (#19815)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"b0c0c8cfe8","message":"chore: remove legacy unfurl readiness checks (#19763)","author":"Lukas Spiss","relativeDate":"11 days ago"}]},"domain":"Integrations","gitSummary":"Remove MetricExploreModalV1 and recharts\nAdd nested spaces permissions feature flag\nRemove legacy unfurl readiness checks","healthSummary":"Active churn (20/25) — flags frequently toggled/changed","duplication":{"clonedLines":0,"totalLines":226,"ratio":0}},{"id":"NotificationsModel","type":"model","lineCount":132,"complexity":{"cyclomatic":16,"cognitive":15,"maxFunctionCyclomatic":5},"gitActivity":{"commits":6,"authors":4,"churn":1,"recentCommits":[{"hash":"acaf567cf2","message":"feat(backend): add heading tile type for dashboards (#18807)","author":"Giorgi Bagdavadze","relativeDate":"8 weeks ago"},{"hash":"01e8e7f5ad","message":"feat: add space access to charts and dashboards + move space access to casl (#9226)","author":"Shifan Gu","relativeDate":"1 year, 11 months ago"},{"hash":"d74fa14b13","message":"feat: notify people in thread without mentions as well (#9261)","author":"João Viana","relativeDate":"1 year, 11 months ago"}]},"domain":"Notifications","gitSummary":"Add heading tile type for dashboards\nAdd space access to charts and dashboards\nNotify thread participants without mentions","healthSummary":"Small, stable","duplication":{"clonedLines":0,"totalLines":130,"ratio":0}},{"id":"SpaceModel","type":"model","lineCount":2803,"complexity":{"cyclomatic":197,"cognitive":249,"maxFunctionCyclomatic":18},"gitActivity":{"commits":87,"authors":12,"churn":12,"recentCommits":[{"hash":"d18da7f3c7","message":"feat: implement `space.inherit_parent_permissions` update functionality (#19985)","author":"Lukas Spiss","relativeDate":"3 days ago"},{"hash":"7decf44c25","message":"fix: getEffectiveSpaceAccess always adding org/project permissions when child had inherit set to true (#19971)","author":"Bruno Almeida","relativeDate":"3 days ago"},{"hash":"205f4e4124","message":"feat: add conditional inheritance chain check to model and fix all calls (#19947)","author":"Bruno Almeida","relativeDate":"3 days ago"}]},"domain":"Spaces","gitSummary":"Implement inherit_parent_permissions update\nFix getEffectiveSpaceAccess inheritance logic\nAdd conditional inheritance chain check","healthSummary":"High complexity + churn — space data layer evolving"},{"id":"UserModel","type":"model","lineCount":1070,"complexity":{"cyclomatic":113,"cognitive":130,"maxFunctionCyclomatic":7},"gitActivity":{"commits":78,"authors":13,"churn":10,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"2b090ca7a0","message":"feat: auto-verify emails for SCIM users when email is updated (#19362)","author":"Javier Rengel Jiménez","relativeDate":"4 weeks ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"}]},"domain":"User Auth","gitSummary":"Bump prettier and organize imports\nAuto-verify emails for SCIM user updates\nConsolidate NotExistsError and NotFoundError","healthSummary":"High complexity + churn — user data layer, monitor regressions"},{"id":"DownloadFileModel","type":"model","lineCount":141,"complexity":{"cyclomatic":14,"cognitive":6,"maxFunctionCyclomatic":2},"gitActivity":{"commits":5,"authors":4,"churn":0,"recentCommits":[{"hash":"6b15476110","message":"chore: remove semantic viewer types (#15567)","author":"magnew","relativeDate":"8 months ago"},{"hash":"11c099f5f1","message":"chore: capture S3Error when interacting with it (#13998)","author":"João Viana","relativeDate":"11 months ago"},{"hash":"4de4159900","message":"feat: streaming semantic layer (#11105)","author":"Javier Rengel Jiménez","relativeDate":"1 year, 6 months ago"}]},"domain":"Scheduling","gitSummary":"Remove semantic viewer types\nCapture S3Error when interacting with S3\nAdd streaming semantic layer support","healthSummary":"Small tracking model","duplication":{"clonedLines":0,"totalLines":139,"ratio":0}},{"id":"SavedChartModel","type":"model","lineCount":1783,"complexity":{"cyclomatic":179,"cognitive":184,"maxFunctionCyclomatic":12},"gitActivity":{"commits":122,"authors":15,"churn":15,"recentCommits":[{"hash":"f0b2b92280","message":"perf: optimize chart query to prevent cartesian product explosion (#19943)","author":"Javier Rengel Jiménez","relativeDate":"4 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"f76775c86f","message":"chore: add db + saved chart persistence for pop additional metrics (#19696)","author":"João Viana","relativeDate":"11 days ago"}]},"domain":"Saved Charts","gitSummary":"Optimize chart query to prevent cartesian product\nBump prettier and organize imports\nAdd PoP additional metrics persistence","healthSummary":"High complexity + churn — chart data layer"},{"id":"SavedSqlModel","type":"model","lineCount":389,"complexity":{"cyclomatic":35,"cognitive":38,"maxFunctionCyclomatic":11},"gitActivity":{"commits":15,"authors":5,"churn":1,"recentCommits":[{"hash":"dfdb26fdba","message":"feat: add SQL charts as code API endpoints (#18643)","author":"Javier Rengel Jiménez","relativeDate":"9 weeks ago"},{"hash":"05e09a723c","message":"feat: resource bulk actions - move to another space (#14704)","author":"Irakli Janiashvili","relativeDate":"9 months ago"},{"hash":"4849c53a62","message":"chore: remove duplicate viz config type (#12101)","author":"magnew","relativeDate":"1 year, 3 months ago"}]},"domain":"SQL Runner","gitSummary":"Add SQL charts as code API endpoints\nAdd bulk move to another space functionality\nRemove duplicate viz config type","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":0,"totalLines":387,"ratio":0}},{"id":"S3Client","type":"client","domain":"Infrastructure","healthSummary":"Empty placeholder — check implementation"},{"id":"SchedulerClient","type":"client","domain":"Scheduling","healthSummary":"Empty placeholder — check implementation"},{"id":"CatalogModel","type":"model","lineCount":1778,"complexity":{"cyclomatic":191,"cognitive":248,"maxFunctionCyclomatic":26},"gitActivity":{"commits":76,"authors":8,"churn":22,"recentCommits":[{"hash":"89d1f98369","message":"feat: prevent deletion of YAML-defined metric tree edges (#19932)","author":"Tatiana Inama","relativeDate":"4 days ago"},{"hash":"72eba278b9","message":"refactor: extract YAML metric tree edge validation logic + tests (#19892)","author":"Tatiana Inama","relativeDate":"5 days ago"},{"hash":"014719b51a","message":"feat: introduce drivers in models to define relationships in canvas (#19840)","author":"Tatiana Inama","relativeDate":"5 days ago"}]},"domain":"Catalog","gitSummary":"Prevent deletion of YAML-defined metric edges\nExtract YAML metric edge validation logic\nIntroduce drivers in models for canvas","healthSummary":"High cognitive (248) + active churn (22) — catalog data evolving"},{"id":"PinnedListModel","type":"model","lineCount":217,"complexity":{"cyclomatic":22,"cognitive":22,"maxFunctionCyclomatic":4},"gitActivity":{"commits":8,"authors":5,"churn":0,"recentCommits":[{"hash":"0706a0e080","message":"fix: fix some ANyTypes across our codebase (#13406)","author":"Javier Rengel Jiménez","relativeDate":"1 year ago"},{"hash":"3d04a286ff","message":"chore: Replace all any types with AnyType (#13376)","author":"devin-ai-integration[bot]","relativeDate":"1 year ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"}]},"domain":"Content","gitSummary":"Fix remaining AnyType usage across codebase\nReplace all 'any' types with AnyType\nRename type dependencies","healthSummary":"Small pinning data","duplication":{"clonedLines":0,"totalLines":215,"ratio":0}},{"id":"SchedulerModel","type":"model","domain":"Scheduling","healthSummary":"Empty placeholder — check implementation"},{"id":"SlackClient","type":"client","domain":"Slack","healthSummary":"Empty placeholder — check implementation"},{"id":"GithubAppInstallationsModel","type":"model","domain":"Git Integration","healthSummary":"Empty placeholder — check implementation"},{"id":"GitlabAppInstallationsModel","type":"model","domain":"Git Integration","healthSummary":"Empty placeholder — check implementation"},{"id":"GroupsModel","type":"model","lineCount":686,"complexity":{"cyclomatic":69,"cognitive":84,"maxFunctionCyclomatic":10},"gitActivity":{"commits":31,"authors":11,"churn":4,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"},{"hash":"17c6bcb22c","message":"feat: remove project access and group memberships when deactivating SCIM users (#17494)","author":"Jose Rego","relativeDate":"4 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Bump prettier and organize imports\nConsolidate NotExistsError and NotFoundError\nRemove access/memberships on SCIM deactivation","healthSummary":"High complexity, stable — group data layer","duplication":{"clonedLines":24,"totalLines":684,"ratio":0.03508771929824561},"duplicationSummary":"Low duplication - acceptable for complex group operations"},{"id":"MigrationModel","type":"model","lineCount":24,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":2,"authors":2,"churn":0,"recentCommits":[{"hash":"3b3bea464e","message":"chore: don't throw error for out of sync migrations (#10293)","author":"João Viana","relativeDate":"1 year, 8 months ago"},{"hash":"c8ac9daea4","message":"refactor: add migration model (#9436)","author":"Jose Rego","relativeDate":"1 year, 11 months ago"}]},"domain":"Infrastructure","gitSummary":"Don't throw error for out-of-sync migrations\nAdd migration model","healthSummary":"Tiny migration utilities","duplication":{"clonedLines":0,"totalLines":22,"ratio":0}},{"id":"OrganizationModel","type":"model","lineCount":504,"complexity":{"cyclomatic":36,"cognitive":22,"maxFunctionCyclomatic":4},"gitActivity":{"commits":20,"authors":8,"churn":2,"recentCommits":[{"hash":"0806f1d06e","message":"feat: dark mode support (#18365)","author":"Tatiana Inama","relativeDate":"2 months ago"},{"hash":"28652c1be2","message":"chore: add way to try agent (#17412)","author":"João Viana","relativeDate":"4 months ago"},{"hash":"df54efb8c5","message":"feat: add updateSetup config for API key and dbt token updates (#15710)","author":"Javier Rengel Jiménez","relativeDate":"7 months ago"}]},"domain":"Organizations","gitSummary":"Add dark mode support\nAdd way to try AI agent\nAdd updateSetup config for API keys/tokens","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":0,"totalLines":502,"ratio":0}},{"id":"OauthModel","type":"model","domain":"User Auth","healthSummary":"Empty placeholder — check implementation"},{"id":"OnboardingModel","type":"model","lineCount":66,"complexity":{"cyclomatic":6,"cognitive":6,"maxFunctionCyclomatic":3},"gitActivity":{"commits":5,"authors":4,"churn":1,"recentCommits":[{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"},{"hash":"3741253388","message":"chore: rename common (#2158)","author":"Oliver Laslett","relativeDate":"3 years, 9 months ago"}]},"domain":"User Auth","gitSummary":"Consolidate NotExistsError and NotFoundError\nRename type dependencies\nRename common package","healthSummary":"Small onboarding data","duplication":{"clonedLines":0,"totalLines":64,"ratio":0}},{"id":"OrganizationAllowedEmailDomainsModel","type":"model","lineCount":130,"complexity":{"cyclomatic":14,"cognitive":15,"maxFunctionCyclomatic":3},"gitActivity":{"commits":5,"authors":2,"churn":0,"recentCommits":[{"hash":"4947846cf4","message":"fix: allowed email domain project access updates (#10172)","author":"Jose Rego","relativeDate":"1 year, 9 months ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"},{"hash":"df2d9ebba5","message":"feat: allow email domain projects roles (#6086)","author":"Jose Rego","relativeDate":"2 years, 7 months ago"}]},"domain":"Organizations","gitSummary":"Fix allowed email domain project access updates\nRename type dependencies\nAdd email domain project roles","healthSummary":"Small domain whitelist logic","duplication":{"clonedLines":0,"totalLines":128,"ratio":0}},{"id":"OrganizationMemberProfileModel","type":"model","lineCount":525,"complexity":{"cyclomatic":46,"cognitive":36,"maxFunctionCyclomatic":7},"gitActivity":{"commits":18,"authors":8,"churn":2,"recentCommits":[{"hash":"9db17776dc","message":"fix(backend): allow for filtering users with google refresh token (#19161)","author":"Bruno Almeida","relativeDate":"5 weeks ago"},{"hash":"931b7300b8","message":"fix: apply custom role abilities to user (#16456)","author":"Javier Rengel Jiménez","relativeDate":"6 months ago"},{"hash":"127e799d03","message":"feat: add get org member by email endpoint (#13673)","author":"Bruno Almeida","relativeDate":"12 months ago"}]},"domain":"Organizations","gitSummary":"Filter users with Google refresh token\nApply custom role abilities to user\nAdd get org member by email endpoint","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":94,"totalLines":523,"ratio":0.17973231357552583},"duplicationSummary":"Profile query patterns - investigate for base model mixin"},{"id":"PersonalAccessTokenModel","type":"model","domain":"User Auth","healthSummary":"Empty placeholder — check implementation"},{"id":"ResourceViewItemModel","type":"model","lineCount":370,"complexity":{"cyclomatic":15,"cognitive":5,"maxFunctionCyclomatic":2},"gitActivity":{"commits":14,"authors":11,"churn":0,"recentCommits":[{"hash":"5f2c07836e","message":"fix: get all spaces query (#14461)","author":"Jose Rego","relativeDate":"10 months ago"},{"hash":"63813659db","message":"feat: expose path for space resource in the api (#14441)","author":"Irakli Janiashvili","relativeDate":"10 months ago"},{"hash":"f703123272","message":"feat: nested spaces (backend) (#14285)","author":"João Viana","relativeDate":"10 months ago"}]},"domain":"Content","gitSummary":"Fix get all spaces query\nExpose path for space resource in API\nAdd nested spaces backend support","healthSummary":"Moderate size, stable — resource views","duplication":{"clonedLines":0,"totalLines":368,"ratio":0}},{"id":"ContentModel","type":"model","lineCount":112,"complexity":{"cyclomatic":11,"cognitive":9,"maxFunctionCyclomatic":4},"gitActivity":{"commits":8,"authors":6,"churn":0,"recentCommits":[{"hash":"2f24568523","message":"chore: remove semantic viewer services + endpoints (#15557)","author":"magnew","relativeDate":"8 months ago"},{"hash":"05e09a723c","message":"feat: resource bulk actions - move to another space (#14704)","author":"Irakli Janiashvili","relativeDate":"9 months ago"},{"hash":"2521e61386","message":"feat: order content by rank (#14533)","author":"João Viana","relativeDate":"10 months ago"}]},"domain":"Content","gitSummary":"Remove semantic viewer services & endpoints\nAdd bulk move to another space functionality\nOrder content by rank","healthSummary":"Small content data layer","duplication":{"clonedLines":0,"totalLines":110,"ratio":0}},{"id":"EmailModel","type":"model","lineCount":206,"complexity":{"cyclomatic":18,"cognitive":11,"maxFunctionCyclomatic":4},"gitActivity":{"commits":8,"authors":4,"churn":1,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"3a95396ffb","message":"refactor: rename entity files to camelCase (#8562)","author":"iMac","relativeDate":"2 years, 1 month ago"},{"hash":"5b1ec423d5","message":"chore: add verify event (#4787)","author":"Jose Rego","relativeDate":"2 years, 11 months ago"}]},"domain":"Infrastructure","gitSummary":"Bump prettier and organize imports\nRename entity files to camelCase\nAdd verify event tracking","healthSummary":"Moderate email operations","duplication":{"clonedLines":0,"totalLines":204,"ratio":0}},{"id":"JobModel","type":"model","lineCount":204,"complexity":{"cyclomatic":20,"cognitive":14,"maxFunctionCyclomatic":4},"gitActivity":{"commits":9,"authors":5,"churn":0,"recentCommits":[{"hash":"35cd889de8","message":"chore: fix and enable `useUnknownInCatchVariables` on all packages (#13375)","author":"devin-ai-integration[bot]","relativeDate":"1 year ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"},{"hash":"e3764dfc8a","message":"fix: dbt compile error message (#3771)","author":"Jose Rego","relativeDate":"3 years, 3 months ago"}]},"domain":"Scheduling","gitSummary":"Enable useUnknownInCatchVariables for safety\nRename type dependencies\nAdd dbt compile error message","healthSummary":"Job tracking, stable","duplication":{"clonedLines":0,"totalLines":202,"ratio":0}},{"id":"OrganizationWarehouseCredentialsModel","type":"model","lineCount":285,"complexity":{"cyclomatic":26,"cognitive":19,"maxFunctionCyclomatic":5},"gitActivity":{"commits":2,"authors":1,"churn":2,"recentCommits":[{"hash":"a8766b5b54","message":"feat: org credentials on CLI (#17673)","author":"Javier Rengel Jiménez","relativeDate":"3 months ago"},{"hash":"541a57b9f7","message":"feat: organizationw warehouse credentials (#17192)","author":"Javier Rengel Jiménez","relativeDate":"4 months ago"}]},"domain":"Organizations","gitSummary":"Add org credentials support for CLI\nAdd organization warehouse credentials","healthSummary":"Moderate credentials storage","duplication":{"clonedLines":36,"totalLines":283,"ratio":0.127208480565371},"duplicationSummary":"Credential handling - extract credentialHelpers.ts"},{"id":"ProjectCompileLogModel","type":"model","lineCount":158,"complexity":{"cyclomatic":13,"cognitive":15,"maxFunctionCyclomatic":7},"gitActivity":{"commits":2,"authors":1,"churn":2,"recentCommits":[{"hash":"4353a812bc","message":"feat(backend): project compile log model, service and controller (#17577)","author":"Tatiana Inama","relativeDate":"3 months ago"},{"hash":"5983f3f92e","message":"feat: project compile model (#17550)","author":"Tatiana Inama","relativeDate":"4 months ago"}]},"domain":"Projects","gitSummary":"Add project compile log tracking endpoints\nAdd project compile model","healthSummary":"Small logging storage","duplication":{"clonedLines":0,"totalLines":156,"ratio":0}},{"id":"ProjectParametersModel","type":"model","lineCount":167,"complexity":{"cyclomatic":19,"cognitive":17,"maxFunctionCyclomatic":5},"gitActivity":{"commits":3,"authors":2,"churn":2,"recentCommits":[{"hash":"a075a3e8f3","message":"feat: add model-level parameters to project parameters list (#16418)","author":"Yegor Borisenco","relativeDate":"6 months ago"},{"hash":"a707f3187b","message":"feat: project parameters api (#16369)","author":"Yegor Borisenco","relativeDate":"6 months ago"},{"hash":"3fcd6b6c5d","message":"feat: lightdash parameters (#15873)","author":"Bruno Almeida","relativeDate":"7 months ago"}]},"domain":"Projects","gitSummary":"Add model-level parameters to list\nAdd project parameters API\nAdd Lightdash parameters support","healthSummary":"Small parameters storage","duplication":{"clonedLines":0,"totalLines":165,"ratio":0}},{"id":"SshKeyPairModel","type":"model","lineCount":48,"complexity":{"cyclomatic":4,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":4,"authors":4,"churn":0,"recentCommits":[{"hash":"a42244b1e3","message":"chore: refactor encryption service to be a util class (#9647)","author":"Jose Rego","relativeDate":"1 year, 10 months ago"},{"hash":"d9e178bc7d","message":"feat: AzureAd OIDC `private_key_jwt` token authentication (#9612)","author":"Filipe Dobreira","relativeDate":"1 year, 10 months ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"}]},"domain":"Infrastructure","gitSummary":"Refactor encryption service to util class\nAdd AzureAD OIDC private_key_jwt auth\nRename type dependencies","healthSummary":"Tiny SSH key storage","duplication":{"clonedLines":0,"totalLines":46,"ratio":0}},{"id":"TagsModel","type":"model","lineCount":160,"complexity":{"cyclomatic":24,"cognitive":15,"maxFunctionCyclomatic":4},"gitActivity":{"commits":8,"authors":4,"churn":1,"recentCommits":[{"hash":"d4f1f67b2c","message":"fix: Metrics Catalog category filter dropdown missing existing categories (#19538)","author":"Giorgi Bagdavadze","relativeDate":"3 weeks ago"},{"hash":"8ea4500769","message":"chore: re enable prettier plugin to organize imports (#13536)","author":"Irakli Janiashvili","relativeDate":"1 year ago"},{"hash":"15ab1f9e0f","message":"chore: track spotlight curation analytics events (#13423)","author":"João Viana","relativeDate":"1 year ago"}]},"domain":"Catalog","gitSummary":"Fix Metrics Catalog category filter dropdown\nRe-enable prettier import organization\nTrack Spotlight curation analytics events","healthSummary":"Small tagging logic","duplication":{"clonedLines":0,"totalLines":158,"ratio":0}},{"id":"UserAttributesModel","type":"model","lineCount":432,"complexity":{"cyclomatic":35,"cognitive":34,"maxFunctionCyclomatic":9},"gitActivity":{"commits":11,"authors":7,"churn":1,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"7423afea35","message":"chore: global eslint no floating promises (#9462)","author":"Irakli Janiashvili","relativeDate":"1 year, 10 months ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"}]},"domain":"Integrations","gitSummary":"Bump prettier and organize imports\nEnable global eslint no-floating-promises\nRename type dependencies","healthSummary":"Moderate user attributes storage","duplication":{"clonedLines":0,"totalLines":430,"ratio":0}},{"id":"UserWarehouseCredentialsModel","type":"model","domain":"Organizations","healthSummary":"Empty placeholder — check implementation"},{"id":"WarehouseAvailableTablesModel","type":"model","lineCount":144,"complexity":{"cyclomatic":19,"cognitive":17,"maxFunctionCyclomatic":4},"gitActivity":{"commits":5,"authors":3,"churn":0,"recentCommits":[{"hash":"aaf03ff84b","message":"fix: no new sessions in trx blocks (#14436)","author":"Oliver Laslett","relativeDate":"10 months ago"},{"hash":"aa424b5f56","message":"fix: sql runner warehouse schema insert in batches (#11870)","author":"Irakli Janiashvili","relativeDate":"1 year, 4 months ago"},{"hash":"2fd15131d5","message":"feat: add partitioning bigquery sql runner (#11576)","author":"Javier Rengel Jiménez","relativeDate":"1 year, 5 months ago"}]},"domain":"Projects","gitSummary":"Avoid new sessions in transaction blocks\nInsert SQL runner warehouse schema in batches\nAdd BigQuery SQL runner partitioning","healthSummary":"Small table discovery","duplication":{"clonedLines":0,"totalLines":142,"ratio":0}},{"id":"EmailClient","type":"client","lineCount":737,"complexity":{"cyclomatic":96,"cognitive":119,"maxFunctionCyclomatic":17},"gitActivity":{"commits":53,"authors":14,"churn":14,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"01a8aa1804","message":"fix: do not run and disable scheduled deliveries when there are no targets (#19495)","author":"Bruno Almeida","relativeDate":"3 weeks ago"},{"hash":"30db081b19","message":"feat: add email notifications for scheduled delivery failures (#18677)","author":"Yegor Borisenco","relativeDate":"9 weeks ago"}]},"domain":"Infrastructure","gitSummary":"Bump prettier and organize imports\nDisable deliveries when no targets exist\nAdd email notifications for delivery failures","healthSummary":"High cognitive (119) + active churn (14) — email templates complex","duplication":{"clonedLines":0,"totalLines":735,"ratio":0}},{"id":"S3CacheClient","type":"client","domain":"Infrastructure","healthSummary":"Empty placeholder — check implementation"},{"id":"DownloadAuditModel","type":"model","lineCount":42,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":1,"authors":1,"churn":1,"recentCommits":[{"hash":"84861714fe","message":"feat: add download audit tracking for file exports (#17553)","author":"Yegor Borisenco","relativeDate":"4 months ago"}]},"domain":"Scheduling","gitSummary":"Add download audit tracking for file exports","healthSummary":"Tiny audit tracking","duplication":{"clonedLines":0,"totalLines":40,"ratio":0}},{"id":"QueryHistoryModel","type":"model","lineCount":300,"complexity":{"cyclomatic":29,"cognitive":32,"maxFunctionCyclomatic":7},"gitActivity":{"commits":9,"authors":5,"churn":4,"recentCommits":[{"hash":"d054daad10","message":"fix: change userUuid type from optional to nullable in query history (#18980)","author":"Javier Rengel Jiménez","relativeDate":"7 weeks ago"},{"hash":"823c210e10","message":"feat: key results cache on userUuid when using warehouse credentials (#18194)","author":"Oliver Laslett","relativeDate":"3 months ago"},{"hash":"fe46b46dcd","message":"fix: format pivoted results (#16641)","author":"Bruno Almeida","relativeDate":"5 months ago"}]},"domain":"Explores","gitSummary":"Change userUuid to nullable in query history\nCache results on userUuid with warehouse creds\nFormat pivoted results correctly","healthSummary":"Moderate query history storage","duplication":{"clonedLines":0,"totalLines":298,"ratio":0}},{"id":"ResultsFileStorageClient","type":"client","domain":"Infrastructure","healthSummary":"Empty placeholder — check implementation"},{"id":"GoogleDriveClient","type":"client","domain":"Integrations","healthSummary":"Empty placeholder — check implementation"},{"id":"SearchModel","type":"model","domain":"Analytics","healthSummary":"Empty placeholder — check implementation"},{"id":"ShareModel","type":"model","lineCount":63,"complexity":{"cyclomatic":4,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":4,"authors":4,"churn":0,"recentCommits":[{"hash":"10bc4658f1","message":"fix: handle error when share link does not exist (#12117)","author":"Jose Rego","relativeDate":"1 year, 3 months ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"},{"hash":"e743b408fd","message":"fix: remove extra fields from ShareModel (#3996)","author":"Oliver Laslett","relativeDate":"3 years, 2 months ago"}]},"domain":"Content","gitSummary":"Handle error when share link doesn't exist\nRename type dependencies\nRemove extra fields from ShareModel","healthSummary":"Small share data","duplication":{"clonedLines":0,"totalLines":61,"ratio":0}},{"id":"SlackAuthenticationModel","type":"model","lineCount":182,"complexity":{"cyclomatic":26,"cognitive":22,"maxFunctionCyclomatic":6},"gitActivity":{"commits":21,"authors":9,"churn":2,"recentCommits":[{"hash":"0f826d692b","message":"fix: slack client listener initialization (#16439)","author":"Irakli Janiashvili","relativeDate":"6 months ago"},{"hash":"5ae3d7553f","message":"fix: Revert \"refactor: move Slack client functionality to service layer\" (#16432)","author":"Irakli Janiashvili","relativeDate":"6 months ago"},{"hash":"4bc43a2264","message":"refactor: move Slack client functionality to service layer (#16254)","author":"Irakli Janiashvili","relativeDate":"6 months ago"}]},"domain":"Slack","gitSummary":"Fix Slack client listener initialization\nRevert Slack client service layer refactor\nMove Slack client to service layer","healthSummary":"Moderate Slack auth storage","duplication":{"clonedLines":37,"totalLines":180,"ratio":0.20555555555555555},"duplicationSummary":"Slack auth patterns - check for oauth base model"},{"id":"SpacePermissionModel","type":"model","lineCount":343,"complexity":{"cyclomatic":27,"cognitive":35,"maxFunctionCyclomatic":2},"gitActivity":{"commits":2,"authors":1,"churn":2,"recentCommits":[{"hash":"d1fa433026","message":"chore: add sentry transaction to (#20069)","author":"Bruno Almeida","relativeDate":"32 hours ago"},{"hash":"ab3365e114","message":"chore(refactor): refactor space access resolution into its own service (#20009)","author":"Bruno Almeida","relativeDate":"32 hours ago"}]},"domain":"Spaces","gitSummary":"Add Sentry transaction tracking\nRefactor space access resolution to service","healthSummary":"Moderate space permissions","duplication":{"clonedLines":20,"totalLines":341,"ratio":0.05865102639296188},"duplicationSummary":"Permission queries - acceptable for CASL integration"},{"id":"InviteLinkModel","type":"model","lineCount":126,"complexity":{"cyclomatic":11,"cognitive":6,"maxFunctionCyclomatic":2},"gitActivity":{"commits":17,"authors":8,"churn":2,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"}]},"domain":"User Auth","gitSummary":"Bump prettier and organize imports\nConsolidate NotExistsError and NotFoundError\nRename type dependencies","healthSummary":"Small invite link storage","duplication":{"clonedLines":16,"totalLines":124,"ratio":0.12903225806451613},"duplicationSummary":"Invite link generation - extract inviteHelpers.ts"},{"id":"OpenIdIdentityModel","type":"model","domain":"User Auth","healthSummary":"Empty placeholder — check implementation"},{"id":"PasswordResetLinkModel","type":"model","lineCount":97,"complexity":{"cyclomatic":8,"cognitive":4,"maxFunctionCyclomatic":2},"gitActivity":{"commits":6,"authors":5,"churn":2,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"},{"hash":"d0f328e5e6","message":"refactor: rename type dependencies (#9184)","author":"Jogeshwar Singh","relativeDate":"1 year, 11 months ago"}]},"domain":"User Auth","gitSummary":"Bump prettier and organize imports\nConsolidate NotExistsError and NotFoundError\nRename type dependencies","healthSummary":"Small password reset storage","duplication":{"clonedLines":0,"totalLines":95,"ratio":0}},{"id":"SessionModel","type":"model","lineCount":19,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":1,"authors":1,"churn":0,"recentCommits":[{"hash":"180a97cce8","message":"delete organization user","author":"Jose Rego","relativeDate":"4 years, 6 months ago"}]},"domain":"User Auth","gitSummary":"Delete organization user","healthSummary":"Tiny session storage","duplication":{"clonedLines":0,"totalLines":17,"ratio":0}},{"id":"ValidationModel","type":"model","lineCount":464,"complexity":{"cyclomatic":51,"cognitive":55,"maxFunctionCyclomatic":9},"gitActivity":{"commits":26,"authors":6,"churn":5,"recentCommits":[{"hash":"9e8bde9efb","message":"fix: include charts from dashboards in validation error queries (#19758)","author":"Javier Rengel Jiménez","relativeDate":"11 days ago"},{"hash":"684f0eff27","message":"fix: handle additional foreign key constraints in validation error handling (#19433)","author":"Javier Rengel Jiménez","relativeDate":"3 weeks ago"},{"hash":"284012a8a7","message":"fix: prevent race conditions in validation updates with row-level locking (#19061)","author":"Jose Rego","relativeDate":"5 weeks ago"}]},"domain":"Integrations","gitSummary":"Include dashboard charts in validation errors\nHandle additional foreign key constraints\nPrevent race conditions with row-level locking","healthSummary":"Moderate validation results storage","duplication":{"clonedLines":46,"totalLines":462,"ratio":0.09956709956709957},"duplicationSummary":"Validation query patterns - check for base validation mixin"},{"id":"ChangesetModel","type":"model","lineCount":215,"complexity":{"cyclomatic":16,"cognitive":20,"maxFunctionCyclomatic":4},"gitActivity":{"commits":8,"authors":2,"churn":8,"recentCommits":[{"hash":"3a699bef93","message":"feat: add API endpoints to revert changes in changesets (#17235)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"},{"hash":"2b60bf60d2","message":"fix: order changeset changes by creation time (#17256)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"},{"hash":"19b6f7965c","message":"feat: add ability to revert AI agent proposed changes (#17205)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"}]},"domain":"Catalog","gitSummary":"Add API endpoints to revert changes\nOrder changeset changes by creation time\nAdd ability to revert AI agent changes","healthSummary":"Moderate changeset storage","duplication":{"clonedLines":22,"totalLines":213,"ratio":0.10328638497652583},"duplicationSummary":"Changeset diffing - acceptable for git-like operations"},{"id":"RolesModel","type":"model","lineCount":835,"complexity":{"cyclomatic":118,"cognitive":107,"maxFunctionCyclomatic":5},"gitActivity":{"commits":10,"authors":3,"churn":10,"recentCommits":[{"hash":"dd9adf3e98","message":"fix: add unified method for setting user org and project roles in SCIM service (#18255)","author":"Jose Rego","relativeDate":"3 months ago"},{"hash":"34689010a5","message":"feat: add transaction support to RolesModel methods (#18252)","author":"Jose Rego","relativeDate":"3 months ago"},{"hash":"17c6bcb22c","message":"feat: remove project access and group memberships when deactivating SCIM users (#17494)","author":"Jose Rego","relativeDate":"4 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Add unified method for SCIM user role setting\nAdd transaction support to RolesModel methods\nRemove access/memberships on SCIM deactivation","healthSummary":"High complexity + active churn (10) — roles data evolving","duplication":{"clonedLines":68,"totalLines":833,"ratio":0.08163265306122448},"duplicationSummary":"Role/permission queries - acceptable for CASL complexity"},{"id":"SpotlightTableConfigModel","type":"model","lineCount":55,"complexity":{"cyclomatic":4,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":2,"authors":2,"churn":0,"recentCommits":[{"hash":"5c23a86610","message":"chore: fix prettier organizeImportsSkipDestructiveCodeActions (#13393)","author":"Irakli Janiashvili","relativeDate":"1 year ago"},{"hash":"741731967a","message":"feat: allow curating Spotlight's table (#13355)","author":"João Viana","relativeDate":"1 year, 1 month ago"}]},"domain":"Analytics","gitSummary":"Fix prettier organize imports config\nAllow curating Spotlight's table","healthSummary":"Small config storage","duplication":{"clonedLines":0,"totalLines":53,"ratio":0}},{"id":"ee/AiAgentAdminController","type":"controller","ee":true,"lineCount":200,"complexity":{"cyclomatic":21,"cognitive":16,"maxFunctionCyclomatic":15},"gitActivity":{"commits":7,"authors":5,"churn":7,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"6a5e12ce61","message":"chore: unhide admin API endpoints (#17574)","author":"Giorgi Bagdavadze","relativeDate":"4 months ago"},{"hash":"35b80f5fa6","message":"feat: ai organization settings crud (#17353)","author":"Tatiana Inama","relativeDate":"4 months ago"}]},"domain":"AI Agent","gitSummary":"Add JSDoc summaries to API handler methods\nUnhide admin API endpoints\nAdd AI organization settings CRUD endpoints","healthSummary":"Active churn (7/7) — AI admin features rapidly evolving","duplication":{"clonedLines":0,"totalLines":198,"ratio":0}},{"id":"ee/CustomRolesController","type":"controller","ee":true,"lineCount":207,"complexity":{"cyclomatic":6,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":3,"churn":3,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"26d444e6c9","message":"feat: add assigning scopes to custom roles (#16601)","author":"Steve Gardner","relativeDate":"5 months ago"},{"hash":"667efe54c0","message":"fix: move new role system endpoints to oss (#16563)","author":"Javier Rengel Jiménez","relativeDate":"6 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Add JSDoc summaries to API handler methods\nAdd scope assignment for custom roles\nMove role system endpoints to open source","healthSummary":"Clean custom roles endpoint","duplication":{"clonedLines":0,"totalLines":205,"ratio":0}},{"id":"ee/OrganizationWarehouseCredentialsController","type":"controller","ee":true,"lineCount":193,"complexity":{"cyclomatic":7,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":2,"authors":1,"churn":2,"recentCommits":[{"hash":"a8766b5b54","message":"feat: org credentials on CLI (#17673)","author":"Javier Rengel Jiménez","relativeDate":"3 months ago"},{"hash":"541a57b9f7","message":"feat: organizationw warehouse credentials (#17192)","author":"Javier Rengel Jiménez","relativeDate":"4 months ago"}]},"domain":"Organizations","gitSummary":"Add org credentials support for CLI\nAdd organization warehouse credentials endpoints","healthSummary":"Clean warehouse credentials endpoint","duplication":{"clonedLines":0,"totalLines":191,"ratio":0}},{"id":"ee/aiAgentController","type":"controller","ee":true,"lineCount":1114,"complexity":{"cyclomatic":62,"cognitive":28,"maxFunctionCyclomatic":5},"gitActivity":{"commits":47,"authors":4,"churn":31,"recentCommits":[{"hash":"707aa22c2d","message":"refactor: move AiAgentService to dedicated directory with documentation (#19394)","author":"Irakli Janiashvili","relativeDate":"4 weeks ago"},{"hash":"2bcb6f42ea","message":"fix: skip Sentry for stream timeout errors in AI agent controller (#19109)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"},{"hash":"88c1381645","message":"feat(backend): list available models and model selection for prompts (#18532)","author":"Giorgi Bagdavadze","relativeDate":"9 weeks ago"}]},"domain":"AI Agent","gitSummary":"Move AiAgentService to dedicated directory\nSkip Sentry for stream timeout errors\nAdd model selection for AI prompts","healthSummary":"Massive controller (1114 lines) + high churn (31) — split urgently"},{"id":"ee/aiController","type":"controller","ee":true,"lineCount":178,"complexity":{"cyclomatic":7,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":9,"authors":6,"churn":4,"recentCommits":[{"hash":"3391c5ec08","message":"feat: add AI-powered custom tooltip generator (#19501)","author":"Giorgi Bagdavadze","relativeDate":"3 weeks ago"},{"hash":"ed76d9559b","message":"chore: add generation of table calculation with ambient ai (#18920)","author":"João Viana","relativeDate":"7 weeks ago"},{"hash":"46b0e60642","message":"chore: create generator for chart metadata (#18721)","author":"João Viana","relativeDate":"8 weeks ago"}]},"domain":"AI Agent","gitSummary":"Add AI-powered custom tooltip generator\nAdd table calculation generation with AI\nCreate generator for chart metadata","healthSummary":"Active churn (4/9) — AI features iterating","duplication":{"clonedLines":0,"totalLines":176,"ratio":0}},{"id":"ee/databricksSSOController","type":"controller","ee":true,"lineCount":43,"complexity":{"cyclomatic":1,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":1,"authors":1,"churn":1,"recentCommits":[{"hash":"9bfa021353","message":"feat: databricks oauth (#17745)","author":"Javier Rengel Jiménez","relativeDate":"3 months ago"}]},"domain":"User Auth","gitSummary":"Add Databricks OAuth support","healthSummary":"Simple SSO handler","duplication":{"clonedLines":0,"totalLines":41,"ratio":0}},{"id":"ee/embedController","type":"controller","ee":true,"lineCount":506,"complexity":{"cyclomatic":15,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":22,"authors":9,"churn":11,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"11cee2936b","message":"feat: add calculate total and subtotals endpoints for embed mode (#19098)","author":"Yegor Borisenco","relativeDate":"6 weeks ago"},{"hash":"4ab85d81f0","message":"fix: get right aggregate on date zoom + subttotals (#18654)","author":"Lightdash Bot","relativeDate":"9 weeks ago"}]},"domain":"Integrations","gitSummary":"Add JSDoc summaries to API handler methods\nAdd calculate total/subtotals for embed mode\nFix date zoom aggregate with subtotals","healthSummary":"Large + active churn (11) — embed features evolving","duplication":{"clonedLines":14,"totalLines":504,"ratio":0.027777777777777776},"duplicationSummary":"Low duplication - acceptable for embed feature"},{"id":"ee/scimGroupController","type":"controller","ee":true,"lineCount":216,"complexity":{"cyclomatic":7,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":1,"churn":2,"recentCommits":[{"hash":"440211cfa5","message":"docs: add examples to SCIM API endpoints (#17914)","author":"Jose Rego","relativeDate":"3 months ago"},{"hash":"ca7e0caede","message":"docs: SCIM API endpoints (#17871)","author":"Jose Rego","relativeDate":"3 months ago"},{"hash":"3164fa8817","message":"feat: ee features (#13402)","author":"Jose Rego","relativeDate":"1 year ago"}]},"domain":"Roles & Permissions","gitSummary":"Add examples to SCIM API endpoints\nAdd SCIM API documentation\nAdd enterprise edition features","healthSummary":"Clean SCIM group endpoint","duplication":{"clonedLines":59,"totalLines":214,"ratio":0.2757009345794392},"duplicationSummary":"HIGH: SCIM response formatting - extract scimHelpers.ts"},{"id":"ee/scimOrganizationAccessTokenController","type":"controller","ee":true,"lineCount":187,"complexity":{"cyclomatic":6,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":4,"authors":3,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"056bd51eae","message":"feat: improve service account authentication with CASL abilities (#15354)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"},{"hash":"708119a7eb","message":"feat: service accounts (#15261)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"}]},"domain":"User Auth","gitSummary":"Add JSDoc summaries to API handler methods\nImprove service account auth with CASL\nAdd service accounts support","healthSummary":"Clean SCIM token endpoint","duplication":{"clonedLines":23,"totalLines":185,"ratio":0.12432432432432433},"duplicationSummary":"ServiceAccount ops - extract BaseServiceAccountController"},{"id":"ee/scimRoleController","type":"controller","ee":true,"lineCount":140,"complexity":{"cyclomatic":3,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":4,"authors":1,"churn":4,"recentCommits":[{"hash":"440211cfa5","message":"docs: add examples to SCIM API endpoints (#17914)","author":"Jose Rego","relativeDate":"3 months ago"},{"hash":"fde98c2c12","message":"feat: add pagination to SCIM roles API (#17873)","author":"Jose Rego","relativeDate":"3 months ago"},{"hash":"ca7e0caede","message":"docs: SCIM API endpoints (#17871)","author":"Jose Rego","relativeDate":"3 months ago"}]},"domain":"Roles & Permissions","gitSummary":"Add examples to SCIM API endpoints\nAdd pagination to SCIM roles API\nAdd SCIM API documentation","healthSummary":"Active churn (4/4) — SCIM roles iterating","duplication":{"clonedLines":0,"totalLines":138,"ratio":0}},{"id":"ee/scimUserController","type":"controller","ee":true,"lineCount":273,"complexity":{"cyclomatic":7,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":1,"churn":2,"recentCommits":[{"hash":"440211cfa5","message":"docs: add examples to SCIM API endpoints (#17914)","author":"Jose Rego","relativeDate":"3 months ago"},{"hash":"ca7e0caede","message":"docs: SCIM API endpoints (#17871)","author":"Jose Rego","relativeDate":"3 months ago"},{"hash":"3164fa8817","message":"feat: ee features (#13402)","author":"Jose Rego","relativeDate":"1 year ago"}]},"domain":"Roles & Permissions","gitSummary":"Add examples to SCIM API endpoints\nAdd SCIM API documentation\nAdd enterprise edition features","healthSummary":"Clean SCIM user endpoint","duplication":{"clonedLines":95,"totalLines":271,"ratio":0.3505535055350554},"duplicationSummary":"CRITICAL: 35% SCIM patterns - extract scimHelpers.ts urgently"},{"id":"ee/serviceAccountsController","type":"controller","ee":true,"lineCount":119,"complexity":{"cyclomatic":5,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":3,"authors":2,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"056bd51eae","message":"feat: improve service account authentication with CASL abilities (#15354)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"},{"hash":"708119a7eb","message":"feat: service accounts (#15261)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"}]},"domain":"User Auth","gitSummary":"Add JSDoc summaries to API handler methods\nImprove service account auth with CASL\nAdd service accounts support","healthSummary":"Clean service accounts endpoint","duplication":{"clonedLines":23,"totalLines":117,"ratio":0.19658119658119658},"duplicationSummary":"ServiceAccount ops - extract BaseServiceAccountController"},{"id":"ee/snowflakeController","type":"controller","ee":true,"lineCount":58,"complexity":{"cyclomatic":2,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":2,"authors":2,"churn":1,"recentCommits":[{"hash":"833d32739c","message":"chore: add missing `@summary` jsdoc to handlers (#19839)","author":"Lukas Spiss","relativeDate":"9 days ago"},{"hash":"ed9efedf0c","message":"chore: move snowflake controller to enterprise edition (#15245)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"}]},"domain":"User Auth","gitSummary":"Add JSDoc summaries to API handler methods\nMove Snowflake controller to enterprise edition","healthSummary":"Simple Snowflake SSO handler","duplication":{"clonedLines":0,"totalLines":56,"ratio":0}},{"id":"ee/supportController","type":"controller","ee":true,"lineCount":66,"complexity":{"cyclomatic":2,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":1,"authors":1,"churn":0,"recentCommits":[{"hash":"bb08f46efd","message":"chore: support button (#14185)","author":"magnew","relativeDate":"10 months ago"}]},"domain":"Integrations","gitSummary":"Add support button","healthSummary":"Minimal support endpoint","duplication":{"clonedLines":0,"totalLines":64,"ratio":0}},{"id":"AiAgentAdminService","type":"service","ee":true,"lineCount":164,"complexity":{"cyclomatic":12,"cognitive":13,"maxFunctionCyclomatic":5},"gitActivity":{"commits":3,"authors":2,"churn":3,"recentCommits":[{"hash":"b61b55b4d6","message":"feat: add analytics dashboard embed to AI agent admin page (#16894)","author":"Irakli Janiashvili","relativeDate":"5 months ago"},{"hash":"7849182b39","message":"feat: add tooltop bar ai threads filters (#16718)","author":"João Viana","relativeDate":"5 months ago"},{"hash":"b6885c2ee5","message":"chore: add ai agent admin controller (#16691)","author":"João Viana","relativeDate":"5 months ago"}]},"domain":"AI Agent","gitSummary":"Add analytics dashboard embed to admin page\nAdd tooltip bar AI threads filters\nAdd AI agent admin controller","healthSummary":"Small admin service","duplication":{"clonedLines":0,"totalLines":162,"ratio":0}},{"id":"AiAgentService","type":"service","ee":true,"lineCount":5960,"complexity":{"cyclomatic":640,"cognitive":861,"maxFunctionCyclomatic":30},"gitActivity":{"commits":10,"authors":4,"churn":10,"recentCommits":[{"hash":"d56a7d62bb","message":"fix: ambient ai and fast model (#19986)","author":"Giorgi Bagdavadze","relativeDate":"35 hours ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"7362ee9476","message":"refactor: rename runMiniMetricQuery to runAsyncQuery and remove redundant params (#19724)","author":"Giorgi Bagdavadze","relativeDate":"11 days ago"}]},"domain":"AI Agent","gitSummary":"Fix ambient AI with fast model\nBump prettier and organize imports\nRename runMiniMetricQuery to runAsyncQuery","healthSummary":"God service — 640 cyclomatic, 861 cognitive, split urgently"},{"id":"AiOrganizationSettingsService","type":"service","ee":true,"lineCount":147,"complexity":{"cyclomatic":14,"cognitive":14,"maxFunctionCyclomatic":5},"gitActivity":{"commits":6,"authors":3,"churn":6,"recentCommits":[{"hash":"3995beaff1","message":"fix: add organization name to user type in feature flag service (#17805)","author":"Irakli Janiashvili","relativeDate":"3 months ago"},{"hash":"28652c1be2","message":"chore: add way to try agent (#17412)","author":"João Viana","relativeDate":"4 months ago"},{"hash":"e670e2cbde","message":"feat: ai feature visibility defaults to true (#17380)","author":"Tatiana Inama","relativeDate":"4 months ago"}]},"domain":"AI Agent","gitSummary":"Add organization name to feature flag user\nAdd way to try AI agent\nSet AI feature visibility default to true","healthSummary":"Small, active (6/6) — AI settings iterating","duplication":{"clonedLines":0,"totalLines":145,"ratio":0}},{"id":"AiService","type":"service","ee":true,"lineCount":544,"complexity":{"cyclomatic":45,"cognitive":43,"maxFunctionCyclomatic":9},"gitActivity":{"commits":32,"authors":9,"churn":8,"recentCommits":[{"hash":"d56a7d62bb","message":"fix: ambient ai and fast model (#19986)","author":"Giorgi Bagdavadze","relativeDate":"35 hours ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"3391c5ec08","message":"feat: add AI-powered custom tooltip generator (#19501)","author":"Giorgi Bagdavadze","relativeDate":"3 weeks ago"}]},"domain":"AI Agent","gitSummary":"Fix ambient AI with fast model\nBump prettier and organize imports\nAdd AI-powered custom tooltip generator","healthSummary":"Moderate complexity + active churn (8) — AI features evolving","duplication":{"clonedLines":0,"totalLines":542,"ratio":0}},{"id":"CacheService","type":"service","ee":true,"domain":"Explores","healthSummary":"Empty placeholder — check implementation"},{"id":"EmbedService","type":"service","ee":true,"lineCount":1803,"complexity":{"cyclomatic":160,"cognitive":201,"maxFunctionCyclomatic":10},"gitActivity":{"commits":54,"authors":9,"churn":27,"recentCommits":[{"hash":"aaa5df0ed1","message":"fix: enable subtotals/totals on SDK + charts (#19925)","author":"João Viana","relativeDate":"5 days ago"},{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"fb839f6903","message":"fix: load embed chart on generate & copy URL action in embed settings (#19397)","author":"João Viana","relativeDate":"3 weeks ago"}]},"domain":"Integrations","gitSummary":"Enable subtotals/totals on SDK & charts\nBump prettier and organize imports\nFix embed chart load on generate/copy URL","healthSummary":"High complexity + high churn (27) — embed features evolving"},{"id":"InstanceConfigurationService","type":"service","ee":true,"lineCount":600,"complexity":{"cyclomatic":63,"cognitive":95,"maxFunctionCyclomatic":17},"gitActivity":{"commits":11,"authors":5,"churn":7,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"11ab833e8a","message":"refactor: consolidate NotExistsError and NotFoundError (#19093)","author":"Giorgi Bagdavadze","relativeDate":"6 weeks ago"},{"hash":"38edc6bde4","message":"feat: add charts to embedding table (#17596)","author":"Steve Gardner","relativeDate":"3 months ago"}]},"domain":"Infrastructure","gitSummary":"Bump prettier and organize imports\nConsolidate NotExistsError and NotFoundError\nAdd charts to embedding table","healthSummary":"High cognitive (95) — complex config logic","duplication":{"clonedLines":0,"totalLines":598,"ratio":0}},{"id":"McpService","type":"service","ee":true,"lineCount":1658,"complexity":{"cyclomatic":132,"cognitive":115,"maxFunctionCyclomatic":9},"gitActivity":{"commits":49,"authors":7,"churn":44,"recentCommits":[{"hash":"724838ca2a","message":"feat: introduce MCP App for ai charts (#19747)","author":"João Viana","relativeDate":"6 days ago"},{"hash":"b1291b28b7","message":"feat: support service account authentication for MCP (#19738)","author":"Javier Rengel Jiménez","relativeDate":"11 days ago"},{"hash":"7362ee9476","message":"refactor: rename runMiniMetricQuery to runAsyncQuery and remove redundant params (#19724)","author":"Giorgi Bagdavadze","relativeDate":"11 days ago"}]},"domain":"Integrations","gitSummary":"Introduce MCP App for AI charts\nSupport service account auth for MCP\nRename runMiniMetricQuery to runAsyncQuery","healthSummary":"High complexity + highest churn (44) — MCP protocol actively evolving"},{"id":"OrganizationWarehouseCredentialsService","type":"service","ee":true,"lineCount":281,"complexity":{"cyclomatic":21,"cognitive":19,"maxFunctionCyclomatic":5},"gitActivity":{"commits":3,"authors":1,"churn":3,"recentCommits":[{"hash":"a8766b5b54","message":"feat: org credentials on CLI (#17673)","author":"Javier Rengel Jiménez","relativeDate":"3 months ago"},{"hash":"6bd8a694d8","message":"feat: organization warehouse credentials form for snowflake (#17223)","author":"Javier Rengel Jiménez","relativeDate":"4 months ago"},{"hash":"541a57b9f7","message":"feat: organizationw warehouse credentials (#17192)","author":"Javier Rengel Jiménez","relativeDate":"4 months ago"}]},"domain":"Organizations","gitSummary":"Add org credentials support for CLI\nAdd Snowflake org warehouse credentials form\nAdd organization warehouse credentials","healthSummary":"Moderate credentials management","duplication":{"clonedLines":0,"totalLines":279,"ratio":0}},{"id":"ScimService","type":"service","ee":true,"lineCount":2770,"complexity":{"cyclomatic":227,"cognitive":257,"maxFunctionCyclomatic":19},"gitActivity":{"commits":29,"authors":5,"churn":22,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"b19312bae3","message":"feat: delete OpenID identities by email in SCIM service to prevent login conflicts (#19449)","author":"Javier Rengel Jiménez","relativeDate":"3 weeks ago"},{"hash":"2b090ca7a0","message":"feat: auto-verify emails for SCIM users when email is updated (#19362)","author":"Javier Rengel Jiménez","relativeDate":"4 weeks ago"}]},"domain":"Roles & Permissions","gitSummary":"Bump prettier and organize imports\nDelete OpenID identities to prevent conflicts\nAuto-verify emails for SCIM user updates","healthSummary":"God service — 2770 lines, 257 cognitive, SCIM protocol hub"},{"id":"ServiceAccountService","type":"service","ee":true,"lineCount":334,"complexity":{"cyclomatic":37,"cognitive":52,"maxFunctionCyclomatic":7},"gitActivity":{"commits":3,"authors":2,"churn":1,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"056bd51eae","message":"feat: improve service account authentication with CASL abilities (#15354)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"},{"hash":"708119a7eb","message":"feat: service accounts (#15261)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"}]},"domain":"User Auth","gitSummary":"Bump prettier and organize imports\nImprove service account auth with CASL\nAdd service accounts support","healthSummary":"Moderate complexity, stable","duplication":{"clonedLines":58,"totalLines":332,"ratio":0.1746987951807229},"duplicationSummary":"Token CRUD patterns - extract tokenServiceHelpers.ts"},{"id":"SupportService","type":"service","ee":true,"lineCount":346,"complexity":{"cyclomatic":24,"cognitive":34,"maxFunctionCyclomatic":15},"gitActivity":{"commits":7,"authors":4,"churn":1,"recentCommits":[{"hash":"61cf8937d8","message":"feat: add expiration time to support file uploads (#19271)","author":"Jose Rego","relativeDate":"4 weeks ago"},{"hash":"3287365050","message":"fix: Revert \"fix: Revert \"feat: refactor AsyncQuery and Project service to use account where needed for Embedded Explores (#15893)\" (#16007)\" (#16023)","author":"Steve Gardner","relativeDate":"7 months ago"},{"hash":"9356f4e354","message":"fix: Revert \"feat: refactor AsyncQuery and Project service to use account where needed for Embedded Explores (#15893)\" (#16007)","author":"Steve Gardner","relativeDate":"7 months ago"}]},"domain":"Integrations","gitSummary":"Add expiration time to support file uploads\nRefactor AsyncQuery for Embedded Explores support\nRevert AsyncQuery refactor temporarily","healthSummary":"Moderate support operations","duplication":{"clonedLines":0,"totalLines":344,"ratio":0}},{"id":"AiAgentModel","type":"model","ee":true,"lineCount":4514,"complexity":{"cyclomatic":384,"cognitive":434,"maxFunctionCyclomatic":17},"gitActivity":{"commits":95,"authors":5,"churn":58,"recentCommits":[{"hash":"85d1f0c097","message":"chore: bump prettier and organize imports plugin (#19149)","author":"Bruno Almeida","relativeDate":"10 days ago"},{"hash":"6d4423c05e","message":"feat: add error message to ai prompts (#19692)","author":"Tatiana Inama","relativeDate":"11 days ago"},{"hash":"6156faf114","message":"feat: add project filtering for Slack multi-agent channel (#19456)","author":"Irakli Janiashvili","relativeDate":"3 weeks ago"}]},"domain":"AI Agent","gitSummary":"Bump prettier and organize imports\nAdd error message to AI prompts\nAdd project filtering for multi-agent channel","healthSummary":"God model — 434 cognitive + highest churn (58) — AI agent data layer"},{"id":"AiOrganizationSettingsModel","type":"model","ee":true,"lineCount":119,"complexity":{"cyclomatic":12,"cognitive":8,"maxFunctionCyclomatic":2},"gitActivity":{"commits":2,"authors":1,"churn":2,"recentCommits":[{"hash":"f0677cf575","message":"feat: enable ai visibility in admin panel (#17355)","author":"Tatiana Inama","relativeDate":"4 months ago"},{"hash":"35b80f5fa6","message":"feat: ai organization settings crud (#17353)","author":"Tatiana Inama","relativeDate":"4 months ago"}]},"domain":"AI Agent","gitSummary":"Enable AI visibility in admin panel\nAdd AI organization settings CRUD","healthSummary":"Small settings storage","duplication":{"clonedLines":0,"totalLines":117,"ratio":0}},{"id":"EmbedModel","type":"model","ee":true,"lineCount":144,"complexity":{"cyclomatic":9,"cognitive":4,"maxFunctionCyclomatic":3},"gitActivity":{"commits":9,"authors":5,"churn":3,"recentCommits":[{"hash":"c112d762a1","message":"fix: fallback to account user id for isFeatureEnabled in embed service (#18565)","author":"Yegor Borisenco","relativeDate":"9 weeks ago"},{"hash":"38edc6bde4","message":"feat: add charts to embedding table (#17596)","author":"Steve Gardner","relativeDate":"3 months ago"},{"hash":"074fef745a","message":"fix: update instance embed (#17267)","author":"Javier Rengel Jiménez","relativeDate":"4 months ago"}]},"domain":"Integrations","gitSummary":"Fallback to account user for isFeatureEnabled\nAdd charts to embedding table\nUpdate instance embed functionality","healthSummary":"Small embed data storage","duplication":{"clonedLines":0,"totalLines":142,"ratio":0}},{"id":"McpContextModel","type":"model","ee":true,"lineCount":88,"complexity":{"cyclomatic":4,"cognitive":0,"maxFunctionCyclomatic":1},"gitActivity":{"commits":2,"authors":2,"churn":2,"recentCommits":[{"hash":"d95aea9698","message":"feat: add tag filtering to MCP service project context (#16560)","author":"Giorgi Bagdavadze","relativeDate":"5 months ago"},{"hash":"bd5a296d5e","message":"feat: add MCP context table and project selection tools (#16339)","author":"Javier Rengel Jiménez","relativeDate":"6 months ago"}]},"domain":"Integrations","gitSummary":"Add tag filtering to MCP project context\nAdd MCP context table & project selection tools","healthSummary":"Small MCP context storage","duplication":{"clonedLines":24,"totalLines":86,"ratio":0.27906976744186046},"duplicationSummary":"HIGH: small file with 28% duplication - investigate immediately"},{"id":"DashboardSummaryModel","type":"model","ee":true,"lineCount":78,"complexity":{"cyclomatic":4,"cognitive":2,"maxFunctionCyclomatic":2},"gitActivity":{"commits":1,"authors":1,"churn":0,"recentCommits":[{"hash":"3164fa8817","message":"feat: ee features (#13402)","author":"Jose Rego","relativeDate":"1 year ago"}]},"domain":"Dashboards","gitSummary":"Add enterprise edition features","healthSummary":"Tiny summary storage","duplication":{"clonedLines":0,"totalLines":76,"ratio":0}},{"id":"ServiceAccountModel","type":"model","ee":true,"lineCount":162,"complexity":{"cyclomatic":15,"cognitive":6,"maxFunctionCyclomatic":3},"gitActivity":{"commits":4,"authors":1,"churn":1,"recentCommits":[{"hash":"3990a7c598","message":"fix: improve token hash (#16918)","author":"Javier Rengel Jiménez","relativeDate":"5 months ago"},{"hash":"df54efb8c5","message":"feat: add updateSetup config for API key and dbt token updates (#15710)","author":"Javier Rengel Jiménez","relativeDate":"7 months ago"},{"hash":"056bd51eae","message":"feat: improve service account authentication with CASL abilities (#15354)","author":"Javier Rengel Jiménez","relativeDate":"8 months ago"}]},"domain":"User Auth","gitSummary":"Improve token hash implementation\nAdd updateSetup config for API keys/tokens\nImprove service account auth with CASL","healthSummary":"Small service account storage","duplication":{"clonedLines":0,"totalLines":160,"ratio":0}}],"edges":[{"from":"ChangesetController","to":"ChangesetService","type":"uses_service"},{"from":"OrganizationRolesController","to":"RolesService","type":"uses_service"},{"from":"ProjectRolesController","to":"RolesService","type":"uses_service"},{"from":"bigquerySSOController","to":"ProjectService","type":"uses_service"},{"from":"bigquerySSOController","to":"UserService","type":"uses_service"},{"from":"catalogController","to":"CatalogService","type":"uses_service"},{"from":"commentsController","to":"CommentService","type":"uses_service"},{"from":"csvController","to":"SchedulerService","type":"uses_service"},{"from":"dashboardController","to":"DashboardService","type":"uses_service"},{"from":"dashboardController","to":"PromoteService","type":"uses_service"},{"from":"exploreController","to":"CsvService","type":"uses_service"},{"from":"exploreController","to":"ProjectService","type":"uses_service"},{"from":"funnelController","to":"FunnelService","type":"uses_service"},{"from":"gitIntegrationController","to":"GitIntegrationService","type":"uses_service"},{"from":"githubController","to":"GitIntegrationService","type":"uses_service"},{"from":"githubController","to":"GithubAppService","type":"uses_service"},{"from":"gitlabController","to":"GitlabAppService","type":"uses_service"},{"from":"googleDriveController","to":"GdriveService","type":"uses_service"},{"from":"googleDriveController","to":"UserService","type":"uses_service"},{"from":"groupsController","to":"GroupService","type":"uses_service"},{"from":"metricsExplorerController","to":"MetricsExplorerService","type":"uses_service"},{"from":"notificationsController","to":"NotificationService","type":"uses_service"},{"from":"organizationController","to":"OrganizationService","type":"uses_service"},{"from":"organizationController","to":"ProjectService","type":"uses_service"},{"from":"organizationController","to":"SchedulerService","type":"uses_service"},{"from":"organizationController","to":"UserService","type":"uses_service"},{"from":"pinningController","to":"PinningService","type":"uses_service"},{"from":"projectCompileLogController","to":"ProjectCompileLogService","type":"uses_service"},{"from":"projectController","to":"CoderService","type":"uses_service"},{"from":"projectController","to":"DashboardService","type":"uses_service"},{"from":"projectController","to":"ProjectService","type":"uses_service"},{"from":"projectController","to":"SchedulerService","type":"uses_service"},{"from":"renameController","to":"RenameService","type":"uses_service"},{"from":"runQueryController","to":"LightdashAnalyticsService","type":"uses_service"},{"from":"runQueryController","to":"ProjectService","type":"uses_service"},{"from":"savedChartController","to":"CsvService","type":"uses_service"},{"from":"savedChartController","to":"LightdashAnalyticsService","type":"uses_service"},{"from":"savedChartController","to":"ProjectService","type":"uses_service"},{"from":"savedChartController","to":"PromoteService","type":"uses_service"},{"from":"savedChartController","to":"SavedChartService","type":"uses_service"},{"from":"schedulerController","to":"SchedulerService","type":"uses_service"},{"from":"shareController","to":"ShareService","type":"uses_service"},{"from":"slackController","to":"DownloadFileService","type":"uses_service"},{"from":"slackController","to":"SlackIntegrationService","type":"uses_service"},{"from":"slackController","to":"UserService","type":"uses_service"},{"from":"spaceController","to":"SpaceService","type":"uses_service"},{"from":"spotlightController","to":"SpotlightService","type":"uses_service"},{"from":"sqlRunnerController","to":"GitIntegrationService","type":"uses_service"},{"from":"sqlRunnerController","to":"ProjectService","type":"uses_service"},{"from":"sqlRunnerController","to":"SavedSqlService","type":"uses_service"},{"from":"sshController","to":"SshKeyPairService","type":"uses_service"},{"from":"userActivityController","to":"AnalyticsService","type":"uses_service"},{"from":"userAttributesController","to":"UserAttributesService","type":"uses_service"},{"from":"userController","to":"PersonalAccessTokenService","type":"uses_service"},{"from":"userController","to":"UserService","type":"uses_service"},{"from":"validationController","to":"ValidationService","type":"uses_service"},{"from":"v2/ContentController","to":"ContentService","type":"uses_service"},{"from":"v2/DashboardController","to":"DashboardService","type":"uses_service"},{"from":"v2/FeatureFlagController","to":"FeatureFlagService","type":"uses_service"},{"from":"v2/ParametersController","to":"ProjectParametersService","type":"uses_service"},{"from":"v2/ParametersController","to":"ProjectService","type":"uses_service"},{"from":"v2/QueryController","to":"AsyncQueryService","type":"uses_service"},{"from":"v2/SavedChartController","to":"SavedChartService","type":"uses_service"},{"from":"apiV1Router","to":"HealthService","type":"router_uses_service"},{"from":"dashboardRouter","to":"AnalyticsService","type":"router_uses_service"},{"from":"dashboardRouter","to":"CsvService","type":"router_uses_service"},{"from":"dashboardRouter","to":"DashboardService","type":"router_uses_service"},{"from":"dashboardRouter","to":"ProjectService","type":"router_uses_service"},{"from":"dashboardRouter","to":"UnfurlService","type":"router_uses_service"},{"from":"headlessBrowser","to":"UserService","type":"router_uses_service"},{"from":"inviteLinksRouter","to":"UserService","type":"router_uses_service"},{"from":"jobsRouter","to":"ProjectService","type":"router_uses_service"},{"from":"mcpRouter","to":"OauthService","type":"router_uses_service"},{"from":"oauthRouter","to":"OauthService","type":"router_uses_service"},{"from":"organizationRouter","to":"OrganizationService","type":"router_uses_service"},{"from":"organizationRouter","to":"ProjectService","type":"router_uses_service"},{"from":"passwordResetLinksRouter","to":"UserService","type":"router_uses_service"},{"from":"projectRouter","to":"DownloadFileService","type":"router_uses_service"},{"from":"projectRouter","to":"ProjectService","type":"router_uses_service"},{"from":"projectRouter","to":"SavedChartService","type":"router_uses_service"},{"from":"projectRouter","to":"SearchService","type":"router_uses_service"},{"from":"projectRouter","to":"SpaceService","type":"router_uses_service"},{"from":"savedChartRouter","to":"ProjectService","type":"router_uses_service"},{"from":"savedChartRouter","to":"SavedChartService","type":"router_uses_service"},{"from":"userRouter","to":"UserService","type":"router_uses_service"},{"from":"AnalyticsService","to":"AnalyticsModel","type":"injects_model"},{"from":"AnalyticsService","to":"ProjectModel","type":"injects_model"},{"from":"AnalyticsService","to":"CsvService","type":"injects_service"},{"from":"CommentService","to":"CommentModel","type":"injects_model"},{"from":"CommentService","to":"DashboardModel","type":"injects_model"},{"from":"CommentService","to":"FeatureFlagModel","type":"injects_model"},{"from":"CommentService","to":"NotificationsModel","type":"injects_model"},{"from":"CommentService","to":"SpaceModel","type":"injects_model"},{"from":"CommentService","to":"UserModel","type":"injects_model"},{"from":"CsvService","to":"DashboardModel","type":"injects_model"},{"from":"CsvService","to":"DownloadFileModel","type":"injects_model"},{"from":"CsvService","to":"ProjectModel","type":"injects_model"},{"from":"CsvService","to":"SavedChartModel","type":"injects_model"},{"from":"CsvService","to":"SavedSqlModel","type":"injects_model"},{"from":"CsvService","to":"UserModel","type":"injects_model"},{"from":"CsvService","to":"S3Client","type":"injects_client"},{"from":"CsvService","to":"SchedulerClient","type":"injects_client"},{"from":"CsvService","to":"PivotTableService","type":"injects_service"},{"from":"CsvService","to":"ProjectService","type":"injects_service"},{"from":"DashboardService","to":"AnalyticsModel","type":"injects_model"},{"from":"DashboardService","to":"CatalogModel","type":"injects_model"},{"from":"DashboardService","to":"DashboardModel","type":"injects_model"},{"from":"DashboardService","to":"FeatureFlagModel","type":"injects_model"},{"from":"DashboardService","to":"PinnedListModel","type":"injects_model"},{"from":"DashboardService","to":"ProjectModel","type":"injects_model"},{"from":"DashboardService","to":"SavedChartModel","type":"injects_model"},{"from":"DashboardService","to":"SchedulerModel","type":"injects_model"},{"from":"DashboardService","to":"SpaceModel","type":"injects_model"},{"from":"DashboardService","to":"SchedulerClient","type":"injects_client"},{"from":"DashboardService","to":"SlackClient","type":"injects_client"},{"from":"DashboardService","to":"SavedChartService","type":"injects_service"},{"from":"DownloadFileService","to":"DownloadFileModel","type":"injects_model"},{"from":"GitIntegrationService","to":"GithubAppInstallationsModel","type":"injects_model"},{"from":"GitIntegrationService","to":"ProjectModel","type":"injects_model"},{"from":"GitIntegrationService","to":"SavedChartModel","type":"injects_model"},{"from":"GitIntegrationService","to":"SpaceModel","type":"injects_model"},{"from":"GithubAppService","to":"GithubAppInstallationsModel","type":"injects_model"},{"from":"GithubAppService","to":"UserModel","type":"injects_model"},{"from":"GitlabAppService","to":"GitlabAppInstallationsModel","type":"injects_model"},{"from":"GitlabAppService","to":"UserModel","type":"injects_model"},{"from":"GdriveService","to":"DashboardModel","type":"injects_model"},{"from":"GdriveService","to":"ProjectModel","type":"injects_model"},{"from":"GdriveService","to":"SavedChartModel","type":"injects_model"},{"from":"GdriveService","to":"UserModel","type":"injects_model"},{"from":"GdriveService","to":"SchedulerClient","type":"injects_client"},{"from":"GdriveService","to":"ProjectService","type":"injects_service"},{"from":"GroupService","to":"GroupsModel","type":"injects_model"},{"from":"GroupService","to":"ProjectModel","type":"injects_model"},{"from":"GroupService","to":"FeatureFlagService","type":"injects_service"},{"from":"HealthService","to":"MigrationModel","type":"injects_model"},{"from":"HealthService","to":"OrganizationModel","type":"injects_model"},{"from":"NotificationService","to":"NotificationsModel","type":"injects_model"},{"from":"OauthService","to":"OauthModel","type":"injects_model"},{"from":"OauthService","to":"UserModel","type":"injects_model"},{"from":"OrganizationService","to":"GroupsModel","type":"injects_model"},{"from":"OrganizationService","to":"OnboardingModel","type":"injects_model"},{"from":"OrganizationService","to":"OrganizationAllowedEmailDomainsModel","type":"injects_model"},{"from":"OrganizationService","to":"OrganizationMemberProfileModel","type":"injects_model"},{"from":"OrganizationService","to":"OrganizationModel","type":"injects_model"},{"from":"OrganizationService","to":"ProjectModel","type":"injects_model"},{"from":"OrganizationService","to":"UserModel","type":"injects_model"},{"from":"PermissionsService","to":"DashboardModel","type":"injects_model"},{"from":"PersonalAccessTokenService","to":"PersonalAccessTokenModel","type":"injects_model"},{"from":"PinningService","to":"DashboardModel","type":"injects_model"},{"from":"PinningService","to":"FeatureFlagModel","type":"injects_model"},{"from":"PinningService","to":"PinnedListModel","type":"injects_model"},{"from":"PinningService","to":"ProjectModel","type":"injects_model"},{"from":"PinningService","to":"ResourceViewItemModel","type":"injects_model"},{"from":"PinningService","to":"SavedChartModel","type":"injects_model"},{"from":"PinningService","to":"SpaceModel","type":"injects_model"},{"from":"PivotTableService","to":"DownloadFileModel","type":"injects_model"},{"from":"PivotTableService","to":"S3Client","type":"injects_client"},{"from":"ProjectService","to":"AnalyticsModel","type":"injects_model"},{"from":"ProjectService","to":"CatalogModel","type":"injects_model"},{"from":"ProjectService","to":"ContentModel","type":"injects_model"},{"from":"ProjectService","to":"DashboardModel","type":"injects_model"},{"from":"ProjectService","to":"DownloadFileModel","type":"injects_model"},{"from":"ProjectService","to":"EmailModel","type":"injects_model"},{"from":"ProjectService","to":"FeatureFlagModel","type":"injects_model"},{"from":"ProjectService","to":"GroupsModel","type":"injects_model"},{"from":"ProjectService","to":"JobModel","type":"injects_model"},{"from":"ProjectService","to":"OnboardingModel","type":"injects_model"},{"from":"ProjectService","to":"OrganizationWarehouseCredentialsModel","type":"injects_model"},{"from":"ProjectService","to":"ProjectCompileLogModel","type":"injects_model"},{"from":"ProjectService","to":"ProjectModel","type":"injects_model"},{"from":"ProjectService","to":"ProjectParametersModel","type":"injects_model"},{"from":"ProjectService","to":"SavedChartModel","type":"injects_model"},{"from":"ProjectService","to":"SpaceModel","type":"injects_model"},{"from":"ProjectService","to":"SshKeyPairModel","type":"injects_model"},{"from":"ProjectService","to":"TagsModel","type":"injects_model"},{"from":"ProjectService","to":"UserAttributesModel","type":"injects_model"},{"from":"ProjectService","to":"UserModel","type":"injects_model"},{"from":"ProjectService","to":"UserWarehouseCredentialsModel","type":"injects_model"},{"from":"ProjectService","to":"WarehouseAvailableTablesModel","type":"injects_model"},{"from":"ProjectService","to":"EmailClient","type":"injects_client"},{"from":"ProjectService","to":"S3CacheClient","type":"injects_client"},{"from":"ProjectService","to":"S3Client","type":"injects_client"},{"from":"ProjectService","to":"SchedulerClient","type":"injects_client"},{"from":"AsyncQueryService","to":"AnalyticsModel","type":"injects_model"},{"from":"AsyncQueryService","to":"CatalogModel","type":"injects_model"},{"from":"AsyncQueryService","to":"ContentModel","type":"injects_model"},{"from":"AsyncQueryService","to":"DashboardModel","type":"injects_model"},{"from":"AsyncQueryService","to":"DownloadAuditModel","type":"injects_model"},{"from":"AsyncQueryService","to":"DownloadFileModel","type":"injects_model"},{"from":"AsyncQueryService","to":"EmailModel","type":"injects_model"},{"from":"AsyncQueryService","to":"FeatureFlagModel","type":"injects_model"},{"from":"AsyncQueryService","to":"GroupsModel","type":"injects_model"},{"from":"AsyncQueryService","to":"JobModel","type":"injects_model"},{"from":"AsyncQueryService","to":"OnboardingModel","type":"injects_model"},{"from":"AsyncQueryService","to":"OrganizationWarehouseCredentialsModel","type":"injects_model"},{"from":"AsyncQueryService","to":"ProjectCompileLogModel","type":"injects_model"},{"from":"AsyncQueryService","to":"ProjectModel","type":"injects_model"},{"from":"AsyncQueryService","to":"ProjectParametersModel","type":"injects_model"},{"from":"AsyncQueryService","to":"QueryHistoryModel","type":"injects_model"},{"from":"AsyncQueryService","to":"SavedChartModel","type":"injects_model"},{"from":"AsyncQueryService","to":"SavedSqlModel","type":"injects_model"},{"from":"AsyncQueryService","to":"SpaceModel","type":"injects_model"},{"from":"AsyncQueryService","to":"SshKeyPairModel","type":"injects_model"},{"from":"AsyncQueryService","to":"TagsModel","type":"injects_model"},{"from":"AsyncQueryService","to":"UserAttributesModel","type":"injects_model"},{"from":"AsyncQueryService","to":"UserModel","type":"injects_model"},{"from":"AsyncQueryService","to":"UserWarehouseCredentialsModel","type":"injects_model"},{"from":"AsyncQueryService","to":"WarehouseAvailableTablesModel","type":"injects_model"},{"from":"AsyncQueryService","to":"EmailClient","type":"injects_client"},{"from":"AsyncQueryService","to":"ResultsFileStorageClient","type":"injects_client"},{"from":"AsyncQueryService","to":"S3CacheClient","type":"injects_client"},{"from":"AsyncQueryService","to":"S3Client","type":"injects_client"},{"from":"AsyncQueryService","to":"SchedulerClient","type":"injects_client"},{"from":"AsyncQueryService","to":"PermissionsService","type":"injects_service"},{"from":"AsyncQueryService","to":"PivotTableService","type":"injects_service"},{"from":"SavedChartService","to":"AnalyticsModel","type":"injects_model"},{"from":"SavedChartService","to":"CatalogModel","type":"injects_model"},{"from":"SavedChartService","to":"DashboardModel","type":"injects_model"},{"from":"SavedChartService","to":"FeatureFlagModel","type":"injects_model"},{"from":"SavedChartService","to":"PinnedListModel","type":"injects_model"},{"from":"SavedChartService","to":"ProjectModel","type":"injects_model"},{"from":"SavedChartService","to":"SavedChartModel","type":"injects_model"},{"from":"SavedChartService","to":"SchedulerModel","type":"injects_model"},{"from":"SavedChartService","to":"SpaceModel","type":"injects_model"},{"from":"SavedChartService","to":"GoogleDriveClient","type":"injects_client"},{"from":"SavedChartService","to":"SchedulerClient","type":"injects_client"},{"from":"SavedChartService","to":"SlackClient","type":"injects_client"},{"from":"SavedChartService","to":"PermissionsService","type":"injects_service"},{"from":"SavedChartService","to":"UserService","type":"injects_service"},{"from":"SchedulerService","to":"DashboardModel","type":"injects_model"},{"from":"SchedulerService","to":"FeatureFlagModel","type":"injects_model"},{"from":"SchedulerService","to":"JobModel","type":"injects_model"},{"from":"SchedulerService","to":"ProjectModel","type":"injects_model"},{"from":"SchedulerService","to":"SavedChartModel","type":"injects_model"},{"from":"SchedulerService","to":"SchedulerModel","type":"injects_model"},{"from":"SchedulerService","to":"SpaceModel","type":"injects_model"},{"from":"SchedulerService","to":"UserModel","type":"injects_model"},{"from":"SchedulerService","to":"GoogleDriveClient","type":"injects_client"},{"from":"SchedulerService","to":"SchedulerClient","type":"injects_client"},{"from":"SchedulerService","to":"SlackClient","type":"injects_client"},{"from":"SchedulerService","to":"UserService","type":"injects_service"},{"from":"SearchService","to":"FeatureFlagModel","type":"injects_model"},{"from":"SearchService","to":"ProjectModel","type":"injects_model"},{"from":"SearchService","to":"SearchModel","type":"injects_model"},{"from":"SearchService","to":"SpaceModel","type":"injects_model"},{"from":"SearchService","to":"UserAttributesModel","type":"injects_model"},{"from":"ShareService","to":"ShareModel","type":"injects_model"},{"from":"SshKeyPairService","to":"SshKeyPairModel","type":"injects_model"},{"from":"SlackIntegrationService","to":"SlackAuthenticationModel","type":"injects_model"},{"from":"SlackIntegrationService","to":"SlackClient","type":"injects_client"},{"from":"SpacePermissionService","to":"SpaceModel","type":"injects_model"},{"from":"SpacePermissionService","to":"SpacePermissionModel","type":"injects_model"},{"from":"SpaceService","to":"FeatureFlagModel","type":"injects_model"},{"from":"SpaceService","to":"PinnedListModel","type":"injects_model"},{"from":"SpaceService","to":"ProjectModel","type":"injects_model"},{"from":"SpaceService","to":"SpaceModel","type":"injects_model"},{"from":"UnfurlService","to":"DashboardModel","type":"injects_model"},{"from":"UnfurlService","to":"DownloadFileModel","type":"injects_model"},{"from":"UnfurlService","to":"FeatureFlagModel","type":"injects_model"},{"from":"UnfurlService","to":"ProjectModel","type":"injects_model"},{"from":"UnfurlService","to":"SavedChartModel","type":"injects_model"},{"from":"UnfurlService","to":"ShareModel","type":"injects_model"},{"from":"UnfurlService","to":"SlackAuthenticationModel","type":"injects_model"},{"from":"UnfurlService","to":"SpaceModel","type":"injects_model"},{"from":"UnfurlService","to":"S3Client","type":"injects_client"},{"from":"UnfurlService","to":"SlackClient","type":"injects_client"},{"from":"UserAttributesService","to":"UserAttributesModel","type":"injects_model"},{"from":"UserService","to":"EmailModel","type":"injects_model"},{"from":"UserService","to":"GroupsModel","type":"injects_model"},{"from":"UserService","to":"InviteLinkModel","type":"injects_model"},{"from":"UserService","to":"OpenIdIdentityModel","type":"injects_model"},{"from":"UserService","to":"OrganizationAllowedEmailDomainsModel","type":"injects_model"},{"from":"UserService","to":"OrganizationMemberProfileModel","type":"injects_model"},{"from":"UserService","to":"OrganizationModel","type":"injects_model"},{"from":"UserService","to":"PasswordResetLinkModel","type":"injects_model"},{"from":"UserService","to":"PersonalAccessTokenModel","type":"injects_model"},{"from":"UserService","to":"SessionModel","type":"injects_model"},{"from":"UserService","to":"UserModel","type":"injects_model"},{"from":"UserService","to":"UserWarehouseCredentialsModel","type":"injects_model"},{"from":"UserService","to":"WarehouseAvailableTablesModel","type":"injects_model"},{"from":"UserService","to":"EmailClient","type":"injects_client"},{"from":"ValidationService","to":"DashboardModel","type":"injects_model"},{"from":"ValidationService","to":"FeatureFlagModel","type":"injects_model"},{"from":"ValidationService","to":"ProjectModel","type":"injects_model"},{"from":"ValidationService","to":"SavedChartModel","type":"injects_model"},{"from":"ValidationService","to":"SpaceModel","type":"injects_model"},{"from":"ValidationService","to":"ValidationModel","type":"injects_model"},{"from":"ValidationService","to":"SchedulerClient","type":"injects_client"},{"from":"CoderService","to":"DashboardModel","type":"injects_model"},{"from":"CoderService","to":"FeatureFlagModel","type":"injects_model"},{"from":"CoderService","to":"ProjectModel","type":"injects_model"},{"from":"CoderService","to":"SavedChartModel","type":"injects_model"},{"from":"CoderService","to":"SavedSqlModel","type":"injects_model"},{"from":"CoderService","to":"SpaceModel","type":"injects_model"},{"from":"CoderService","to":"SchedulerClient","type":"injects_client"},{"from":"CoderService","to":"PromoteService","type":"injects_service"},{"from":"CatalogService","to":"CatalogModel","type":"injects_model"},{"from":"CatalogService","to":"ChangesetModel","type":"injects_model"},{"from":"CatalogService","to":"FeatureFlagModel","type":"injects_model"},{"from":"CatalogService","to":"ProjectModel","type":"injects_model"},{"from":"CatalogService","to":"SavedChartModel","type":"injects_model"},{"from":"CatalogService","to":"SpaceModel","type":"injects_model"},{"from":"CatalogService","to":"TagsModel","type":"injects_model"},{"from":"CatalogService","to":"UserAttributesModel","type":"injects_model"},{"from":"ChangesetService","to":"CatalogModel","type":"injects_model"},{"from":"ChangesetService","to":"ChangesetModel","type":"injects_model"},{"from":"ChangesetService","to":"ProjectModel","type":"injects_model"},{"from":"MetricsExplorerService","to":"ProjectModel","type":"injects_model"},{"from":"MetricsExplorerService","to":"AsyncQueryService","type":"injects_service"},{"from":"MetricsExplorerService","to":"CatalogService","type":"injects_service"},{"from":"MetricsExplorerService","to":"ProjectService","type":"injects_service"},{"from":"PromoteService","to":"DashboardModel","type":"injects_model"},{"from":"PromoteService","to":"FeatureFlagModel","type":"injects_model"},{"from":"PromoteService","to":"ProjectModel","type":"injects_model"},{"from":"PromoteService","to":"SavedChartModel","type":"injects_model"},{"from":"PromoteService","to":"SpaceModel","type":"injects_model"},{"from":"RenameService","to":"DashboardModel","type":"injects_model"},{"from":"RenameService","to":"ProjectModel","type":"injects_model"},{"from":"RenameService","to":"SavedChartModel","type":"injects_model"},{"from":"RenameService","to":"SchedulerModel","type":"injects_model"},{"from":"RenameService","to":"SchedulerClient","type":"injects_client"},{"from":"SavedSqlService","to":"AnalyticsModel","type":"injects_model"},{"from":"SavedSqlService","to":"FeatureFlagModel","type":"injects_model"},{"from":"SavedSqlService","to":"ProjectModel","type":"injects_model"},{"from":"SavedSqlService","to":"SavedSqlModel","type":"injects_model"},{"from":"SavedSqlService","to":"SpaceModel","type":"injects_model"},{"from":"SavedSqlService","to":"SchedulerClient","type":"injects_client"},{"from":"ContentService","to":"ContentModel","type":"injects_model"},{"from":"ContentService","to":"FeatureFlagModel","type":"injects_model"},{"from":"ContentService","to":"ProjectModel","type":"injects_model"},{"from":"ContentService","to":"SpaceModel","type":"injects_model"},{"from":"ContentService","to":"DashboardService","type":"injects_service"},{"from":"ContentService","to":"SavedChartService","type":"injects_service"},{"from":"ContentService","to":"SavedSqlService","type":"injects_service"},{"from":"ContentService","to":"SpaceService","type":"injects_service"},{"from":"FeatureFlagService","to":"FeatureFlagModel","type":"injects_model"},{"from":"FunnelService","to":"ProjectModel","type":"injects_model"},{"from":"FunnelService","to":"ProjectService","type":"injects_service"},{"from":"RolesService","to":"GroupsModel","type":"injects_model"},{"from":"RolesService","to":"OrganizationModel","type":"injects_model"},{"from":"RolesService","to":"ProjectModel","type":"injects_model"},{"from":"RolesService","to":"RolesModel","type":"injects_model"},{"from":"RolesService","to":"UserModel","type":"injects_model"},{"from":"RolesService","to":"EmailClient","type":"injects_client"},{"from":"SpotlightService","to":"ProjectModel","type":"injects_model"},{"from":"SpotlightService","to":"SpotlightTableConfigModel","type":"injects_model"},{"from":"LightdashAnalyticsService","to":"ProjectModel","type":"injects_model"},{"from":"LightdashAnalyticsService","to":"SavedChartModel","type":"injects_model"},{"from":"ProjectParametersService","to":"ProjectModel","type":"injects_model"},{"from":"ProjectParametersService","to":"ProjectParametersModel","type":"injects_model"},{"from":"ProjectCompileLogService","to":"ProjectCompileLogModel","type":"injects_model"},{"from":"SlackService","to":"SlackClient","type":"injects_client"},{"from":"SlackService","to":"UnfurlService","type":"injects_service"},{"from":"ee/AiAgentAdminController","to":"AiAgentAdminService","type":"uses_service"},{"from":"ee/AiAgentAdminController","to":"AiOrganizationSettingsService","type":"uses_service"},{"from":"ee/CustomRolesController","to":"RolesService","type":"uses_service"},{"from":"ee/OrganizationWarehouseCredentialsController","to":"OrganizationWarehouseCredentialsService","type":"uses_service"},{"from":"ee/aiAgentController","to":"AiAgentService","type":"uses_service"},{"from":"ee/aiController","to":"AiService","type":"uses_service"},{"from":"ee/databricksSSOController","to":"UserService","type":"uses_service"},{"from":"ee/embedController","to":"EmbedService","type":"uses_service"},{"from":"ee/scimGroupController","to":"ScimService","type":"uses_service"},{"from":"ee/scimOrganizationAccessTokenController","to":"ServiceAccountService","type":"uses_service"},{"from":"ee/scimRoleController","to":"ScimService","type":"uses_service"},{"from":"ee/scimUserController","to":"ScimService","type":"uses_service"},{"from":"ee/serviceAccountsController","to":"ServiceAccountService","type":"uses_service"},{"from":"ee/snowflakeController","to":"UserService","type":"uses_service"},{"from":"ee/supportController","to":"SupportService","type":"uses_service"},{"from":"EmbedService","to":"DashboardModel","type":"injects_model"},{"from":"EmbedService","to":"EmbedModel","type":"injects_model"},{"from":"EmbedService","to":"FeatureFlagModel","type":"injects_model"},{"from":"EmbedService","to":"OrganizationModel","type":"injects_model"},{"from":"EmbedService","to":"ProjectModel","type":"injects_model"},{"from":"EmbedService","to":"SavedChartModel","type":"injects_model"},{"from":"EmbedService","to":"UserAttributesModel","type":"injects_model"},{"from":"EmbedService","to":"AsyncQueryService","type":"injects_service"},{"from":"EmbedService","to":"ProjectService","type":"injects_service"},{"from":"AiService","to":"DashboardModel","type":"injects_model"},{"from":"AiService","to":"DashboardSummaryModel","type":"injects_model"},{"from":"AiService","to":"FeatureFlagService","type":"injects_service"},{"from":"AiService","to":"ProjectService","type":"injects_service"},{"from":"AiAgentService","to":"AiAgentModel","type":"injects_model"},{"from":"AiAgentService","to":"CatalogModel","type":"injects_model"},{"from":"AiAgentService","to":"ChangesetModel","type":"injects_model"},{"from":"AiAgentService","to":"GroupsModel","type":"injects_model"},{"from":"AiAgentService","to":"OpenIdIdentityModel","type":"injects_model"},{"from":"AiAgentService","to":"ProjectModel","type":"injects_model"},{"from":"AiAgentService","to":"SearchModel","type":"injects_model"},{"from":"AiAgentService","to":"SlackAuthenticationModel","type":"injects_model"},{"from":"AiAgentService","to":"UserAttributesModel","type":"injects_model"},{"from":"AiAgentService","to":"UserModel","type":"injects_model"},{"from":"AiAgentService","to":"SchedulerClient","type":"injects_client"},{"from":"AiAgentService","to":"SlackClient","type":"injects_client"},{"from":"AiAgentService","to":"AiOrganizationSettingsService","type":"injects_service"},{"from":"AiAgentService","to":"AsyncQueryService","type":"injects_service"},{"from":"AiAgentService","to":"CatalogService","type":"injects_service"},{"from":"AiAgentService","to":"FeatureFlagService","type":"injects_service"},{"from":"AiAgentService","to":"ProjectService","type":"injects_service"},{"from":"AiAgentService","to":"ShareService","type":"injects_service"},{"from":"AiAgentService","to":"SpaceService","type":"injects_service"},{"from":"AiAgentAdminService","to":"AiAgentModel","type":"injects_model"},{"from":"AiOrganizationSettingsService","to":"AiOrganizationSettingsModel","type":"injects_model"},{"from":"AiOrganizationSettingsService","to":"FeatureFlagModel","type":"injects_model"},{"from":"AiOrganizationSettingsService","to":"OrganizationModel","type":"injects_model"},{"from":"ScimService","to":"EmailModel","type":"injects_model"},{"from":"ScimService","to":"FeatureFlagModel","type":"injects_model"},{"from":"ScimService","to":"GroupsModel","type":"injects_model"},{"from":"ScimService","to":"OpenIdIdentityModel","type":"injects_model"},{"from":"ScimService","to":"OrganizationMemberProfileModel","type":"injects_model"},{"from":"ScimService","to":"ProjectModel","type":"injects_model"},{"from":"ScimService","to":"RolesModel","type":"injects_model"},{"from":"ScimService","to":"ServiceAccountModel","type":"injects_model"},{"from":"ScimService","to":"UserModel","type":"injects_model"},{"from":"ServiceAccountService","to":"FeatureFlagModel","type":"injects_model"},{"from":"ServiceAccountService","to":"ServiceAccountModel","type":"injects_model"},{"from":"SlackIntegrationService","to":"AiAgentModel","type":"injects_model"},{"from":"SupportService","to":"DashboardModel","type":"injects_model"},{"from":"SupportService","to":"OrganizationModel","type":"injects_model"},{"from":"SupportService","to":"ProjectModel","type":"injects_model"},{"from":"SupportService","to":"SavedChartModel","type":"injects_model"},{"from":"SupportService","to":"SpaceModel","type":"injects_model"},{"from":"SupportService","to":"S3Client","type":"injects_client"},{"from":"SupportService","to":"ProjectService","type":"injects_service"},{"from":"SupportService","to":"UnfurlService","type":"injects_service"},{"from":"OrganizationWarehouseCredentialsService","to":"OrganizationWarehouseCredentialsModel","type":"injects_model"},{"from":"OrganizationWarehouseCredentialsService","to":"UserModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"EmailModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"EmbedModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"OrganizationAllowedEmailDomainsModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"OrganizationModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"PersonalAccessTokenModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"ProjectModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"ServiceAccountModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"UserModel","type":"injects_model"},{"from":"InstanceConfigurationService","to":"ProjectService","type":"injects_service"},{"from":"AsyncQueryService","to":"CacheService","type":"injects_service"},{"from":"CacheService","to":"QueryHistoryModel","type":"injects_model"},{"from":"CacheService","to":"ResultsFileStorageClient","type":"injects_client"},{"from":"McpService","to":"McpContextModel","type":"injects_model"},{"from":"McpService","to":"ProjectModel","type":"injects_model"},{"from":"McpService","to":"SearchModel","type":"injects_model"},{"from":"McpService","to":"UserAttributesModel","type":"injects_model"},{"from":"McpService","to":"AsyncQueryService","type":"injects_service"},{"from":"McpService","to":"CatalogService","type":"injects_service"},{"from":"McpService","to":"FeatureFlagService","type":"injects_service"},{"from":"McpService","to":"ProjectService","type":"injects_service"},{"from":"McpService","to":"SpaceService","type":"injects_service"},{"from":"SlackService","to":"AiAgentService","type":"injects_service"},{"from":"ee/scimOrganizationAccessTokenController","to":"ee/serviceAccountsController","type":"shares_code","duplication":{"cloneCount":2,"totalLines":25,"fragments":[{"lines":7,"fragment":"): Promise<{ status: 'ok'; results: ServiceAccount }> {\n        const token = await this.getServiceAccountService().create({\n            user: req.user!,\n            tokenDetails: {\n                ...body,\n                organizationUuid: req.user?.organizationUuid as string,\n                scope","firstStart":79,"firstEnd":85,"secondStart":75,"secondEnd":81},{"lines":18,"fragment":"(\n        @Request() req: express.Request,\n        @Path() tokenUuid: string,\n    ): Promise<{ status: 'ok'; results: undefined }> {\n        await this.getServiceAccountService().delete({\n            user: req.user!,\n            tokenUuid,\n        });\n        return {\n            status: 'ok',\n     ","firstStart":107,"firstEnd":124,"secondStart":101,"secondEnd":115}],"advice":"Extract ServiceAccount CRUD ops into shared BaseServiceAccountController"}},{"from":"ee/scimGroupController","to":"ee/scimUserController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":26,"fragments":[{"lines":26,"fragment":",\n} from '@lightdash/common';\nimport {\n    Body,\n    Delete,\n    Example,\n    Get,\n    Middlewares,\n    OperationId,\n    Patch,\n    Path,\n    Post,\n    Put,\n    Query,\n    Request,\n    Response,\n    Route,\n    Tags,\n} from '@tsoa/runtime';\nimport express from 'express';\nimport { ScimPatch } from 'sc","firstStart":6,"firstEnd":31,"secondStart":6,"secondEnd":31}],"advice":"TSOA import block - not worth extracting, framework boilerplate"}},{"from":"v2/DashboardController","to":"v2/SavedChartController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":23,"fragments":[{"lines":23,"fragment":",\n    type KnexPaginateArgs,\n} from '@lightdash/common';\nimport {\n    Get,\n    Middlewares,\n    OperationId,\n    Path,\n    Query,\n    Request,\n    Response,\n    Route,\n    SuccessResponse,\n    Tags,\n} from '@tsoa/runtime';\nimport express from 'express';\nimport {\n    allowApiKeyAuthentication,\n    is","firstStart":4,"firstEnd":26,"secondStart":4,"secondEnd":26}],"advice":"TSOA import block - framework pattern, ignore unless migrating"}},{"from":"userActivityController","to":"validationController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":26,"fragments":[{"lines":26,"fragment":",\n    ApiValidateResponse,\n    ApiValidationDismissResponse,\n    getRequestMethod,\n    LightdashRequestMethodHeader,\n    ValidationTarget,\n} from '@lightdash/common';\nimport {\n    Body,\n    Delete,\n    Get,\n    Middlewares,\n    OperationId,\n    Path,\n    Post,\n    Query,\n    Request,\n    Response,\n ","firstStart":7,"firstEnd":32,"secondStart":4,"secondEnd":27}],"advice":"TSOA import block with shared validation types - keep separate"}},{"from":"sqlRunnerController","to":"v2/QueryController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":21,"fragments":[{"lines":21,"fragment":");\n\n        const { res } = req;\n        if (res) {\n            readStream.pipe(res);\n            await new Promise<void>((resolve, reject) => {\n                readStream.on('end', () => {\n                    res.end();\n                    resolve();\n                });\n            });\n        }\n  ","firstStart":195,"firstEnd":215,"secondStart":448,"secondEnd":465}],"advice":"Extract CSV stream-to-response helper into downloadHelpers.ts"}},{"from":"projectRouter","to":"slackController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":15,"fragments":[{"lines":15,"fragment":"{\n        const { nanoId } = req.params;\n        const { path: filePath } = await req.services\n            .getDownloadFileService()\n            .getDownloadFile(nanoId);\n        const filename = path.basename(filePath);\n        const normalizedPath = path.resolve('/tmp/', filename);\n        if (!no","firstStart":184,"firstEnd":198,"secondStart":78,"secondEnd":91}],"advice":"Extract file download security check into downloadFileMiddleware.ts"}},{"from":"runQueryController","to":"savedChartController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":17,"fragments":[{"lines":17,"fragment":": string,\n        @Request() req: express.Request,\n    ): Promise<ApiRunQueryResponse> {\n        const context = getContextFromHeader(req);\n        await this.services\n            .getLightdashAnalyticsService()\n            .trackDeprecatedRouteCalled(\n                {\n                    event: 'd","firstStart":69,"firstEnd":85,"secondStart":216,"secondEnd":92}],"advice":"Extract deprecation tracking call into trackDeprecatedRoute middleware"}},{"from":"renameController","to":"spotlightController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":21,"fragments":[{"lines":21,"fragment":",\n    Get,\n    Middlewares,\n    OperationId,\n    Path,\n    Post,\n    Request,\n    Response,\n    Route,\n    SuccessResponse,\n    Tags,\n} from '@tsoa/runtime';\nimport express from 'express';\nimport {\n    allowApiKeyAuthentication,\n    isAuthenticated,\n    unauthorisedInDemo,\n} from './authentication';","firstStart":12,"firstEnd":32,"secondStart":10,"secondEnd":30}],"advice":"TSOA import block - framework boilerplate, not actionable"}},{"from":"organizationController","to":"userController","type":"shares_code","duplication":{"cloneCount":2,"totalLines":46,"fragments":[{"lines":25,"fragment":");\n        const sessionUser = await req.services\n            .getUserService()\n            .getSessionByUserUuid(req.user!.userUuid);\n        await new Promise<void>((resolve, reject) => {\n            req.login(sessionUser, (err) => {\n                if (err) {\n                    reject(err);\n    ","firstStart":97,"firstEnd":121,"secondStart":200,"secondEnd":223},{"lines":21,"fragment":");\n        await new Promise<void>((resolve, reject) => {\n            req.session.destroy((err) => {\n                if (err) {\n                    reject(err);\n                }\n                resolve();\n            });\n        });\n        this.setStatus(200);\n        return {\n            status: ","firstStart":152,"firstEnd":172,"secondStart":232,"secondEnd":252}],"advice":"Extract session login/destroy ops into sessionHelpers.ts (46 lines)"}},{"from":"githubController","to":"gitlabController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":15,"fragments":[{"lines":15,"fragment":");\n\n        req.session.oauth = {};\n        req.session.oauth.returnTo = context.returnToUrl;\n        req.session.oauth.state = context.state;\n        req.session.oauth.inviteCode = context.inviteCode;\n\n        this.setStatus(302);\n        this.setHeader('Location', context.installUrl);\n    }\n\n    /","firstStart":48,"firstEnd":62,"secondStart":48,"secondEnd":66}],"advice":"Extract OAuth state management into shared oauthHelpers.ts utility"}},{"from":"funnelController","to":"validationController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":18,"fragments":[{"lines":18,"fragment":",\n    Get,\n    Middlewares,\n    OperationId,\n    Path,\n    Post,\n    Query,\n    Request,\n    Response,\n    Route,\n    SuccessResponse,\n    Tags,\n} from '@tsoa/runtime';\nimport express from 'express';\nimport { allowApiKeyAuthentication, isAuthenticated } from './authentication';\nimport { BaseControll","firstStart":8,"firstEnd":25,"secondStart":13,"secondEnd":30}],"advice":"TSOA import block - standard framework pattern"}},{"from":"exploreController","to":"runQueryController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":12,"fragments":[{"lines":12,"fragment":";\n        const metricQuery: MetricQuery = {\n            exploreName: body.exploreName,\n            dimensions: body.dimensions,\n            metrics: body.metrics,\n            filters: body.filters,\n            sorts: body.sorts,\n            limit: body.limit,\n            tableCalculations: body.tab","firstStart":197,"firstEnd":208,"secondStart":87,"secondEnd":99}],"advice":"Extract MetricQuery builder into metricQueryHelpers.ts utility"}},{"from":"dashboardController","to":"spotlightController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":21,"fragments":[{"lines":21,"fragment":",\n    Get,\n    Middlewares,\n    OperationId,\n    Path,\n    Post,\n    Request,\n    Response,\n    Route,\n    SuccessResponse,\n    Tags,\n} from '@tsoa/runtime';\nimport express from 'express';\nimport {\n    allowApiKeyAuthentication,\n    isAuthenticated,\n    unauthorisedInDemo,\n} from './authentication';","firstStart":10,"firstEnd":30,"secondStart":10,"secondEnd":30}],"advice":"TSOA import block - framework boilerplate, acceptable"}},{"from":"commentsController","to":"spaceController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":26,"fragments":[{"lines":26,"fragment":",\n} from '@lightdash/common';\nimport {\n    Body,\n    Delete,\n    Get,\n    Middlewares,\n    OperationId,\n    Patch,\n    Path,\n    Post,\n    Request,\n    Response,\n    Route,\n    SuccessResponse,\n    Tags,\n} from '@tsoa/runtime';\nimport express from 'express';\nimport {\n    allowApiKeyAuthentication,\n ","firstStart":6,"firstEnd":31,"secondStart":8,"secondEnd":33}],"advice":"TSOA import block - standard controller setup pattern"}},{"from":"OrganizationRolesController","to":"userActivityController","type":"shares_code","duplication":{"cloneCount":1,"totalLines":32,"fragments":[{"lines":32,"fragment":",\n    Get,\n    Middlewares,\n    OperationId,\n    Path,\n    Post,\n    Query,\n    Request,\n    Response,\n    Route,\n    SuccessResponse,\n    Tags,\n} from '@tsoa/runtime';\nimport express from 'express';\nimport {\n    allowApiKeyAuthentication,\n    isAuthenticated,\n    unauthorisedInDemo,\n} from './authe","firstStart":10,"firstEnd":41,"secondStart":16,"secondEnd":37}],"advice":"TSOA import block - framework boilerplate, not worth extracting"}},{"from":"SavedSqlService","to":"SpaceService","type":"shares_code","duplication":{"cloneCount":1,"totalLines":18,"fragments":[{"lines":18,"fragment":",\n            targetSpaceUuid,\n        }: {\n            projectUuid: string;\n            itemUuid: string;\n            targetSpaceUuid: string | null;\n        },\n        {\n            tx,\n            checkForAccess = true,\n            trackEvent = true,\n        }: {\n            tx?: Knex;\n          ","firstStart":561,"firstEnd":578,"secondStart":396,"secondEnd":413}],"advice":"Extract moveToSpace logic into shared SpaceOperationsService mixin"}},{"from":"PinningService","to":"SearchService","type":"shares_code","duplication":{"cloneCount":1,"totalLines":14,"fragments":[{"lines":14,"fragment":");\n\n        const nestedPermissionsFlag = await this.featureFlagModel.get({\n            user: {\n                userUuid: user.userUuid,\n                organizationUuid: user.organizationUuid,\n                organizationName: user.organizationName,\n            },\n            featureFlagId: Feature","firstStart":77,"firstEnd":90,"secondStart":104,"secondEnd":117}],"advice":"Extract nestedPermissionsFlag check into getFeatureFlagForUser helper"}},{"from":"GithubAppService","to":"GitlabAppService","type":"shares_code","duplication":{"cloneCount":1,"totalLines":14,"fragments":[{"lines":14,"fragment":"try {\n            if (!state || state !== oauth?.state) {\n                throw new AuthorizationError('State does not match');\n            }\n\n            const userUuid = oauth.inviteCode;\n            if (!userUuid) {\n                throw new ParameterError('User uuid not provided');\n            }","firstStart":85,"firstEnd":98,"secondStart":108,"secondEnd":122}],"advice":"Extract OAuth state validation into validateOAuthCallback utility"}},{"from":"ContentService","to":"PinningService","type":"shares_code","duplication":{"cloneCount":1,"totalLines":19,"fragments":[{"lines":19,"fragment":".uuid);\n\n        const nestedPermissionsFlag = await this.featureFlagModel.get({\n            user: {\n                userUuid: user.userUuid,\n                organizationUuid: user.organizationUuid,\n                organizationName: user.organizationName,\n            },\n            featureFlagId: Fe","firstStart":121,"firstEnd":139,"secondStart":77,"secondEnd":95}],"advice":"Extract nestedPermissionsFlag check into getFeatureFlagForUser helper"}},{"from":"PersonalAccessTokenService","to":"ServiceAccountService","type":"shares_code","duplication":{"cloneCount":1,"totalLines":15,"fragments":[{"lines":15,"fragment":"// Business decision, we don't want to rotate tokens that don't expire. Rotation is a security feature that should be used with tokens that expire.\n        if (!existingToken.expiresAt) {\n            throw new ParameterError(\n                'Token with no expiration date cannot be rotated',\n       ","firstStart":132,"firstEnd":146,"secondStart":187,"secondEnd":201}],"advice":"Extract token rotation validation into shared tokenHelpers.ts"}}],"stats":{"controllers":41,"routers":12,"services":48,"models":56,"clients":7,"totalEdges":448}};

const hasSentry = raw.nodes.some(n => n.sentryActivity);
if (!hasSentry) { document.querySelectorAll('#size-mode option').forEach(o => { if (o.value === 'traffic' || o.value === 'errors') o.remove(); }); }

const color = { controller: '#79c0ff', router: '#d2a8ff', service: '#7ee787', model: '#ffa657', client: '#f778ba' };
const colorDark = { controller: '#1f6feb', router: '#8957e5', service: '#238636', model: '#9e6a03', client: '#da3633' };

const W = window.innerWidth, H = window.innerHeight;

const nodeIdx = {};
raw.nodes.forEach((n, i) => { nodeIdx[n.id] = i; });

const connCount = {};
raw.edges.forEach(e => {
  connCount[e.from] = (connCount[e.from] || 0) + 1;
  connCount[e.to] = (connCount[e.to] || 0) + 1;
});

function calcRadius(n) {
  const mode = document.getElementById('size-mode').value;
  switch (mode) {
    case 'lines': return Math.max(4, 3 + Math.sqrt((n.lineCount || 100) / 30) * 2.2);
    case 'cyclomatic': return Math.max(4, 3 + Math.sqrt((n.complexity?.cyclomatic || 1) / 5) * 2.2);
    case 'cognitive': return Math.max(4, 3 + Math.sqrt((n.complexity?.cognitive || 1) / 5) * 2.2);
    case 'commits': return Math.max(4, 3 + Math.sqrt((n.gitActivity?.commits || 1) / 8) * 2.2);
    case 'authors': return Math.max(4, 3 + Math.sqrt(n.gitActivity?.authors || 1) * 3);
    case 'churn': return Math.max(4, 3 + Math.sqrt((n.gitActivity?.churn || 0) / 2) * 2.5);
    case 'health': return Math.max(4, 3 + (n.healthScore || 0) * 16);
    case 'duplication': return Math.max(4, 3 + Math.sqrt((n.duplication?.ratio || 0) * 100) * 2);
    case 'traffic': return Math.max(4, 3 + Math.log10((n.sentryActivity?.totalRequests || 1)) * 2.5);
    case 'errors': return Math.max(4, 3 + Math.log10((n.sentryActivity?.totalErrors || 1)) * 2.5);
    default: return Math.max(4, 3 + Math.sqrt(connCount[n.id] || 1) * 2.2);
  }
}

const nodes = raw.nodes.map(n => ({ ...n, r: calcRadius(n) }));

// Health score: normalized composite of coupling, complexity, churn, commits
const hMetrics = {
  coupling: raw.nodes.map(n => connCount[n.id] || 0),
  complexity: raw.nodes.map(n => n.complexity?.cyclomatic || 0),
  churn: raw.nodes.map(n => n.gitActivity?.churn || 0),
  commits: raw.nodes.map(n => n.gitActivity?.commits || 0),
};
function maxNorm(vals) { const mx = Math.max(...vals); return mx === 0 ? vals.map(() => 0) : vals.map(v => v / mx); }
const nCoup = maxNorm(hMetrics.coupling), nComp = maxNorm(hMetrics.complexity);
const nChurn = maxNorm(hMetrics.churn), nComm = maxNorm(hMetrics.commits);
const healthColorScale = d3.scaleLinear().domain([0, 0.5, 1]).range(['#3fb950', '#d29922', '#f47067']).interpolate(d3.interpolateRgb);
const healthStrokeScale = d3.scaleLinear().domain([0, 0.5, 1]).range(['#238636', '#9e6a03', '#da3633']).interpolate(d3.interpolateRgb);
nodes.forEach((n, i) => { n.healthScore = nCoup[i] * 0.3 + nComp[i] * 0.25 + nChurn[i] * 0.3 + nComm[i] * 0.15; });

const trafficMax = Math.max(...raw.nodes.map(n => Math.log10((n.sentryActivity?.totalRequests || 0) + 1)));
function trafficNorm(n) { if (!n.sentryActivity || trafficMax === 0) return -1; return Math.log10(n.sentryActivity.totalRequests + 1) / trafficMax; }
const trafficColorScale = d3.scaleLinear().domain([0, 0.5, 1]).range(['#e2b340', '#e8853a', '#f47067']).interpolate(d3.interpolateRgb);
const trafficStrokeScale = d3.scaleLinear().domain([0, 0.5, 1]).range(['#9e6a03', '#b85c1e', '#da3633']).interpolate(d3.interpolateRgb);

const errorsMax = Math.max(...raw.nodes.map(n => Math.log10((n.sentryActivity?.totalErrors || 0) + 1)));
function errorsNorm(n) { if (!n.sentryActivity || errorsMax === 0) return -1; return Math.log10((n.sentryActivity.totalErrors || 0) + 1) / errorsMax; }
const errorsColorScale = d3.scaleLinear().domain([0, 0.5, 1]).range(['#d29922', '#f47067', '#da3633']).interpolate(d3.interpolateRgb);
const errorsStrokeScale = d3.scaleLinear().domain([0, 0.5, 1]).range(['#9e6a03', '#da3633', '#8b1a1a']).interpolate(d3.interpolateRgb);

function getColorMode() { const m = document.getElementById('size-mode').value; if (m === 'health' || m === 'duplication' || m === 'traffic' || m === 'errors') return m; return 'type'; }
function getNodeColor(d) { const m = getColorMode(); if (m === 'health') return healthColorScale(d.healthScore); if (m === 'duplication') return healthColorScale(d.duplication?.ratio || 0); if (m === 'traffic') { const t = trafficNorm(d); return t < 0 ? '#30363d' : trafficColorScale(t); } if (m === 'errors') { const e = errorsNorm(d); return e < 0 ? '#30363d' : e === 0 ? '#3fb950' : errorsColorScale(e); } return color[d.type]; }
function getNodeStroke(d) { const m = getColorMode(); if (m === 'health') return healthStrokeScale(d.healthScore); if (m === 'duplication') return healthStrokeScale(d.duplication?.ratio || 0); if (m === 'traffic') { const t = trafficNorm(d); return t < 0 ? '#21262d' : trafficStrokeScale(t); } if (m === 'errors') { const e = errorsNorm(d); return e < 0 ? '#21262d' : e === 0 ? '#238636' : errorsStrokeScale(e); } return colorDark[d.type]; }

const links = raw.edges.map(e => ({
  source: nodeIdx[e.from],
  target: nodeIdx[e.to],
  type: e.type
}));

const outgoing = {}, incoming = {};
raw.edges.forEach(e => {
  if (!outgoing[e.from]) outgoing[e.from] = [];
  outgoing[e.from].push({ id: e.to, type: e.type });
  if (!incoming[e.to]) incoming[e.to] = [];
  incoming[e.to].push({ id: e.from, type: e.type });
});

const svg = d3.select('svg').attr('width', W).attr('height', H);

// Arrowhead markers (5 edge types × dim/bright)
const defs = svg.append('defs');
const edgeTypes = [
  { type: 'uses_service', color: '#79c0ff' },
  { type: 'router_uses_service', color: '#d2a8ff' },
  { type: 'injects_model', color: '#ffa657' },
  { type: 'injects_client', color: '#f778ba' },
  { type: 'injects_service', color: '#7ee787' },
  { type: 'shares_code', color: '#f47067' },
];
edgeTypes.forEach(({ type, color: c }) => {
  [{ suffix: '', opacity: 0.15, w: 8, h: 6 }, { suffix: 'hi-', opacity: 0.9, w: 5, h: 3.75 }].forEach(({ suffix, opacity, w, h }) => {
    defs.append('marker')
      .attr('id', 'arrow-' + suffix + type)
      .attr('viewBox', '0 0 10 6')
      .attr('refX', 10).attr('refY', 3)
      .attr('markerWidth', w).attr('markerHeight', h)
      .attr('orient', 'auto')
      .append('path')
      .attr('d', 'M0,0 L10,3 L0,6Z')
      .attr('fill', c)
      .attr('fill-opacity', opacity);
  });
});

const g = svg.append('g');
const zoomBehavior = d3.zoom().scaleExtent([0.05, 10]).on('zoom', e => g.attr('transform', e.transform));
svg.call(zoomBehavior);

const colX = { controller: W * 0.08, router: W * 0.20, service: W * 0.40, model: W * 0.68, client: W * 0.88 };

let domainNames = [];
let domainColor = {};
let domainCenters = {};
const typeOffsetX = { controller: -50, router: -25, service: 0, model: 25, client: 50 };

const domainMap = {};
nodes.forEach(n => {
  if (n.domain) {
    if (!domainMap[n.domain]) domainMap[n.domain] = [];
    domainMap[n.domain].push(n);
  }
});
domainNames = Object.keys(domainMap).sort();
const dCols = Math.ceil(Math.sqrt(domainNames.length * (W / H)));
const dRows = Math.ceil(domainNames.length / dCols);
const cellW = W / (dCols + 1);
const cellH = (H - 60) / (dRows + 1);
const palette = d3.schemeTableau10;

domainNames.forEach((name, i) => {
  const col = i % dCols;
  const row = Math.floor(i / dCols);
  const cx = cellW * (col + 1);
  const cy = cellH * (row + 1) + 40;
  domainCenters[name] = { x: cx, y: cy };
  domainColor[name] = palette[i % palette.length];
  domainMap[name].forEach(n => {
    n.domainX = cx + (typeOffsetX[n.type] || 0);
    n.domainY = cy;
  });
});

let groupMode = 'domain';

const layerTypes = ['controller', 'router', 'service', 'model', 'client'];
const layerLabels = { controller: 'Controllers', router: 'Routers', service: 'Services', model: 'Models', client: 'Clients' };
let layerCenters = {};
const layerMap = {};
nodes.forEach(n => {
  if (!layerMap[n.type]) layerMap[n.type] = [];
  layerMap[n.type].push(n);
});
const lCols = Math.ceil(Math.sqrt(layerTypes.length * (W / H)));
const lRows = Math.ceil(layerTypes.length / lCols);
const lCellW = W / (lCols + 1);
const lCellH = (H - 60) / (lRows + 1);
layerTypes.forEach((type, i) => {
  const col = i % lCols;
  const row = Math.floor(i / lCols);
  const cx = lCellW * (col + 1);
  const cy = lCellH * (row + 1) + 40;
  layerCenters[type] = { x: cx, y: cy };
  (layerMap[type] || []).forEach(n => {
    n.layerX = cx;
    n.layerY = cy;
  });
});

const sim = d3.forceSimulation(nodes)
  .force('link', d3.forceLink(links).distance(60).strength(0.1))
  .force('charge', d3.forceManyBody().strength(-150).distanceMax(300))
  .force('collision', d3.forceCollide().radius(d => d.r + 18).strength(0.9).iterations(2))
  .force('x', d3.forceX(d => d.domainX || W/2).strength(0.3))
  .force('y', d3.forceY(d => d.domainY || H/2).strength(0.3));

const colLabels = g.append('g').attr('class', 'col-labels').style('display', 'none');
['Controllers', 'Routers', 'Services', 'Models', 'Clients'].forEach((label, i) => {
  const types = ['controller', 'router', 'service', 'model', 'client'];
  colLabels.append('text')
    .attr('x', colX[types[i]])
    .attr('y', 30)
    .attr('text-anchor', 'middle')
    .attr('fill', color[types[i]])
    .attr('font-size', '13px')
    .attr('font-weight', '600')
    .attr('opacity', 0.4)
    .text(label);
});

function applyGroupLayout() {
  if (groupMode === 'domain') {
    sim.force('link', d3.forceLink(links).distance(60).strength(0.1))
      .force('charge', d3.forceManyBody().strength(-150).distanceMax(300))
      .force('collision', d3.forceCollide().radius(d => d.r + 18).strength(0.9).iterations(2))
      .force('center', null)
      .force('x', d3.forceX(d => d.domainX || W/2).strength(0.3))
      .force('y', d3.forceY(d => d.domainY || H/2).strength(0.3));
    colLabels.style('display', 'none');
  } else {
    sim.force('link', d3.forceLink(links).distance(60).strength(0.1))
      .force('charge', d3.forceManyBody().strength(-150).distanceMax(300))
      .force('collision', d3.forceCollide().radius(d => d.r + 18).strength(0.9).iterations(2))
      .force('center', null)
      .force('x', d3.forceX(d => d.layerX || W/2).strength(0.3))
      .force('y', d3.forceY(d => d.layerY || H/2).strength(0.3));
    colLabels.style('display', 'none');
  }
  sim.alpha(0.8).restart();
}

const hullLayer = g.insert('g', ':first-child').attr('class', 'hull-layer');

const link = g.append('g').selectAll('line').data(links).join('line')
  .attr('class', d => 'link link-' + d.type)
  .attr('marker-end', d => 'url(#arrow-' + d.type + ')');

let dragged = false;
const node = g.append('g').selectAll('g').data(nodes).join('g')
  .attr('class', 'node')
  .call(d3.drag()
    .on('start', (e, d) => { dragged = false; d.fx = d.x; d.fy = d.y; })
    .on('drag', (e, d) => { dragged = true; if (!e.active) sim.alphaTarget(0.3).restart(); d.fx = e.x; d.fy = e.y; })
    .on('end', (e, d) => { if (!e.active) sim.alphaTarget(0); if (!dragged) { d.fx = null; d.fy = null; } }));

node.append('circle')
  .attr('r', d => d.r)
  .attr('fill', d => getNodeColor(d))
  .attr('stroke', d => getNodeStroke(d))
  .attr('stroke-width', 1.5)
  .attr('stroke-dasharray', d => d.ee ? '3,2' : null);

node.append('text')
  .text(d => d.id)
  .attr('dx', d => d.r + 3)
  .attr('dy', 3)
  .attr('fill', d => color[d.type])
  .attr('font-size', d => d.r > 8 ? '10px' : '8px')
  .attr('opacity', 0.7);

const tip = d3.select('#tooltip');

function fmtNum(n) { if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M'; if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K'; return String(n); }
function fmtMs(ms) { if (ms >= 1000) return (ms / 1000).toFixed(1) + 's'; return Math.round(ms) + 'ms'; }

function buildNodeContent(d, opts) {
  const interactive = opts && opts.interactive;
  let h = '';
  if (!interactive) {
    h += '<h3 style="color:' + color[d.type] + '">' + d.id + '</h3>';
  }
  h += '<span style="color:#8b949e">' + d.type + '</span>';
  if (d.domain) h += ' <span style="color:#6e7681">· ' + d.domain + '</span>';
  const pct = Math.round((1 - d.healthScore) * 100);
  h += '<div class="t-section">health score</div>';
  h += '<div class="t-item"><span style="color:' + healthColorScale(d.healthScore) + ';font-weight:700;font-size:18px">' + pct + '</span><span style="color:#484f58;font-size:12px"> / 100</span></div>';
  h += '<div class="t-item" style="font-size:11px;color:#8b949e;margin-top:2px">';
  h += (connCount[d.id]||0) + ' edges · ' + (d.lineCount||0) + ' lines · ' + (d.gitActivity?.churn||0) + ' churn · ' + (d.gitActivity?.commits||0) + ' commits';
  h += '</div>';
  if (d.complexity) {
    h += '<div class="t-item" style="font-size:11px;color:#8b949e;margin-top:2px">Cyclomatic: <b style="color:#c9d1d9">' + d.complexity.cyclomatic + '</b> · Cognitive: <b style="color:#c9d1d9">' + d.complexity.cognitive + '</b> · Max/fn: <b style="color:#c9d1d9">' + d.complexity.maxFunctionCyclomatic + '</b></div>';
  }
  if (d.healthSummary) {
    h += '<div style="color:' + healthColorScale(d.healthScore) + ';font-style:italic;padding-left:10px;margin-top:4px;font-size:11px">' + d.healthSummary + '</div>';
  }
  if (d.duplication && d.duplication.ratio > 0) {
    const dupPct = Math.round(d.duplication.ratio * 100);
    const dupEdges = raw.edges.filter(e => e.type === 'shares_code' && (e.from === d.id || e.to === d.id));
    h += '<div class="t-section">duplication</div>';
    h += '<div class="t-item"><span style="color:#f47067;font-weight:700">' + dupPct + '%</span> duplicated <span style="color:#484f58">(' + d.duplication.clonedLines + ' / ' + d.duplication.totalLines + ' lines)</span>';
    if (dupEdges.length > 0) h += ' · <span style="color:#484f58">' + dupEdges.length + ' shared</span>';
    h += '</div>';
    if (d.duplicationSummary) {
      h += '<div style="color:#f47067;font-style:italic;padding-left:10px;margin-top:4px;font-size:11px">' + d.duplicationSummary + '</div>';
    }
    dupEdges.forEach(e => {
      const other = e.from === d.id ? e.to : e.from;
      const dup = e.duplication;
      if (dup) {
        h += '<div class="t-item" style="font-size:11px;margin-top:4px"><span style="color:#f47067">↔</span> <b style="color:#c9d1d9">' + other + '</b> <span style="color:#484f58">' + dup.cloneCount + ' clone' + (dup.cloneCount > 1 ? 's' : '') + ', ' + dup.totalLines + ' lines</span></div>';
        if (dup.advice) {
          h += '<div style="color:#d29922;font-style:italic;padding-left:18px;margin-top:1px;font-size:11px">' + dup.advice + '</div>';
        }
      }
    });
  }
  if (d.sentryActivity) {
    const sa = d.sentryActivity;
    h += '<div class="t-section">sentry (30d)</div>';
    h += '<div class="t-item"><span style="color:#58a6ff;font-weight:700">' + fmtNum(sa.totalRequests) + '</span> requests';
    if (sa.maxP95Ms > 0) h += ' · p95 <span style="color:#c9d1d9;font-weight:600">' + fmtMs(sa.maxP95Ms) + '</span>';
    if (sa.totalErrors > 0) h += ' · <span style="color:#f47067">' + fmtNum(sa.totalErrors) + ' errors (' + (sa.errorRate * 100).toFixed(2) + '%)</span>';
    h += '</div>';
    if (sa.topError) {
      const shortErr = sa.topError.length > 60 ? sa.topError.slice(0, 57) + '…' : sa.topError;
      if (interactive && sa.topErrorGroupId) {
        var issueUrl = 'https://lightdash.sentry.io/issues/' + sa.topErrorGroupId + '/events/?project=5959292';
        if (sa.topErrorTransaction) issueUrl += '&query=' + encodeURIComponent('transaction:"' + sa.topErrorTransaction + '"');
        h += '<div class="t-item" style="font-size:11px;margin-top:2px"><span style="color:#f47067">⚡</span> <a href="' + issueUrl + '" target="_blank" style="color:#f0883e">' + shortErr + '</a> <span style="color:#484f58">(' + fmtNum(sa.topErrorCount) + ')</span></div>';
      } else if (interactive) {
        h += '<div class="t-item" style="font-size:11px;margin-top:2px"><span style="color:#f47067">⚡</span> <span style="color:#f0883e">' + shortErr + '</span> <span style="color:#484f58">(' + fmtNum(sa.topErrorCount) + ')</span></div>';
      } else {
        h += '<div class="t-item" style="font-size:11px;margin-top:2px"><span style="color:#f47067">⚡</span> <span style="color:#f0883e">' + shortErr + '</span> <span style="color:#484f58">(' + fmtNum(sa.topErrorCount) + ')</span></div>';
      }
    }
    if (sa.endpoints && sa.endpoints.length > 0) {
      h += '<div class="t-section" style="margin-top:4px">top endpoints</div>';
      sa.endpoints.slice(0, 3).forEach(ep => {
        const shortRoute = ep.route.length > 45 ? '...' + ep.route.slice(-42) : ep.route;
        h += '<div class="t-item" style="font-size:11px"><span style="color:#58a6ff">' + fmtNum(ep.count).padStart(5) + '</span>  ' + shortRoute;
        if (ep.p95Ms > 0) h += '  <span style="color:#484f58">p95 ' + fmtMs(ep.p95Ms) + '</span>';
        if (ep.errorCount > 0) h += '  <span style="color:#f47067">' + fmtNum(ep.errorCount) + ' err</span>';
        h += '</div>';
      });
    }
    if (sa.spans && sa.spans.length > 0) {
      h += '<div class="t-section" style="margin-top:4px">service spans</div>';
      sa.spans.slice(0, 3).forEach(sp => {
        h += '<div class="t-item" style="font-size:11px"><span style="color:#58a6ff">' + fmtNum(sp.count).padStart(5) + '</span>  ' + sp.name + '</div>';
      });
    }
  }
  if (d.gitActivity) {
    h += '<div class="t-section">git activity</div>';
    h += '<div class="t-item">' + d.gitActivity.commits + ' commits · ' + d.gitActivity.authors + ' authors · ' + d.gitActivity.churn + ' recent (6mo)</div>';
    if (d.gitSummary) {
      h += '<div style="color:#7ee787;font-style:italic;padding-left:10px;margin-top:4px;font-size:11px;white-space:pre-line">' + d.gitSummary + '</div>';
    }
    if (interactive || !d.gitSummary) {
      if (d.gitActivity.recentCommits && d.gitActivity.recentCommits.length > 0) {
        h += '<div class="t-section" style="margin-top:6px">recent commits</div>';
        d.gitActivity.recentCommits.forEach(c => {
          const msg = c.message.length > 50 ? c.message.slice(0, 50) + '…' : c.message;
          if (interactive) {
            h += '<div class="t-item" style="font-size:11px"><a href="https://github.com/lightdash/lightdash/commit/' + c.hash + '" target="_blank" style="color:#484f58">' + c.hash + '</a>  ' + msg + '  <span style="color:#484f58">' + c.relativeDate + '</span></div>';
          } else {
            h += '<div class="t-item" style="font-size:11px"><span style="color:#484f58">' + c.hash + '</span>  ' + msg + '  <span style="color:#484f58">' + c.relativeDate + '</span></div>';
          }
        });
      }
    }
  }
  return h;
}

node.on('mouseover', (ev, d) => {
  if (selected === d.id) return;
  tip.html(buildNodeContent(d, { interactive: false })).style('display', 'block');
})
.on('mousemove', ev => {
  const x = Math.min(ev.clientX + 16, W - 400);
  tip.style('left', x + 'px').style('top', (ev.clientY - 10) + 'px');
})
.on('mouseout', () => tip.style('display', 'none'));

let selected = null;
node.on('click', (ev, d) => {
  ev.stopPropagation();
  tip.style('display', 'none');
  if (selected === d.id) { selected = null; clearHL(); closeDetail(); return; }
  selected = d.id;
  highlightNode(d);
  openDetail(d);
});
svg.on('click', () => {
  selected = null; clearHL(); closeDetail();
  document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
  document.querySelector('[data-filter="all"]').classList.add('active');
});

document.getElementById('depth').addEventListener('input', () => {
  if (selected) {
    const d = nodes.find(n => n.id === selected);
    if (d) highlightNode(d);
  }
});

function updateHeatmapLegend() {
  const mode = getColorMode();
  const isHeatmap = mode !== 'type';
  document.getElementById('heatmap-legend').style.display = isHeatmap ? 'flex' : 'none';
  if (!isHeatmap) return;
  const labels = document.querySelectorAll('.heatmap-labels span');
  const bar = document.querySelector('.heatmap-bar');
  if (mode === 'duplication') { labels[0].textContent = 'No duplication'; labels[1].textContent = 'High duplication'; bar.style.background = 'linear-gradient(to right, #3fb950, #d29922, #f47067)'; }
  else if (mode === 'traffic') { labels[0].textContent = 'Low traffic'; labels[1].textContent = 'High traffic'; bar.style.background = 'linear-gradient(to right, #e2b340, #e8853a, #f47067)'; }
  else if (mode === 'errors') { labels[0].textContent = 'No errors'; labels[1].textContent = 'High errors'; bar.style.background = 'linear-gradient(to right, #d29922, #f47067, #da3633)'; }
  else { labels[0].textContent = 'Healthy'; labels[1].textContent = 'Hot'; bar.style.background = 'linear-gradient(to right, #3fb950, #d29922, #f47067)'; }
}

document.getElementById('size-mode').addEventListener('change', () => {
  nodes.forEach(n => { n.r = calcRadius(n); });
  node.select('circle').attr('r', d => d.r);
  node.select('text').attr('dx', d => d.r + 3).attr('font-size', d => d.r > 8 ? '10px' : '8px');
  sim.force('collision', d3.forceCollide().radius(d => d.r + 18).strength(0.9).iterations(2));
  sim.alpha(0.3).restart();
  node.select('circle')
    .transition().duration(400)
    .attr('fill', d => getNodeColor(d))
    .attr('stroke', d => getNodeStroke(d));
  updateHeatmapLegend();
});

function getConnected(id, depth) {
  const downMap = new Map([[id, 0]]);
  let downFrontier = new Set([id]);
  for (let d = 0; d < depth; d++) {
    const next = new Set();
    links.forEach(l => {
      const src = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
      const tgt = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
      if (downFrontier.has(src) && !downMap.has(tgt)) { downMap.set(tgt, d + 1); next.add(tgt); }
    });
    if (next.size === 0) break;
    downFrontier = next;
  }

  const upMap = new Map([[id, 0]]);
  let upFrontier = new Set([id]);
  for (let d = 0; d < depth; d++) {
    const next = new Set();
    links.forEach(l => {
      const src = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
      const tgt = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
      if (upFrontier.has(tgt) && !upMap.has(src)) { upMap.set(src, d + 1); next.add(src); }
    });
    if (next.size === 0) break;
    upFrontier = next;
  }

  const merged = new Map(downMap);
  upMap.forEach((dep, nid) => {
    if (!merged.has(nid) || dep < merged.get(nid)) merged.set(nid, dep);
  });
  return merged;
}

function getDepth() {
  return Math.max(1, parseInt(document.getElementById('depth').value) || 1);
}

function highlightNode(d) {
  link.interrupt();
  const depth = getDepth();
  const conn = getConnected(d.id, depth);
  node.classed('dimmed', n => !conn.has(n.id));
  link.classed('dimmed', l => {
    const s = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
    const t = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
    return !(conn.has(s) && conn.has(t));
  });
  link.classed('highlighted', l => {
    const s = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
    const t = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
    return conn.has(s) && conn.has(t);
  });
  updateMarkers();

  const edgesBySource = {};
  link.filter('.highlighted').each(function(l) {
    const src = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
    const tgt = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
    const srcDepth = conn.get(src) ?? Infinity;
    const tgtDepth = conn.get(tgt) ?? Infinity;
    const outward = srcDepth <= tgtDepth;
    const origin = outward ? src : tgt;
    if (!edgesBySource[origin]) edgesBySource[origin] = [];
    edgesBySource[origin].push({ el: d3.select(this), l, outward });
    d3.select(this).style('stroke-opacity', 0).attr('marker-end', null);
  });

  const animated = new Set();
  function animateFrom(nodeId) {
    const edges = edgesBySource[nodeId];
    if (!edges) return;
    edges.forEach(e => {
      const el = e.el;
      if (animated.has(el.node())) return;
      animated.add(el.node());
      const x1 = +el.attr('x1'), y1 = +el.attr('y1');
      const x2 = +el.attr('x2'), y2 = +el.attr('y2');
      const len = Math.hypot(x2 - x1, y2 - y1);
      if (len === 0) return;
      const src = typeof e.l.source === 'object' ? e.l.source.id : nodes[e.l.source].id;
      const tgt = typeof e.l.target === 'object' ? e.l.target.id : nodes[e.l.target].id;
      const destId = e.outward ? tgt : src;
      el.style('stroke-opacity', null)
        .attr('stroke-dasharray', len)
        .attr('stroke-dashoffset', e.outward ? len : -len);
      el.transition()
        .duration(400 + Math.random() * 200)
        .ease(d3.easeCubicOut)
        .attr('stroke-dashoffset', 0)
        .on('end', function() {
          const self = d3.select(this);
          if (e.l.type === 'injects_service') self.attr('stroke-dasharray', '4,3');
          else if (e.l.type === 'shares_code') self.attr('stroke-dasharray', '4,2');
          else self.attr('stroke-dasharray', null);
          self.attr('stroke-dashoffset', null);
          if (arrowsEnabled && e.l.type !== 'shares_code') self.attr('marker-end', 'url(#arrow-hi-' + e.l.type + ')');
          animateFrom(destId);
        });
    });
  }
  animateFrom(d.id);
}

function clearHL() {
  link.interrupt();
  node.classed('dimmed', false);
  link.classed('dimmed', false).classed('highlighted', false);
  link.each(function(l) {
    const el = d3.select(this);
    el.style('stroke-opacity', null);
    if (l.type === 'injects_service') el.attr('stroke-dasharray', '4,3');
    else if (l.type === 'shares_code') el.attr('stroke-dasharray', '4,2');
    else el.attr('stroke-dasharray', null);
    el.attr('stroke-dashoffset', null);
  });
  updateMarkers();
}

let arrowsEnabled = true;
function updateMarkers() {
  link.attr('marker-end', function(l) {
    if (!arrowsEnabled) return null;
    if (l.type === 'shares_code') return null;
    if (d3.select(this).classed('dimmed')) return null;
    const isHL = d3.select(this).classed('highlighted');
    return 'url(#arrow-' + (isHL ? 'hi-' : '') + l.type + ')';
  });
}

document.getElementById('btn-arrows').addEventListener('click', () => {
  arrowsEnabled = !arrowsEnabled;
  document.getElementById('btn-arrows').classList.toggle('active', arrowsEnabled);
  updateMarkers();
});

document.getElementById('group-mode').addEventListener('change', e => {
  groupMode = e.target.value;
  applyGroupLayout();
});

let nodesVisible = true;
function applyNodeVisibility() {
  node.style('opacity', nodesVisible ? null : 0).style('pointer-events', nodesVisible ? null : 'none');
  link.style('opacity', nodesVisible ? null : 0);
  svg.node().classList.toggle('domain-only', !nodesVisible);
}
document.getElementById('btn-nodes').addEventListener('click', () => {
  nodesVisible = !nodesVisible;
  document.getElementById('btn-nodes').classList.toggle('active', nodesVisible);
  applyNodeVisibility();
});

document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase();
  if (!q) { clearHL(); return; }
  const matches = new Set();
  nodes.forEach(n => { if (n.id.toLowerCase().includes(q)) matches.add(n.id); });
  const conn = new Set(matches);
  links.forEach(l => {
    const s = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
    const t = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
    if (matches.has(s) || matches.has(t)) { conn.add(s); conn.add(t); }
  });
  node.classed('dimmed', n => !conn.has(n.id));
  link.classed('dimmed', l => {
    const s = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
    const t = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
    return !(matches.has(s) || matches.has(t));
  });
  link.classed('highlighted', l => {
    const s = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
    const t = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
    return matches.has(s) || matches.has(t);
  });
  updateMarkers();
});

document.querySelectorAll('[data-filter]').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const type = btn.dataset.filter;
    if (type === 'all') { clearHL(); return; }
    const matches = new Set();
    nodes.forEach(n => { if (n.type === type) matches.add(n.id); });
    node.classed('dimmed', n => !matches.has(n.id));
    link.classed('dimmed', l => {
      const s = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
      const t = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
      return !(matches.has(s) && matches.has(t));
    });
    updateMarkers();
  });
});

document.getElementById('btn-reset').addEventListener('click', () => {
  selected = null; clearHL(); closeDetail();
  document.getElementById('search').value = '';
  document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
  document.querySelector('[data-filter="all"]').classList.add('active');
  document.getElementById('size-mode').value = 'edges';
  groupMode = 'domain';
  document.getElementById('group-mode').value = 'domain';
  nodes.forEach(n => { n.r = calcRadius(n); });
  node.select('circle').attr('r', d => d.r).attr('fill', d => getNodeColor(d)).attr('stroke', d => getNodeStroke(d));
  node.select('text').attr('dx', d => d.r + 3).attr('font-size', d => d.r > 8 ? '10px' : '8px');
  updateHeatmapLegend();
  if (!nodesVisible) {
    nodesVisible = true;
    document.getElementById('btn-nodes').classList.add('active');
    applyNodeVisibility();
  }
  applyGroupLayout();
  svg.transition().duration(500).call(zoomBehavior.transform, d3.zoomIdentity);
});

// Guide sidebar
const guideEl = document.getElementById('guide');
document.getElementById('btn-guide').addEventListener('click', () => {
  guideEl.classList.toggle('open');
  document.getElementById('btn-guide').classList.toggle('active', guideEl.classList.contains('open'));
});
document.getElementById('guide-close').addEventListener('click', () => {
  guideEl.classList.remove('open');
  document.getElementById('btn-guide').classList.remove('active');
});
document.querySelectorAll('.guide-toggle').forEach(btn => {
  btn.addEventListener('click', () => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', String(!expanded));
    btn.nextElementSibling.classList.toggle('open', !expanded);
  });
});

// Detail sidebar
const detailEl = document.getElementById('detail');
const detailTitle = document.getElementById('detail-title');
const detailBody = document.getElementById('detail-body');
function openDetail(d) {
  detailTitle.textContent = d.id;
  detailTitle.style.color = color[d.type];
  detailBody.innerHTML = buildNodeContent(d, { interactive: true });
  detailEl.classList.add('open');
}
function closeDetail() {
  detailEl.classList.remove('open');
}
document.getElementById('detail-close').addEventListener('click', () => {
  closeDetail();
  selected = null;
  clearHL();
});

// EE toggle
const hasEe = nodes.some(n => n.ee);
if (hasEe) {
  document.getElementById('btn-ee').style.display = '';
  document.getElementById('sep-ee').style.display = '';
  let eeVisible = true;
  const eeBtn = document.getElementById('btn-ee');
  eeBtn.classList.add('active');
  function applyEeVisibility() {
    node.each(function(d) {
      if (d.ee) {
        d3.select(this).style('display', eeVisible ? null : 'none');
      }
    });
    link.each(function(l) {
      const s = typeof l.source === 'object' ? l.source.id : nodes[l.source].id;
      const t = typeof l.target === 'object' ? l.target.id : nodes[l.target].id;
      const sNode = nodes.find(n => n.id === s);
      const tNode = nodes.find(n => n.id === t);
      if ((sNode && sNode.ee) || (tNode && tNode.ee)) {
        d3.select(this).style('display', eeVisible ? null : 'none');
      }
    });
  }
  applyEeVisibility();
  eeBtn.addEventListener('click', () => {
    eeVisible = !eeVisible;
    eeBtn.classList.toggle('active', eeVisible);
    applyEeVisibility();
  });
}

function padHull(points, pad) {
  if (points.length < 3) return points;
  const cx = d3.mean(points, p => p[0]);
  const cy = d3.mean(points, p => p[1]);
  return points.map(p => {
    const dx = p[0] - cx, dy = p[1] - cy;
    const len = Math.sqrt(dx * dx + dy * dy) || 1;
    return [p[0] + dx / len * pad, p[1] + dy / len * pad];
  });
}

function smoothHull(points) {
  if (points.length < 3) return '';
  const n = points.length;
  let d = 'M' + points[0].join(',');
  for (let i = 0; i < n; i++) {
    const p0 = points[i];
    const p1 = points[(i + 1) % n];
    const p2 = points[(i + 2) % n];
    const mx1 = (p0[0] + p1[0]) / 2, my1 = (p0[1] + p1[1]) / 2;
    const mx2 = (p1[0] + p2[0]) / 2, my2 = (p1[1] + p2[1]) / 2;
    if (i === 0) d = 'M' + mx1 + ',' + my1;
    d += ' Q' + p1[0] + ',' + p1[1] + ' ' + mx2 + ',' + my2;
  }
  return d + 'Z';
}

sim.on('tick', () => {
  link.each(function(d) {
    const dx = d.target.x - d.source.x;
    const dy = d.target.y - d.source.y;
    const len = Math.sqrt(dx * dx + dy * dy) || 1;
    const r = d.target.r || 6;
    const el = d3.select(this);
    el.attr('x1', d.source.x).attr('y1', d.source.y)
      .attr('x2', d.target.x - dx / len * r)
      .attr('y2', d.target.y - dy / len * r);
  });
  node.attr('transform', d => `translate(${d.x},${d.y})`);

  hullLayer.selectAll('*').remove();
  if (groupMode === 'domain') {
    domainNames.forEach(name => {
      const pts = nodes.filter(n => n.domain === name).map(n => [n.x, n.y]);
      if (pts.length < 2) return;
      if (pts.length === 2) {
        const [a, b] = pts;
        const dx = b[0] - a[0], dy = b[1] - a[1];
        const len = Math.sqrt(dx * dx + dy * dy) || 1;
        const nx = -dy / len * 25, ny = dx / len * 25;
        const expanded = [[a[0]+nx,a[1]+ny],[b[0]+nx,b[1]+ny],[b[0]-nx,b[1]-ny],[a[0]-nx,a[1]-ny]];
        hullLayer.append('path')
          .attr('class', 'domain-hull')
          .attr('d', 'M' + expanded.map(p => p.join(',')).join('L') + 'Z')
          .attr('fill', domainColor[name]).attr('fill-opacity', 0.04)
          .attr('stroke', domainColor[name]).attr('stroke-opacity', 0.15)
          .attr('stroke-width', 1);
      } else {
        const hull = d3.polygonHull(pts);
        if (hull) {
          const padded = padHull(hull, 25);
          hullLayer.append('path')
            .attr('class', 'domain-hull')
            .attr('d', smoothHull(padded))
            .attr('fill', domainColor[name]).attr('fill-opacity', 0.04)
            .attr('stroke', domainColor[name]).attr('stroke-opacity', 0.15)
            .attr('stroke-width', 1);
        }
      }
      const cx = d3.mean(pts, p => p[0]);
      const cy = d3.mean(pts, p => p[1]);
      const minY = d3.min(pts, p => p[1]);
      hullLayer.append('text')
        .attr('class', 'domain-label')
        .attr('x', cx).attr('y', minY - 18)
        .attr('fill', domainColor[name]).attr('fill-opacity', 0.6)
        .text(name);
    });
  } else {
    layerTypes.forEach(type => {
      const pts = nodes.filter(n => n.type === type).map(n => [n.x, n.y]);
      if (pts.length < 2) return;
      if (pts.length === 2) {
        const [a, b] = pts;
        const dx = b[0] - a[0], dy = b[1] - a[1];
        const len = Math.sqrt(dx * dx + dy * dy) || 1;
        const nx = -dy / len * 25, ny = dx / len * 25;
        const expanded = [[a[0]+nx,a[1]+ny],[b[0]+nx,b[1]+ny],[b[0]-nx,b[1]-ny],[a[0]-nx,a[1]-ny]];
        hullLayer.append('path')
          .attr('class', 'domain-hull')
          .attr('d', 'M' + expanded.map(p => p.join(',')).join('L') + 'Z')
          .attr('fill', color[type]).attr('fill-opacity', 0.04)
          .attr('stroke', color[type]).attr('stroke-opacity', 0.15)
          .attr('stroke-width', 1);
      } else {
        const hull = d3.polygonHull(pts);
        if (hull) {
          const padded = padHull(hull, 25);
          hullLayer.append('path')
            .attr('class', 'domain-hull')
            .attr('d', smoothHull(padded))
            .attr('fill', color[type]).attr('fill-opacity', 0.04)
            .attr('stroke', color[type]).attr('stroke-opacity', 0.15)
            .attr('stroke-width', 1);
        }
      }
      const cx = d3.mean(pts, p => p[0]);
      const cy = d3.mean(pts, p => p[1]);
      const minY = d3.min(pts, p => p[1]);
      hullLayer.append('text')
        .attr('class', 'domain-label')
        .attr('x', cx).attr('y', minY - 18)
        .attr('fill', color[type]).attr('fill-opacity', 0.6)
        .text(layerLabels[type]);
    });
  }
});

</script>
</body>
</html>
